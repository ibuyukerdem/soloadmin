


SoloAdmin

Yazılım Satışı Kampanyaları


Şunu dedin:
yazılım üreten bir firmayız satış kanalımızın %90 ı internet üzerinden olacak, wordpress benzeri blog yazılımı, wix benzeri, firmalara web sitesi yazılımı, shopfy tarzı e-ticaret yazılımı, oto servis yazılımı, finans yazılımı ve efatura yazılımı üretiyoruz bu yazılımlar gelecekte artacak. Bu yazılımlarıda satarken yine kendi oluşturacağımız e-ticaret  yazılımı ile satacağız. Satışlarımızı artırmak, bir yazılımı alana belirli bir yazılımda indirim, bir yazılımı alana 100 makele hadiyesi, bir yazılımı alana 1M backlink hediyesi, ilk defa alanlara belirli bir indirim, ayrıca ödeme ekranında beraber satın alınanlar, beraber alana indirim gibi varyasyonlara sistematik bir şekilde ihtiyacım var.  Şuan için bu kampanya çeşitlerini gelecekte ihtiyacım olabilecek varyasyonlara ihtiyacım var bunları örneklerle ver. Amaç yazılım satışlarımızı kampanyalarla artırmak ve buna uygun e-ticaret yazılımını üretmek!

ChatGPT
E-ticaret Yazılımı Kampanya Varyasyonları
Düşündüm için 1m 17s
Aşağıda, gelecekte ihtiyaç duyabileceğiniz kampanya varyasyonlarına yönelik sistematik örnekler bulabilirsiniz. Her bir varyasyon, e-ticaret yazılımınızın dinamik olarak yönetebileceği ve otomasyonla uygulanabileceği bir yapıya dönüştürülebilir. Amaç, yazılım satışlarınızı kampanyalar ile artırmak ve esneklik sağlayacak bir kampanya motoru kurgulamaktır.

1. Temel İndirim ve Hediye Kampanyaları
A. Ürüne Özel İndirimler:

"Blog Yazılımı alan ilk 100 kişiye %20 indirim"
"Wix benzeri site kurma yazılımında ilk kez satın alanlara %10 indirim"
"Shopify tarzı e-ticaret yazılımını yıllık paket alanlara 3 ay ücretsiz kullanım"
B. Zamana Bağlı İndirimler:

"Hafta sonu boyunca tüm web sitesi yazılımlarında %15 indirim"
"Yıl sonuna kadar finans yazılımını alanlara ek modüllerde %10 indirim"
"Bayram dönemine özel efatura yazılımında %25 indirim"
C. Miktara Bağlı İndirimler:

"Birden fazla yazılım alımında (2 ve üzeri) sepet toplamına %15 indirim"
"10 adet oto servis yazılımı lisansı alana 11.si hediye"
"Toplam tutarı X TL üzeri alımlarda ücretsiz ek modül"
2. Ürünler Arası Bağlantılı Kampanyalar
A. "Birini Alana Diğerinde İndirim" Kampanyası:

"Blog yazılımı alan müşteriye, web sitesi yazılımında %10 indirim"
"Finans yazılımı alan müşteriye, efatura yazılımında %15 indirim"
"E-ticaret yazılımı alan müşteriye, oto servis yazılımı modülünde %20 indirim"
B. Tamamlayıcı Ürün Paketi Kampanyaları:

"Shopify tarzı e-ticaret yazılımı + Efatura yazılımı birlikte alınırsa toplam %25 indirim"
"Web sitesi yazılımı + Blog yazılımı paketi alana 100 makale hediye"
"Finans yazılımı + Efatura yazılımı birlikte alınırsa 1M backlink hediyesi"
C. Ürün Kategori Bazlı İndirimler:

"Tüm web geliştirme yazılımlarını (Blog, Wix benzeri, Web sitesi oluşturucu) aynı anda alanlara toplu paket indirimi"
"Tüm e-ticaret odaklı yazılımlar (Shopfy tarzı, Efatura) bir arada alındığında paket fiyatı"
3. Segmentasyona Dayalı Kampanyalar
A. Yeni Müşterilere Özel Kampanyalar:

"İlk defa alışveriş yapanlara %10 hoş geldin indirimi"
"İlk alışverişinde blog yazılımı alana ücretsiz 50 makale desteği"
"İlk defa alanlara 3 ay ücretsiz destek hizmeti"
B. Mevcut Müşterilere Sadakat Kampanyaları:

"Daha önce blog yazılımı alan müşteriye bir sonraki alışverişte %15 indirim"
"Efatura yazılımını yenileyen müşteriye ek modüllerde %10 indirim"
"3 kez alışveriş yapanlara 4. alışverişte özel bir yazılım modülü hediye"
4. Paketler ve Hediye İçerik Kampanyaları
A. İçerik Hediye Kampanyaları:

"Blog yazılımı satın alana 100 makale hediye"
"E-ticaret yazılımı satın alana 1M backlink hediyesi"
"Web sitesi yazılımı alana ücretsiz sosyal medya görsel paketi"
B. Eğitim ve Danışmanlık Hediye Kampanyaları:

"Finans yazılımı alan müşteriye 1 saat online danışmanlık"
"Oto servis yazılımı alan müşteriye ücretsiz kurulum ve eğitim paketi"
"Web sitesi yazılımı alana SEO eğitimi videosu hediye"
5. Sepet Aşamasında Dinamik Öneriler ve İndirimler
A. Beraber Satın Alınanlar Önerisi:

Müşteri blog yazılımını sepete eklediğinde, sistem "Diğer kullanıcılar ayrıca şu web sitesi yazılımını da aldı" şeklinde öneri gösterir. Bu ürünü sepete eklerse %10 indirim uygular.
Efatura yazılımı sepete eklendiğinde e-ticaret yazılımı önerilerek ekstra %5 indirim sunulur.
B. Sepet Toplamına Göre Ekstra İndirimler:

"Sepet toplamı X TL üzeri ise bir sonraki alışverişte kullanılmak üzere kupon hediye"
"Sepete ikinci bir yazılım ekleyenlere ek %5 indirim"
6. Abonelik Tabanlı Kampanyalar
A. Uzun Vadeli Abonelik İndirimi:

"Yıllık abonelik alana 2 ay ücretsiz eklenir"
"3 yıllık abonelik alana bakım ve destek ücretsiz"
B. Aboneliği Yükseltme Kampanyaları:

"Mevcut aylık aboneliğini yıllık aboneliğe yükseltenlere %20 indirim"
"Standart paketten Premium pakete geçenlere ek modül hediyesi"
7. Topluluk ve İşbirliği Bazlı Kampanyalar
A. Referans ve Ortaklık Kampanyaları:

"Arkadaşını davet edene ve arkadaşının ilk alışverişi için %10 indirim kodu"
"Partner işbirliklerinde (mesela bir dijital pazarlama ajansı ile) birlikte sunulan paketlerde özel fiyatlandırma"
B. Grup Satın Alma İndirimleri:

"Aynı şirkete ait 5 kullanıcı lisansı alındığında her bir lisansta %15 indirim"
"Toplu bayi alımlarında (10 ve üzeri) özel kurumsal fiyatlar"
Özet:
Gelecekte oluşturacağınız e-ticaret yazılımında bir "Kampanya Motoru" geliştirerek, yukarıdaki gibi bir dizi varyasyonu dinamik olarak uygulayabilirsiniz. Bu kampanya motoru, şu kriterlere göre kampanyaları otomatik olarak uygulayabilir veya önerebilir:

Kullanıcı Segmenti: Yeni, mevcut, sık satın alan, kurumsal müşteri vs.
Ürün Kategorisi: Blog, web sitesi, e-ticaret, oto servis, finans, efatura vs.
Zamanlama: Hafta sonu, bayram dönemi, yıl sonu kampanyaları vs.
Sepet Davranışı: Birlikte satın alınan ürünler, sepet toplam tutarı, ek ürün önerileri vs.
Abonelik Modeli: Aylık, yıllık, uzun dönem, seviye atlama (upgrade) indirimleri vs.
Bu şekilde hem yazılım satışlarınızı kampanyalarla canlı tutacak hem de müşterilerinize kişiselleştirilmiş ve teşvik edici teklifler sunabileceksiniz.





Şunu dedin:
bu yapıları django üzerinde yerleşik site ve user yapılarını kullanırken şuan için yalnızca aşağıdaki model e sahibim yukarda saydığın satış kampanyalarını yönetebilmek için nasıl bir model yapısına ihtiyacım var

# soloaccounting/models.py
class Product(models.Model):
    """
    Product modeli, ürünlerin temel özelliklerini barındırır.
    """
    name = models.CharField(
        max_length=255,
        unique=True,
        verbose_name="Ürün Adı",
        help_text="Ürün adını belirtiniz."
    )
    slug = models.SlugField(
        max_length=255,
        unique=True,
        verbose_name="Slug",
        help_text="Ürünün URL'de kullanılacak kısa adı. Otomatik oluşturulur.",
        blank=True
    )
    description = models.TextField(
        null=True,
        blank=True,
        verbose_name="Ürün Açıklaması",
        help_text="Ürün ile ilgili açıklama."
    )
    serviceDuration = models.PositiveIntegerField(
        verbose_name="Hizmet Süresi (Ay)",
        help_text="Hizmet süresi ay cinsinden belirtilmelidir."
    )
    price = models.DecimalField(
        max_digits=10,
        decimal_places=2,
        verbose_name="Ürün Fiyatı",
        help_text="Ürün fiyatını belirtiniz."
    )
    isActive = models.BooleanField(
        default=True,
        verbose_name="Aktif",
        help_text="Ürünün aktif/pasif durumunu belirtir."
    )
    createDate = models.DateTimeField(
        auto_now_add=True,
        verbose_name="Oluşturulma Tarihi",
        help_text="Bu kaydın oluşturulma tarihi otomatik olarak ayarlanır."
    )
    updateDate = models.DateTimeField(
        auto_now=True,
        verbose_name="Güncellenme Tarihi",
        help_text="Bu kaydın son güncellenme tarihi otomatik olarak ayarlanır."
    )

    class Meta:
        verbose_name = "Ürün"
        verbose_name_plural = "Ürünler"

    def __str__(self):
        return self.name

    def save(self, *args, **kwargs):
        if not self.slug:
            self.slug = slugify(self.name)
        super(Product, self).save(*args, **kwargs)
ChatGPT
kampanya yönetimi için model yapısı
Düşündüm için 1m 29s
Aşağıda belirtilen örnek bir model yapısı, Django projelerinizde satış kampanyalarınızı esnek bir şekilde yönetebilmeniz için bir temel taslak sunar. Bu yapı, ileride eklenebilecek yeni kampanya türlerine, koşullara ve aksiyonlara uyum sağlayabilir. Amacımız, kampanyaların koşullarının (conditions) ve aksiyonlarının (actions) esnek şekilde tanımlanmasına olanak vermektir.

Temel Yaklaşım
Campaign (Kampanya) Modeli:
Kampanya adını, açıklamasını, tarih aralıklarını, aktiflik durumunu ve genel ayarları barındırır.

Condition (Koşul) Modeli:
Kampanyanın hangi durumlarda geçerli olacağını tanımlar. Örneğin:

Belirli bir ürünü satın almak
Sepette belirli bir toplam tutarın üzerinde olmak
Kullanıcının ilk alışverişi olması
Belirli sayıda ürün almak
Bu koşullar, kampanya motorunun kampanyanın uygulanıp uygulanmayacağını anlamasına yardımcı olur.
Koşullar tek bir tablo içinde condition_type alanıyla ayrıştırılabilir ve ilgili parametreler (JSONField veya ayrı alanlar) saklanabilir.

Action (Aksiyon) Modeli:
Koşullar sağlandığında ne yapılacağını tanımlar. Örneğin:

Belirli bir oranda indirim (%10 indirim)
Belirli bir ürünün hediye edilmesi (100 makale hediye)
Belirli bir hizmetin eklenmesi (1M backlink)
İki ürün birlikte alındığında indirim uygulamak
Yine aksiyonlar da tek bir tablo içerisinde action_type gibi bir alan yardımıyla ayrıştırılabilir. İlgili parametreler JSON veya ilave alanlar ile saklanabilir.

Kampanya - Ürün İlişkisi:
Bazı kampanyalar tüm ürünlerde, bazıları belirli ürün gruplarında veya kategorilerde geçerli olabilir. Bu nedenle Campaign ile Product arasında ManyToManyField kullanarak hangi ürünlerin kampanyaya dahil olduğunu belirtebilirsiniz.

Kullanıcı Segmentasyonuna Göre Koşullar (Opsiyonel):
Eğer kullanıcı segmentlerine göre kampanya uygulamak istiyorsanız (örneğin ilk defa satın alan kullanıcılar), User modelini koşullara dahil edebilirsiniz. Bu durumda Condition modeline user segmentini ifade eden alanlar veya separate bir model/field ekleyebilirsiniz.

Aşağıda bu yapıyı örnek kod ile somutlaştırılmış bir şekilde bulabilirsiniz:

Örnek Modeller
python
Kodu kopyala
from django.db import models
from django.contrib.auth.models import User
from django.utils import timezone
from django.contrib.postgres.fields import JSONField  # Postgres kullanıyorsanız, yoksa Django 3.1+ için models.JSONField

class Product(models.Model):
    name = models.CharField(
        max_length=255,
        unique=True,
        verbose_name="Ürün Adı"
    )
    slug = models.SlugField(
        max_length=255,
        unique=True,
        verbose_name="Slug",
        blank=True
    )
    description = models.TextField(
        null=True,
        blank=True,
        verbose_name="Ürün Açıklaması"
    )
    serviceDuration = models.PositiveIntegerField(
        verbose_name="Hizmet Süresi (Ay)"
    )
    price = models.DecimalField(
        max_digits=10,
        decimal_places=2,
        verbose_name="Ürün Fiyatı"
    )
    isActive = models.BooleanField(
        default=True,
        verbose_name="Aktif"
    )
    createDate = models.DateTimeField(
        auto_now_add=True,
        verbose_name="Oluşturulma Tarihi"
    )
    updateDate = models.DateTimeField(
        auto_now=True,
        verbose_name="Güncellenme Tarihi"
    )

    class Meta:
        verbose_name = "Ürün"
        verbose_name_plural = "Ürünler"

    def __str__(self):
        return self.name

    def save(self, *args, **kwargs):
        from django.utils.text import slugify
        if not self.slug:
            self.slug = slugify(self.name)
        super(Product, self).save(*args, **kwargs)


class Campaign(models.Model):
    """
    Kampanya baz model.
    Bu model, bir kampanyanın genel özelliklerini tutar.
    """
    name = models.CharField(max_length=255, verbose_name="Kampanya Adı")
    description = models.TextField(null=True, blank=True, verbose_name="Kampanya Açıklaması")
    start_date = models.DateTimeField(verbose_name="Başlangıç Tarihi", default=timezone.now)
    end_date = models.DateTimeField(verbose_name="Bitiş Tarihi", null=True, blank=True)
    products = models.ManyToManyField(Product, blank=True, related_name='campaigns', verbose_name="Ürünler")
    is_active = models.BooleanField(default=True, verbose_name="Aktif")

    class Meta:
        verbose_name = "Kampanya"
        verbose_name_plural = "Kampanyalar"

    def __str__(self):
        return self.name


class Condition(models.Model):
    """
    Koşullar tek bir model üzerinden yönetilebilir.
    condition_type: hangi tipte bir koşul olduğunu belirtir (örn: 'PRODUCT_PURCHASED', 'CART_TOTAL', 'FIRST_PURCHASE')
    params: koşulun detaylarını tutan JSON (örn. minimum tutar, gerekli ürün ID, vs.)
    """
    CONDITION_TYPES = (
        ('PRODUCT_PURCHASED', 'Belirli Ürün Alımı'),
        ('MIN_CART_TOTAL', 'Minimum Sepet Tutarı'),
        ('FIRST_PURCHASE', 'İlk Alışveriş'),
        ('BULK_QUANTITY', 'Belirli Sayıda Ürün Alımı'),
        # İleride eklenebilecek diğer koşullar: Kullanıcı segmenti, tarih aralığı vb.
    )
    campaign = models.ForeignKey(Campaign, on_delete=models.CASCADE, related_name='conditions', verbose_name="Kampanya")
    condition_type = models.CharField(max_length=50, choices=CONDITION_TYPES, verbose_name="Koşul Tipi")
    params = models.JSONField(default=dict, blank=True, verbose_name="Koşul Parametreleri")

    class Meta:
        verbose_name = "Koşul"
        verbose_name_plural = "Koşullar"

    def __str__(self):
        return f"{self.campaign.name} - {self.condition_type}"


class Action(models.Model):
    """
    Aksiyonlar tek bir model üzerinden yönetilebilir.
    action_type: aksiyon tipini belirtir (örn: 'DISCOUNT_PERCENT', 'DISCOUNT_FIXED', 'GIFT_PRODUCT', 'ADD_BACKLINK')
    params: aksiyonun detaylarını (indirimin yüzdesi, hediye ürün sayısı, backlink sayısı vb.) içerir.
    """
    ACTION_TYPES = (
        ('DISCOUNT_PERCENT', 'Yüzdesel İndirim'),
        ('DISCOUNT_FIXED', 'Sabit İndirim'),
        ('GIFT_PRODUCT', 'Hediye Ürün'),
        ('ADD_BACKLINK', 'Backlink Ekle'),
        ('ADD_CONTENT', 'Makale vb. İçerik Ekle'),
        # İleride eklenebilecek diğer aksiyon tipleri
    )
    campaign = models.ForeignKey(Campaign, on_delete=models.CASCADE, related_name='actions', verbose_name="Kampanya")
    action_type = models.CharField(max_length=50, choices=ACTION_TYPES, verbose_name="Aksiyon Tipi")
    params = models.JSONField(default=dict, blank=True, verbose_name="Aksiyon Parametreleri")

    class Meta:
        verbose_name = "Aksiyon"
        verbose_name_plural = "Aksiyonlar"

    def __str__(self):
        return f"{self.campaign.name} - {self.action_type}"
Açıklamalar
Campaign modeli, kampanyanın başlangıç ve bitiş tarihlerini, ilgili ürünleri (opsiyonel: kampanya belirli ürünlere özgüyse), ve genel aktiflik durumunu tutar.
Condition modeli, kampanyanın hangi durumlarda geçerli olduğunu belirler. Örneğin:
condition_type='PRODUCT_PURCHASED' için params={'product_id': 5} gibi bir parametre kampanyanın o ürünü alan kişiler için geçerli olduğunu ifade edebilir.
condition_type='MIN_CART_TOTAL' için params={'amount': 100.00} sepette 100 TL üzerinde alışveriş yapılması gerektiğini ifade edebilir.
condition_type='FIRST_PURCHASE' herhangi bir parametre gerektirmeyebilir, sadece kullanıcıya bakar.
Action modeli, koşullar sağlandığında ne yapılacağını belirler:
action_type='DISCOUNT_PERCENT', params={'percentage': 10} %10 indirim uygular.
action_type='GIFT_PRODUCT', params={'product_id': 3, 'quantity': 1} ürünü sepete hediye olarak ekler.
action_type='ADD_CONTENT', params={'content_type': 'article', 'quantity': 100} 100 makale hediyesini ifade eder.
Bu model yapısı:

Kolay genişletilebilir (yeni kampanya türleri, yeni koşullar, yeni aksiyon tipleri eklenebilir).
Koşul ve aksiyonların veritabanında parametrik olarak saklanmasını sağlar.
Django'nun yerleşik User modeliyle veya segmentasyon modelleriyle entegre edilebilir (örneğin Condition modeline kullanıcı segmenti alanları eklenerek).
Sonuç: Bu örnek yapıda, kampanyalarınızı tanımlamak, koşulları ve aksiyonları esnek bir şekilde yönetmek mümkündür. Gelecekte ihtiyaç duyacağınız varyasyonları da benzer şekilde Condition ve Action modellerine parametre ekleyerek veya yeni condition_type/action_type seçenekleri ekleyerek rahatlıkla genişletebilirsiniz.





Şunu dedin:
Öncelikle kullanıcı segmentlerine göre kampanya uygulamak istiyorum User modelini koşullara dahil et ve model yapısını tekrar ver CONDITION_TYPES, ACTION_TYPES gibi alanlar içinde tablo yapısı oluştur sonrasında bu tabloların kullnımına dair örnekler vererek açıkla
ChatGPT
Request for o1 pro mode
Düşünme sona erdi
Aşağıda, kullanıcı segmentlerine göre kampanya uygulamak için model yapısını genişletilmiş bir örnekle görebilirsiniz. Ayrıca ConditionType ve ActionType gibi tanımlamaları da ayrı tablolar üzerinden yönetip, bu tablo değerlerini Condition ve Action modelleri üzerinden seçmeli hale getiriyoruz.

Bu yapıda amaç:

Kampanyaları tek bir Campaign tablosunda yönetmek.
Her bir kampanyaya bir veya birden fazla Condition (koşul) ekleyerek kampanyanın hangi durumlarda geçerli olduğunu belirlemek.
Her bir kampanyaya bir veya birden fazla Action (aksiyon) ekleyerek koşullar sağlandığında hangi indirim veya hediye aksiyonunun devreye gireceğini tanımlamak.
ConditionType ve ActionType modelleri ile koşul ve aksiyon tiplerini veritabanında tanımlı olarak tutup, gerektiğinde yeni tipler ekleyebilmek.
Kullanıcı segmentlerini örneğin UserSegment modeli ile yöneterek belirli segmente giren kullanıcılar için kampanya koşulu oluşturmak.
Aşağıda Django modelleri ve sonrasında kullanım örnekleri açıklanmıştır.

Modeller
python
Kodu kopyala
from django.db import models
from django.contrib.auth.models import User
from django.utils import timezone
from django.utils.text import slugify


class UserSegment(models.Model):
    """
    Kullanıcı segmentlerini tanımlamak için basit bir model.
    Örnek segmentler:
    - Yeni kullanıcı (ilk alışverişi olmayan)
    - Sadık müşteri (x ve üstü alışveriş yapmış)
    - Belirli bir gruba dahil müşteri vb.
    """
    name = models.CharField(max_length=100, unique=True, verbose_name="Segment Adı")
    description = models.TextField(null=True, blank=True, verbose_name="Segment Açıklaması")

    class Meta:
        verbose_name = "Kullanıcı Segmenti"
        verbose_name_plural = "Kullanıcı Segmentleri"

    def __str__(self):
        return self.name


class Product(models.Model):
    name = models.CharField(max_length=255, unique=True, verbose_name="Ürün Adı")
    slug = models.SlugField(max_length=255, unique=True, verbose_name="Slug", blank=True)
    description = models.TextField(null=True, blank=True, verbose_name="Ürün Açıklaması")
    serviceDuration = models.PositiveIntegerField(verbose_name="Hizmet Süresi (Ay)")
    price = models.DecimalField(max_digits=10, decimal_places=2, verbose_name="Ürün Fiyatı")
    isActive = models.BooleanField(default=True, verbose_name="Aktif")
    createDate = models.DateTimeField(auto_now_add=True, verbose_name="Oluşturulma Tarihi")
    updateDate = models.DateTimeField(auto_now=True, verbose_name="Güncellenme Tarihi")

    class Meta:
        verbose_name = "Ürün"
        verbose_name_plural = "Ürünler"

    def __str__(self):
        return self.name

    def save(self, *args, **kwargs):
        if not self.slug:
            self.slug = slugify(self.name)
        super(Product, self).save(*args, **kwargs)


class Campaign(models.Model):
    name = models.CharField(max_length=255, verbose_name="Kampanya Adı")
    description = models.TextField(null=True, blank=True, verbose_name="Kampanya Açıklaması")
    start_date = models.DateTimeField(verbose_name="Başlangıç Tarihi", default=timezone.now)
    end_date = models.DateTimeField(verbose_name="Bitiş Tarihi", null=True, blank=True)
    products = models.ManyToManyField(Product, blank=True, related_name='campaigns', verbose_name="Ürünler")
    is_active = models.BooleanField(default=True, verbose_name="Aktif")

    class Meta:
        verbose_name = "Kampanya"
        verbose_name_plural = "Kampanyalar"

    def __str__(self):
        return self.name


class ConditionType(models.Model):
    """
    Koşul tiplerini veritabanında tutar.
    Örnek:
    - 'PRODUCT_PURCHASED' : Belirli bir ürünü almış olmak
    - 'MIN_CART_TOTAL' : Minimum sepet tutarı
    - 'FIRST_PURCHASE' : İlk alışveriş
    - 'BULK_QUANTITY' : Belirli sayıda ürün almak
    - 'USER_SEGMENT' : Kullanıcının belirli bir segmente dahil olması
    """
    code = models.CharField(max_length=50, unique=True, verbose_name="Koşul Kodu")
    name = models.CharField(max_length=100, verbose_name="Koşul Adı")
    description = models.TextField(null=True, blank=True, verbose_name="Koşul Açıklaması")

    class Meta:
        verbose_name = "Koşul Tipi"
        verbose_name_plural = "Koşul Tipleri"

    def __str__(self):
        return f"{self.code} - {self.name}"


class ActionType(models.Model):
    """
    Aksiyon tiplerini veritabanında tutar.
    Örnek:
    - 'DISCOUNT_PERCENT' : Yüzdesel indirim
    - 'DISCOUNT_FIXED' : Sabit tutarlı indirim
    - 'GIFT_PRODUCT' : Hediye ürün ekleme
    - 'ADD_BACKLINK' : Backlink ekleme
    - 'ADD_CONTENT' : Makale vb. içerik ekleme
    """
    code = models.CharField(max_length=50, unique=True, verbose_name="Aksiyon Kodu")
    name = models.CharField(max_length=100, verbose_name="Aksiyon Adı")
    description = models.TextField(null=True, blank=True, verbose_name="Aksiyon Açıklaması")

    class Meta:
        verbose_name = "Aksiyon Tipi"
        verbose_name_plural = "Aksiyon Tipleri"

    def __str__(self):
        return f"{self.code} - {self.name}"


class Condition(models.Model):
    campaign = models.ForeignKey(Campaign, on_delete=models.CASCADE, related_name='conditions', verbose_name="Kampanya")
    condition_type = models.ForeignKey(ConditionType, on_delete=models.PROTECT, related_name='conditions', verbose_name="Koşul Tipi")
    params = models.JSONField(default=dict, blank=True, verbose_name="Koşul Parametreleri")
    # Eğer kullanıcı segmenti koşulu için direk ilişki kuracaksanız:
    user_segment = models.ForeignKey(UserSegment, on_delete=models.SET_NULL, null=True, blank=True, verbose_name="Kullanıcı Segmenti")

    class Meta:
        verbose_name = "Koşul"
        verbose_name_plural = "Koşullar"

    def __str__(self):
        return f"{self.campaign.name} - {self.condition_type.name}"


class Action(models.Model):
    campaign = models.ForeignKey(Campaign, on_delete=models.CASCADE, related_name='actions', verbose_name="Kampanya")
    action_type = models.ForeignKey(ActionType, on_delete=models.PROTECT, related_name='actions', verbose_name="Aksiyon Tipi")
    params = models.JSONField(default=dict, blank=True, verbose_name="Aksiyon Parametreleri")

    class Meta:
        verbose_name = "Aksiyon"
        verbose_name_plural = "Aksiyonlar"

    def __str__(self):
        return f"{self.campaign.name} - {self.action_type.name}"
Model Yapısının Açıklaması
UserSegment: Bu model ile kullanıcıları belirli segmentlere (yeni kullanıcı, sadık müşteri vb.) ayırabilirsiniz. Daha karmaşık segment tanımlamaları için segment belirleme lojiklerinizi bu tabloya bağlayabilirsiniz.

ConditionType & ActionType:

ConditionType tabloda satırlar halinde koşul tiplerini tutar. Örneğin:
PRODUCT_PURCHASED, MIN_CART_TOTAL, FIRST_PURCHASE, BULK_QUANTITY, USER_SEGMENT.
ActionType tabloda aksiyon tiplerini tutar. Örneğin:
DISCOUNT_PERCENT, DISCOUNT_FIXED, GIFT_PRODUCT, ADD_BACKLINK, ADD_CONTENT.
Bu sayede hem yönetim panelinden hem de kod üzerinden yeni koşul ve aksiyon tipleri tanımlamak çok daha kolaylaşır.

Condition:
Her bir koşul satırı ConditionType üzerinden hangi tip koşul olduğunu belirler. params alanı, koşul tipine göre dinamik parametreler içerir. Örneğin USER_SEGMENT tipi bir koşul için user_segment alanını set edebilirsiniz. MIN_CART_TOTAL tipi bir koşul için params = {"amount": 100} diyerek minimum sepet tutarını belirtebilirsiniz.

Action:
Her aksiyon satırı bir ActionType referans verir. params alanı bu aksiyona özel parametreleri tutar. Örneğin DISCOUNT_PERCENT için params = {"percentage": 10} gibi.

Kullanım Örnekleri
Yeni Kullanıcı Segmentine Özel %10 İndirim Kampanyası:

Öncelikle UserSegment tablosuna "Yeni Kullanıcı" segmenti ekleyin. Örneğin:

python
Kodu kopyala
UserSegment.objects.create(name="Yeni Kullanıcı", description="İlk alışverişini yapan veya hiç alışveriş yapmamış kullanıcılar.")
ConditionType tablosuna USER_SEGMENT türü koşul önceden eklenmiş olsun. Örneğin:

python
Kodu kopyala
ConditionType.objects.create(code="USER_SEGMENT", name="Kullanıcı Segment Koşulu", description="Belirli bir segmente ait kullanıcılar için.")
ActionType tablosuna DISCOUNT_PERCENT türü aksiyon önceden eklenmiş olsun. Örneğin:

python
Kodu kopyala
ActionType.objects.create(code="DISCOUNT_PERCENT", name="Yüzdesel İndirim", description="Sepet toplamına yüzdesel indirim uygular.")
Yeni bir kampanya oluşturun:

python
Kodu kopyala
c = Campaign.objects.create(name="Yeni Kullanıcıya Hoş Geldin İndirimi", description="Yeni kullanıcılara %10 indirim", is_active=True)
Koşul ekleyin (USER_SEGMENT koşulu):

python
Kodu kopyala
segment = UserSegment.objects.get(name="Yeni Kullanıcı")
ct = ConditionType.objects.get(code="USER_SEGMENT")
Condition.objects.create(campaign=c, condition_type=ct, user_segment=segment)
Aksiyon ekleyin (Yüzdesel %10 indirim):

python
Kodu kopyala
at = ActionType.objects.get(code="DISCOUNT_PERCENT")
Action.objects.create(campaign=c, action_type=at, params={"percentage": 10})
Bu sayede, kampanya çalıştığında eğer kullanıcı "Yeni Kullanıcı" segmentine aitse bu koşul sağlanacak ve %10 indirim uygulanacaktır.

Belirli Ürünü Sepete Ekleyene Hediye Makale Kampanyası:

ConditionType tablosunda PRODUCT_PURCHASED tipi kayıtlı olsun:

python
Kodu kopyala
ConditionType.objects.create(code="PRODUCT_PURCHASED", name="Belirli Ürün Alımı", description="Sepette belirtilen ürün varsa geçerli olur.")
ActionType tablosunda ADD_CONTENT tipi kayıtlı olsun:

python
Kodu kopyala
ActionType.objects.create(code="ADD_CONTENT", name="İçerik Ekleme", description="Hediye makale gibi içerik sunar.")
Kampanya oluşturun:

python
Kodu kopyala
p = Product.objects.get(name="Blog Yazılımı")
c2 = Campaign.objects.create(name="Blog Yazılımı Alana 100 Makale Hediye", is_active=True)
c2.products.add(p)  # İster ürün ekleyin, ister tüm ürünler için geçerli yapın.
Koşul ekleyin (PRODUCT_PURCHASED):

python
Kodu kopyala
ctype_product = ConditionType.objects.get(code="PRODUCT_PURCHASED")
Condition.objects.create(
  campaign=c2,
  condition_type=ctype_product,
  params={"product_id": p.id}  # Params içinde kontrol edilecek ürün id'sini belirtiyoruz.
)
Aksiyon ekleyin (ADD_CONTENT - 100 makale):

python
Kodu kopyala
at_content = ActionType.objects.get(code="ADD_CONTENT")
Action.objects.create(
  campaign=c2,
  action_type=at_content,
  params={"content_type": "article", "quantity": 100}
)
Bu durumda, eğer kullanıcının sepetinde "Blog Yazılımı" varsa koşul devreye girer ve 100 makale hediyesi uygulanır.

Özet
Bu yapıyla:

ConditionType ve ActionType modelleri ile koşul ve aksiyon tiplerini veritabanı kayıtlarıyla yönetebilir, kolayca yeni tipler ekleyebilirsiniz.
Condition ve Action modelleri, Campaign ile ilişkili olarak kampanyaların mantığını oluşturur.
UserSegment modelini kullanarak belirli kullanıcı gruplarını hedef alan kampanyalar oluşturabilir, USER_SEGMENT tipindeki koşulla bunu bağlayabilirsiniz.
params alanları ile esnek bir yapı oluşturup, koşul ve aksiyon tiplerine göre dinamik veri girişi yapabilirsiniz.
Bu sayede, kullanıcı segmentine ve diğer faktörlere göre değişen kampanyaları Django tabanlı bir e-ticaret sisteminde rahatlıkla yönetebilirsiniz.





Şunu dedin:
class CustomUser(AbstractUser): modeliini genişlettim 
isDealer = models.BooleanField(default=False, verbose_name='Bayi Mi?') 
alanını ekledim burada bayilere genel bir indirim yapmayı veya bayiye özel ek iskonto yapmayı ayrıca bayilere özel yukardaki kampanyalarıda yapabilmeyi hedefliyorum yukardaki yapıyı bayi leri  ve bayilere yönelik kampanyalarıda düşünerek güncelle
ChatGPT
Request for o1 pro mode
Düşünme sona erdi
Aşağıda önceki yapıyı CustomUser modelini, bayi (dealer) bilgilerini ve bayilere özel kampanyaları da kapsayacak şekilde güncellenmiş bir örnek verilmiştir. Bu yapı, hem son kullanıcılar hem de bayiler için farklı kampanya, koşul ve aksiyonların yönetilmesine olanak tanır.

Temel Yaklaşım
CustomUser modelinde isDealer alanı ile bir kullanıcının bayi olup olmadığı belirleniyor.
Bayileri de segmente edebilmek (farklı bayi gruplarına farklı kampanyalar uygulayabilmek) için DealerSegment isimli bir model ekliyoruz. Bu sayede belirli bir bayi segmentine veya doğrudan "bayi" olmaya göre koşul oluşturabiliriz.
ConditionType tablosuna USER_IS_DEALER ve DEALER_SEGMENT gibi ek kayıtlar yaparak bayi koşullarını yöneteceğiz.
İlgili Condition modeline dealer_segment ilişkisi ekleyerek, eğer bayi segmentine özel bir kampanya tanımlamak istersek bu alanı kullanabiliriz.
Bu sayede:

Sadece bayi olan kullanıcılara veya belirli bir bayi segmentine yönelik kampanyalar oluşturabilirsiniz.
Hem normal kullanıcı segmentlerini (UserSegment) hem de bayi segmentlerini (DealerSegment) aynı kampanya yapısı içinde yönetebilirsiniz.
Genişletilmiş Modeller
python
Kodu kopyala
from django.db import models
from django.contrib.auth.models import AbstractUser
from django.utils import timezone
from django.utils.text import slugify

# Kullanıcı modeli: Bayi bilgisi eklendi.
class CustomUser(AbstractUser):
    isDealer = models.BooleanField(default=False, verbose_name='Bayi Mi?')
    # Eğer bayileri segmente etmek istiyorsanız, bir ForeignKey ile belirli bir bayi segmentine bağlayabilirsiniz:
    dealer_segment = models.ForeignKey('DealerSegment', null=True, blank=True, on_delete=models.SET_NULL, verbose_name="Bayi Segmenti")


class UserSegment(models.Model):
    name = models.CharField(max_length=100, unique=True, verbose_name="Segment Adı")
    description = models.TextField(null=True, blank=True, verbose_name="Segment Açıklaması")

    class Meta:
        verbose_name = "Kullanıcı Segmenti"
        verbose_name_plural = "Kullanıcı Segmentleri"

    def __str__(self):
        return self.name


class DealerSegment(models.Model):
    """
    Bayi segmentlerini tanımlamak için model.
    Örneğin:
    - Alt Bayi
    - Gold Bayi
    - VIP Bayi
    """
    name = models.CharField(max_length=100, unique=True, verbose_name="Bayi Segmenti Adı")
    description = models.TextField(null=True, blank=True, verbose_name="Bayi Segmenti Açıklaması")

    class Meta:
        verbose_name = "Bayi Segmenti"
        verbose_name_plural = "Bayi Segmentleri"

    def __str__(self):
        return self.name


class Product(models.Model):
    name = models.CharField(max_length=255, unique=True, verbose_name="Ürün Adı")
    slug = models.SlugField(max_length=255, unique=True, verbose_name="Slug", blank=True)
    description = models.TextField(null=True, blank=True, verbose_name="Ürün Açıklaması")
    serviceDuration = models.PositiveIntegerField(verbose_name="Hizmet Süresi (Ay)")
    price = models.DecimalField(max_digits=10, decimal_places=2, verbose_name="Ürün Fiyatı")
    isActive = models.BooleanField(default=True, verbose_name="Aktif")
    createDate = models.DateTimeField(auto_now_add=True, verbose_name="Oluşturulma Tarihi")
    updateDate = models.DateTimeField(auto_now=True, verbose_name="Güncellenme Tarihi")

    class Meta:
        verbose_name = "Ürün"
        verbose_name_plural = "Ürünler"

    def __str__(self):
        return self.name

    def save(self, *args, **kwargs):
        if not self.slug:
            self.slug = slugify(self.name)
        super(Product, self).save(*args, **kwargs)


class Campaign(models.Model):
    name = models.CharField(max_length=255, verbose_name="Kampanya Adı")
    description = models.TextField(null=True, blank=True, verbose_name="Kampanya Açıklaması")
    start_date = models.DateTimeField(verbose_name="Başlangıç Tarihi", default=timezone.now)
    end_date = models.DateTimeField(verbose_name="Bitiş Tarihi", null=True, blank=True)
    products = models.ManyToManyField(Product, blank=True, related_name='campaigns', verbose_name="Ürünler")
    is_active = models.BooleanField(default=True, verbose_name="Aktif")

    class Meta:
        verbose_name = "Kampanya"
        verbose_name_plural = "Kampanyalar"

    def __str__(self):
        return self.name


class ConditionType(models.Model):
    code = models.CharField(max_length=50, unique=True, verbose_name="Koşul Kodu")
    name = models.CharField(max_length=100, verbose_name="Koşul Adı")
    description = models.TextField(null=True, blank=True, verbose_name="Koşul Açıklaması")

    class Meta:
        verbose_name = "Koşul Tipi"
        verbose_name_plural = "Koşul Tipleri"

    def __str__(self):
        return f"{self.code} - {self.name}"


class ActionType(models.Model):
    code = models.CharField(max_length=50, unique=True, verbose_name="Aksiyon Kodu")
    name = models.CharField(max_length=100, verbose_name="Aksiyon Adı")
    description = models.TextField(null=True, blank=True, verbose_name="Aksiyon Açıklaması")

    class Meta:
        verbose_name = "Aksiyon Tipi"
        verbose_name_plural = "Aksiyon Tipleri"

    def __str__(self):
        return f"{self.code} - {self.name}"


class Condition(models.Model):
    campaign = models.ForeignKey(Campaign, on_delete=models.CASCADE, related_name='conditions', verbose_name="Kampanya")
    condition_type = models.ForeignKey(ConditionType, on_delete=models.PROTECT, related_name='conditions', verbose_name="Koşul Tipi")
    params = models.JSONField(default=dict, blank=True, verbose_name="Koşul Parametreleri")
    user_segment = models.ForeignKey(UserSegment, null=True, blank=True, on_delete=models.SET_NULL, verbose_name="Kullanıcı Segmenti")
    dealer_segment = models.ForeignKey(DealerSegment, null=True, blank=True, on_delete=models.SET_NULL, verbose_name="Bayi Segmenti")

    class Meta:
        verbose_name = "Koşul"
        verbose_name_plural = "Koşullar"

    def __str__(self):
        return f"{self.campaign.name} - {self.condition_type.name}"


class Action(models.Model):
    campaign = models.ForeignKey(Campaign, on_delete=models.CASCADE, related_name='actions', verbose_name="Kampanya")
    action_type = models.ForeignKey(ActionType, on_delete=models.PROTECT, related_name='actions', verbose_name="Aksiyon Tipi")
    params = models.JSONField(default=dict, blank=True, verbose_name="Aksiyon Parametreleri")

    class Meta:
        verbose_name = "Aksiyon"
        verbose_name_plural = "Aksiyonlar"

    def __str__(self):
        return f"{self.campaign.name} - {self.action_type.name}"
Yeni Koşul ve Aksiyon Tipleri Tanımlama
ConditionType tablosuna bayi ile ilgili iki örnek koşul ekleyebiliriz:

USER_IS_DEALER: Kullanıcı bir bayi ise koşul sağlanır.
DEALER_SEGMENT: Kullanıcının belirli bir bayi segmentinde olması durumunda koşul sağlanır.
Örneğin:

python
Kodu kopyala
ConditionType.objects.create(
    code="USER_IS_DEALER",
    name="Kullanıcı Bayi Mi?",
    description="Kullanıcı bir bayiyse bu koşul geçerlidir."
)

ConditionType.objects.create(
    code="DEALER_SEGMENT",
    name="Belirli Bayi Segmenti",
    description="Kullanıcının belirli bir bayi segmentine dahil olması durumunda geçerli."
)
Aksiyon tipleri tarafında bayilere özel bir iskonto eklemek için, var olan DISCOUNT_PERCENT aksiyonunu kullanabilir veya yeni bir aksiyon tipi oluşturabilirsiniz (örn: DEALER_EXTRA_DISCOUNT):

python
Kodu kopyala
ActionType.objects.create(
    code="DEALER_EXTRA_DISCOUNT",
    name="Bayiye Ekstra İskonto",
    description="Bayilere ekstra yüzdesel iskonto uygular."
)
Kullanım Örnekleri
Tüm Bayilere %5 Ekstra İndirim Kampanyası:

Önce USER_IS_DEALER koşulu ile bir kampanya oluşturalım:

python
Kodu kopyala
c = Campaign.objects.create(name="Bayi Özel Ekstra İndirim", description="Tüm bayilere %5 ekstra indirim", is_active=True)

user_is_dealer_condition_type = ConditionType.objects.get(code="USER_IS_DEALER")
Condition.objects.create(
    campaign=c,
    condition_type=user_is_dealer_condition_type
)

dealer_extra_discount_action_type = ActionType.objects.get(code="DEALER_EXTRA_DISCOUNT")
Action.objects.create(
    campaign=c,
    action_type=dealer_extra_discount_action_type,
    params={"percentage": 5}  # %5 ekstra indirim
)
Bu kampanya yalnızca CustomUser.isDealer == True olan kullanıcılar için geçerli olacak ve %5 ekstra indirim uygulayacaktır.

Belirli Bir Bayi Segmentine %10 İndirim + Hediye Modül Kampanyası:

Bir bayi segmenti oluşturalım:

python
Kodu kopyala
gold_segment = DealerSegment.objects.create(name="Gold Bayi", description="Gold seviye bayiler")
Kampanya oluşturalım:

python
Kodu kopyala
c2 = Campaign.objects.create(name="Gold Bayilere Özel Kampanya", description="Gold bayilere %10 indirim ve hediye modül", is_active=True)

dealer_segment_condition_type = ConditionType.objects.get(code="DEALER_SEGMENT")
Condition.objects.create(
    campaign=c2,
    condition_type=dealer_segment_condition_type,
    dealer_segment=gold_segment
)

discount_action_type = ActionType.objects.get(code="DISCOUNT_PERCENT")
Action.objects.create(
    campaign=c2,
    action_type=discount_action_type,
    params={"percentage": 10}  # %10 indirim
)

# Hediye modül aksiyonu varsayalım ki ADD_CONTENT veya GIFT_PRODUCT şeklinde olsun:
gift_action_type = ActionType.objects.get(code="GIFT_PRODUCT")
Action.objects.create(
    campaign=c2,
    action_type=gift_action_type,
    params={"product_id": 3, "quantity": 1}  # ID=3 olan üründen 1 adet hediye
)
Bu kampanya yalnızca Gold Bayi segmentine dahil olan bayiler için geçerli olur, koşullar sağlandığında %10 indirim ve hediye ürün eklenir.

Özet
CustomUser üzerinden isDealer alanını kullanarak bayileri ayırt edebilirsiniz.
DealerSegment modeli ile bayileri kategorize edebilir, segment bazlı kampanyalar yaratabilirsiniz.
ConditionType tablosuna USER_IS_DEALER ve DEALER_SEGMENT gibi yeni kayıtlar ekleyerek bayi temelli koşullar ekleyebilirsiniz.
ActionType ile bayilere özgü yeni aksiyon tipleri tanımlayabilir veya mevcut aksiyon tiplerini kullanabilirsiniz.
Böylece aynı esnek kampanya motoru hem normal kullanıcılar hem de bayiler için özelleştirilmiş kampanyaların yönetilmesine olanak tanır.




Şunu dedin:
bu modelleri beğendim teşekküler ancak bir isteğim daha var verdiğin modellerle bayilere yönelik hedef verip hedefe kredi kazanma kampanyası yapabilirmiyim örneğin belirli bir sürede 6 ay bir ay veya bir yıl belirli satış rakamına ulaşan bayiler belirlenen kredileri kazanmalılır birden fazla barem olacak her bayi ye özel baremler verebilirim ayrıca son kullnıcılar için kupon kodu tanımlayabilirim
ChatGPT
Request for o1 pro mode
Düşünme sona erdi
Aşağıda, daha önce oluşturduğumuz modele ek olarak bayilere hedef vermek, hedefi tutturan bayilere kredi sağlamak, birden fazla barem belirlemek ve son kullanıcılar için kupon kodu tanımlamak üzere yapıyı genişleten bir örnek yer almaktadır. Bu yapı, esnek bir kampanya ve hedeflendirme sistemini destekler.

Temel Yaklaşım
Bayi Hedef Kampanyaları (Dealer Targets):

Bayilere belirli bir dönem (1 ay, 6 ay, 1 yıl gibi) için satış hedefleri konulabilir.
Hedef, adet ya da ciro bazlı olabilir. (Örnek: "6 ay içinde 100.000 TL satış yap" veya "1 ayda 50 adet ürün sat")
Her hedef kampanyasında birden fazla barem olabilir. Baremler farklı hedef seviyelerini (örneğin 50.000 TL için 100 kredi, 100.000 TL için 250 kredi gibi) tanımlar.
Dönem sonunda bayinin performansı ölçülerek ilgili baremdeki kredi ödülü verilir. Bu işlem koşul-aksiyon mekanizmasından farklı, daha çok raporlama, cron job veya manuel kontrol sonrası uygulanabilir.
Kupon Kodları (Coupons):

Son kullanıcılar için indirim, hediye, özel fiyat vb. sağlayan kupon modelleri eklenebilir.
Kupon kodu tek başına bir kampanya özelliği gibi düşünülebilir veya mevcut kampanya yapısına entegre edilebilir.
Kupon, kullanım limiti, geçerlilik tarihi, belirli ürünlerde geçerli olma, belirli kullanıcı segmentlerinde geçerli olma gibi özellikleri tutabilir.
Aşağıdaki modeller, daha önce verdiğimiz modeli olduğu gibi koruyup üzerine DealerTarget ve Coupon modellerini eklemektedir.

Güncellenmiş Modeller
python
Kodu kopyala
from django.db import models
from django.utils import timezone
from django.utils.text import slugify
from django.contrib.auth.models import AbstractUser


class CustomUser(AbstractUser):
    isDealer = models.BooleanField(default=False, verbose_name='Bayi Mi?')
    dealer_segment = models.ForeignKey('DealerSegment', null=True, blank=True, on_delete=models.SET_NULL, verbose_name="Bayi Segmenti")


class UserSegment(models.Model):
    name = models.CharField(max_length=100, unique=True, verbose_name="Segment Adı")
    description = models.TextField(null=True, blank=True, verbose_name="Segment Açıklaması")

    class Meta:
        verbose_name = "Kullanıcı Segmenti"
        verbose_name_plural = "Kullanıcı Segmentleri"

    def __str__(self):
        return self.name


class DealerSegment(models.Model):
    name = models.CharField(max_length=100, unique=True, verbose_name="Bayi Segmenti Adı")
    description = models.TextField(null=True, blank=True, verbose_name="Bayi Segmenti Açıklaması")

    class Meta:
        verbose_name = "Bayi Segmenti"
        verbose_name_plural = "Bayi Segmentleri"

    def __str__(self):
        return self.name


class Product(models.Model):
    name = models.CharField(max_length=255, unique=True, verbose_name="Ürün Adı")
    slug = models.SlugField(max_length=255, unique=True, verbose_name="Slug", blank=True)
    description = models.TextField(null=True, blank=True, verbose_name="Ürün Açıklaması")
    serviceDuration = models.PositiveIntegerField(verbose_name="Hizmet Süresi (Ay)")
    price = models.DecimalField(max_digits=10, decimal_places=2, verbose_name="Ürün Fiyatı")
    isActive = models.BooleanField(default=True, verbose_name="Aktif")
    createDate = models.DateTimeField(auto_now_add=True, verbose_name="Oluşturulma Tarihi")
    updateDate = models.DateTimeField(auto_now=True, verbose_name="Güncellenme Tarihi")

    class Meta:
        verbose_name = "Ürün"
        verbose_name_plural = "Ürünler"

    def __str__(self):
        return self.name

    def save(self, *args, **kwargs):
        if not self.slug:
            self.slug = slugify(self.name)
        super(Product, self).save(*args, **kwargs)


class Campaign(models.Model):
    name = models.CharField(max_length=255, verbose_name="Kampanya Adı")
    description = models.TextField(null=True, blank=True, verbose_name="Kampanya Açıklaması")
    start_date = models.DateTimeField(verbose_name="Başlangıç Tarihi", default=timezone.now)
    end_date = models.DateTimeField(verbose_name="Bitiş Tarihi", null=True, blank=True)
    products = models.ManyToManyField(Product, blank=True, related_name='campaigns', verbose_name="Ürünler")
    is_active = models.BooleanField(default=True, verbose_name="Aktif")

    class Meta:
        verbose_name = "Kampanya"
        verbose_name_plural = "Kampanyalar"

    def __str__(self):
        return self.name


class ConditionType(models.Model):
    code = models.CharField(max_length=50, unique=True, verbose_name="Koşul Kodu")
    name = models.CharField(max_length=100, verbose_name="Koşul Adı")
    description = models.TextField(null=True, blank=True, verbose_name="Koşul Açıklaması")

    class Meta:
        verbose_name = "Koşul Tipi"
        verbose_name_plural = "Koşul Tipleri"

    def __str__(self):
        return f"{self.code} - {self.name}"


class ActionType(models.Model):
    code = models.CharField(max_length=50, unique=True, verbose_name="Aksiyon Kodu")
    name = models.CharField(max_length=100, verbose_name="Aksiyon Adı")
    description = models.TextField(null=True, blank=True, verbose_name="Aksiyon Açıklaması")

    class Meta:
        verbose_name = "Aksiyon Tipi"
        verbose_name_plural = "Aksiyon Tipleri"

    def __str__(self):
        return f"{self.code} - {self.name}"


class Condition(models.Model):
    campaign = models.ForeignKey(Campaign, on_delete=models.CASCADE, related_name='conditions', verbose_name="Kampanya")
    condition_type = models.ForeignKey(ConditionType, on_delete=models.PROTECT, related_name='conditions', verbose_name="Koşul Tipi")
    params = models.JSONField(default=dict, blank=True, verbose_name="Koşul Parametreleri")
    user_segment = models.ForeignKey(UserSegment, null=True, blank=True, on_delete=models.SET_NULL, verbose_name="Kullanıcı Segmenti")
    dealer_segment = models.ForeignKey(DealerSegment, null=True, blank=True, on_delete=models.SET_NULL, verbose_name="Bayi Segmenti")

    class Meta:
        verbose_name = "Koşul"
        verbose_name_plural = "Koşullar"

    def __str__(self):
        return f"{self.campaign.name} - {self.condition_type.name}"


class Action(models.Model):
    campaign = models.ForeignKey(Campaign, on_delete=models.CASCADE, related_name='actions', verbose_name="Kampanya")
    action_type = models.ForeignKey(ActionType, on_delete=models.PROTECT, related_name='actions', verbose_name="Aksiyon Tipi")
    params = models.JSONField(default=dict, blank=True, verbose_name="Aksiyon Parametreleri")

    class Meta:
        verbose_name = "Aksiyon"
        verbose_name_plural = "Aksiyonlar"

    def __str__(self):
        return f"{self.campaign.name} - {self.action_type.name}"


### Bayi Hedef Kampanyaları (DealerTarget)
class DealerTargetCampaign(models.Model):
    """
    Bayilere yönelik hedef kampanyalarının tanımlanması.
    Örneğin: "2024 İlk Yarı Bayi Satış Hedefi"
    """
    name = models.CharField(max_length=255, verbose_name="Hedef Kampanya Adı")
    description = models.TextField(null=True, blank=True, verbose_name="Açıklama")
    start_date = models.DateTimeField(default=timezone.now, verbose_name="Başlangıç Tarihi")
    end_date = models.DateTimeField(null=True, blank=True, verbose_name="Bitiş Tarihi")
    is_active = models.BooleanField(default=True, verbose_name="Aktif")

    class Meta:
        verbose_name = "Bayi Hedef Kampanyası"
        verbose_name_plural = "Bayi Hedef Kampanyaları"

    def __str__(self):
        return self.name


class DealerTargetThreshold(models.Model):
    """
    Bir hedef kampanyası içinde birden fazla barem olabilir.
    Örneğin:
    - 50.000 TL satış => 100 kredi
    - 100.000 TL satış => 250 kredi
    """
    target_campaign = models.ForeignKey(DealerTargetCampaign, on_delete=models.CASCADE, related_name='thresholds', verbose_name="Hedef Kampanyası")
    min_sales_amount = models.DecimalField(max_digits=12, decimal_places=2, verbose_name="Minimum Satış Tutarı")
    credit_reward = models.PositiveIntegerField(verbose_name="Kredi Ödülü")

    class Meta:
        verbose_name = "Bayi Hedef Barem"
        verbose_name_plural = "Bayi Hedef Baremleri"
        ordering = ['min_sales_amount']

    def __str__(self):
        return f"{self.target_campaign.name} - {self.min_sales_amount} için {self.credit_reward} kredi"


class DealerTargetAssignment(models.Model):
    """
    Her bayiye, belirli bir hedef kampanyası için özel baremler atayabilirsiniz.
    Bu sayede aynı hedef kampanyası farklı bayilere farklı baremlerle uygulanabilir.
    Kullanım opsiyoneldir: Eğer tüm bayiler aynı baremleri paylaşacaksa bu tabloyu kullanmaya gerek olmayabilir.
    """
    dealer = models.ForeignKey(CustomUser, on_delete=models.CASCADE, limit_choices_to={'isDealer': True}, verbose_name="Bayi")
    target_campaign = models.ForeignKey(DealerTargetCampaign, on_delete=models.CASCADE, verbose_name="Hedef Kampanyası")
    # Eğer her bayiye özel ek baremler vermek isterseniz separate tablo tutabilir veya params ile yönetebilirsiniz.
    params = models.JSONField(default=dict, blank=True, verbose_name="Ek Parametreler")

    class Meta:
        verbose_name = "Bayi Hedef Atama"
        verbose_name_plural = "Bayi Hedef Atamaları"

    def __str__(self):
        return f"{self.dealer.username} - {self.target_campaign.name}"


### Kupon Kodları (Coupons)
class Coupon(models.Model):
    code = models.CharField(max_length=50, unique=True, verbose_name="Kupon Kodu")
    description = models.TextField(null=True, blank=True, verbose_name="Açıklama")
    discount_type = models.CharField(max_length=20, choices=[('percent', 'Yüzde'), ('fixed', 'Sabit')], verbose_name="İndirim Tipi")
    discount_value = models.DecimalField(max_digits=10, decimal_places=2, verbose_name="İndirim Değeri")
    start_date = models.DateTimeField(default=timezone.now, verbose_name="Başlangıç Tarihi")
    end_date = models.DateTimeField(null=True, blank=True, verbose_name="Bitiş Tarihi")
    usage_limit = models.PositiveIntegerField(null=True, blank=True, verbose_name="Kullanım Limiti")
    used_count = models.PositiveIntegerField(default=0, verbose_name="Kullanım Sayısı")
    user_segment = models.ForeignKey(UserSegment, null=True, blank=True, on_delete=models.SET_NULL, verbose_name="Kullanıcı Segmenti")
    dealer_segment = models.ForeignKey(DealerSegment, null=True, blank=True, on_delete=models.SET_NULL, verbose_name="Bayi Segmenti")
    products = models.ManyToManyField(Product, blank=True, verbose_name="Geçerli Ürünler")
    is_active = models.BooleanField(default=True, verbose_name="Aktif")

    class Meta:
        verbose_name = "Kupon"
        verbose_name_plural = "Kuponlar"

    def __str__(self):
        return self.code

    def is_valid(self, user=None):
        """
        Kuponun geçerli olup olmadığını kontrol edebileceğiniz basit bir metot.
        Tarih, kullanım limiti, kullanıcı segmenti vb. kontrolü burada yapılabilir.
        """
        now = timezone.now()
        if self.is_active is False:
            return False
        if self.start_date and now < self.start_date:
            return False
        if self.end_date and now > self.end_date:
            return False
        if self.usage_limit and self.used_count >= self.usage_limit:
            return False
        
        # Kullanıcı segment kontrolü
        if user and not user.isDealer and self.user_segment:
            # Burada kullanıcı ilgili segmentte mi kontrol edebiliriz.
            # Segment logicini siz belirleyebilirsiniz.
            pass

        # Bayi segment kontrolü
        if user and user.isDealer and self.dealer_segment:
            # Kullanıcı bayiyse ve kupon bayilere özel bir segmente aitse
            if user.dealer_segment != self.dealer_segment:
                return False

        return True
Açıklamalar
DealerTargetCampaign & DealerTargetThreshold:
Bu modellerle bayilere dönemsel hedefler koyabilirsiniz. DealerTargetCampaign bir kampanyayı (örneğin 6 aylık satış hedefi) temsil ederken, DealerTargetThreshold bu kampanyadaki baremleri temsil eder (farklı satış seviyelerine göre farklı kredi ödülleri).

DealerTargetAssignment:
Tüm bayilere aynı baremleri uygulamak yerine her bayiye özel hedef parametreleri vermek isterseniz bu tabloyu kullanabilirsiniz. Bu tablo, belirli bir bayiye belirli bir hedef kampanyasını özel parametrelerle atar.

Coupon (Kupon Modeli):
Son kullanıcılara veya bayilere özel kupon kodları tanımlayabilirsiniz. Bu kuponlar belirli segmentlere, ürünlere ve tarihlere göre kısıtlanabilir. is_valid metodu ile kuponun geçerliliğini dinamik olarak kontrol edebilirsiniz.

Hedef kampanyalar, gerçek zamanlı koşul-aksiyon mantığından biraz farklı çalışır. Genellikle bu tip hedefler belirli bir dönem sonunda değerlendirilir ve ilgili krediler manuel veya zamanlanmış bir görev (cron job, Celery task vb.) ile kullanıcı hesaplarına işlenir. Bu nedenle DealerTargetCampaign ve DealerTargetThreshold modellerinin işleyişi koşul-aksiyon sisteminden ayrı olabilir.

Kuponlar ise ödeme veya sepet aşamasında gerçek zamanlı olarak kontrol edilebilir. Koşullar ve aksiyonlar ile benzer mantıkta çalışır, ancak kupon kodu kullanıcının girdiği bir değere göre tetiklenir.

Örnek Senaryolar
Bayi Hedefi Belirleme:

"2024 İlk Yarı Bayi Satış Hedefi" kampanyası oluşturun. (6 ay süreli)
Bu kampanyaya iki barem ekleyin:
50.000 TL için 100 kredi
100.000 TL için 250 kredi
Kampanya bittiğinde her bayinin satış raporuna bakarak hangi bareme ulaştığını belirleyin ve krediyi bayinin hesabına (örneğin params={"credit": 250} gibi bir alan üzerinden ya da ayrı bir model ile) ekleyin.
Bayilere Özel Kupon:

"GOLD" bayilere özel %10 indirim veren bir kupon oluşturun.
python
Kodu kopyala
gold_segment = DealerSegment.objects.get(name="Gold Bayi")
Coupon.objects.create(
    code="GOLD10",
    discount_type="percent",
    discount_value=10,
    dealer_segment=gold_segment,
    is_active=True
)
Sadece Gold bayiler bu kuponu kullanabildiğinden is_valid kontrolü sırasında user.dealer_segment == gold_segment şartı sağlanırsa kupon geçerli olur.
Son Kullanıcı Segmentine Kupon:

"Yeni Kullanıcı" segmentine özel 50 TL sabit indirimli kupon:
python
Kodu kopyala
user_segment = UserSegment.objects.get(name="Yeni Kullanıcı")
Coupon.objects.create(
    code="WELCOME50",
    discount_type="fixed",
    discount_value=50,
    user_segment=user_segment,
    is_active=True
)
Sonuç: Bu güncellenmiş yapıyla:

Bayilere dönemsel hedef kampanyaları ve bu hedeflere bağlı kredi ödülleri tanımlayabilir,
Birden fazla baremle esnek bir hedef ödüllendirme sistemi kurabilir,
Hem bayiler hem de son kullanıcılar için segmentlere, ürünlere ve dönemlere bağlı kupon kodları yönetebilirsiniz.
Bu esnek yapı, projenizin gereksinimlerine göre rahatça genişletilebilir ve özelleştirilebilir.





Şunu dedin:
bu modellere ait ekleme yaptığımız modelleri hariç tutarak admin.py kodlarını açıklamlarla help text ler ile admin paneline giren bir kullanıcıya yol gösterecek şekilde ver
ChatGPT
Request for o1 pro mode
Düşünme sona erdi
Aşağıda admin.py dosyası için bir örnek yer almaktadır. Bu örnekte, daha önce oluşturduğumuz modellerden yeni eklediğimiz DealerTargetCampaign, DealerTargetThreshold, DealerTargetAssignment ve Coupon hariç kalanları Django Admin arayüzünde nasıl yöneteceğinize dair bir yapı sunulmuştur. Kod içinde her Admin sınıfında ve bazı alanlarda help_text kullanımları ve açıklamalar eklenerek, admin paneline giren kişilere rehberlik sağlanmıştır.

Bu örnek, CustomUser, UserSegment, DealerSegment, Product, Campaign, ConditionType, ActionType, Condition, Action modellerini temel alır. Geliştirirken projedeki model import yollarını kendinize göre uyarlamayı unutmayın.

admin.py Örneği
python
Kodu kopyala
from django.contrib import admin
from django import forms
from .models import (
    CustomUser,
    UserSegment,
    DealerSegment,
    Product,
    Campaign,
    ConditionType,
    ActionType,
    Condition,
    Action
)

# Örnek: CustomUser için bir admin formu, burada kullanıcıya 'isDealer' alanı hakkında bilgilendirici help_text verebiliriz.
class CustomUserAdminForm(forms.ModelForm):
    class Meta:
        model = CustomUser
        fields = '__all__'
        help_texts = {
            'isDealer': "Bu kullanıcı bir bayiyse işaretleyin. Bayilere özel kampanyalar ve ek iskontolar uygulanabilir.",
            'dealer_segment': "Bayiyi hangi bayi segmentine dahil etmek istediğinizi seçin. Segmentler, özel fiyatlandırma ve kampanyalar için kullanılır.",
        }

@admin.register(CustomUser)
class CustomUserAdmin(admin.ModelAdmin):
    """
    CustomUser modelinin admin panelindeki görünümü.
    Bu sayede kullanıcıları eklerken veya düzenlerken bayi bilgilerini,
    segmentlerini belirleyebilirsiniz.
    """
    form = CustomUserAdminForm
    list_display = ('username', 'email', 'isDealer', 'dealer_segment', 'is_staff', 'is_active')
    list_filter = ('isDealer', 'dealer_segment', 'is_staff', 'is_active')
    search_fields = ('username', 'email')
    fieldsets = (
        (None, {
            'fields': ('username', 'password'),
            'description': "Temel kullanıcı adı ve parola ayarları."
        }),
        ("Kişisel Bilgiler", {
            'fields': ('first_name', 'last_name', 'email'),
            'description': "Kullanıcının temel iletişim bilgilerini girin."
        }),
        ("Bayi Bilgileri", {
            'fields': ('isDealer', 'dealer_segment'),
            'description': "Eğer kullanıcı bir bayiyse işaretleyin ve uygun bayi segmentini seçin."
        }),
        ("İzinler ve Durum", {
            'fields': ('is_active', 'is_staff', 'is_superuser', 'groups', 'user_permissions'),
            'description': "Kullanıcının yetkilerini, gruplarını ve izinlerini belirleyin."
        }),
        ("Önemli Tarihler", {
            'fields': ('last_login', 'date_joined'),
        }),
    )


@admin.register(UserSegment)
class UserSegmentAdmin(admin.ModelAdmin):
    """
    Kullanıcı segmentlerinin yönetimi. Burada kullanıcı gruplarını tanımlayabilir,
    belirli kampanyaları bu segmentlere uygulayabilirsiniz.
    """
    list_display = ('name', 'description')
    search_fields = ('name',)
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Bu segmenti kullanıcılar için etiketleyin. Örneğin 'Yeni Kullanıcı', 'Sadık Müşteri' vb."
        }),
    )


@admin.register(DealerSegment)
class DealerSegmentAdmin(admin.ModelAdmin):
    """
    Bayi segmentlerini yönetin. Gold, Silver, Alt Bayi gibi kategoriler ekleyerek,
    kampanyaları bu segmentlere göre özelleştirebilirsiniz.
    """
    list_display = ('name', 'description')
    search_fields = ('name',)
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Bayi segment adını ve açıklamasını girin. Örneğin 'Gold Bayi' veya 'Alt Bayi'."
        }),
    )


@admin.register(Product)
class ProductAdmin(admin.ModelAdmin):
    """
    Ürünlerin yönetimi. Buradan ürün adı, fiyatı ve hizmet süresini ayarlayabilirsiniz.
    Kampanyalar bu ürünler üzerinden kurgulanacaktır.
    """
    list_display = ('name', 'price', 'serviceDuration', 'isActive', 'createDate', 'updateDate')
    list_filter = ('isActive',)
    search_fields = ('name', 'description')
    readonly_fields = ('slug', 'createDate', 'updateDate')
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Ürünün temel bilgilerini girin. İsim ve açıklama kullanıcıların göreceği bilgilerdir."
        }),
        ("Fiyat & Süre", {
            'fields': ('serviceDuration', 'price', 'isActive'),
            'description': "Hizmet süresi (ay) ve fiyat bilgilerini girin. Ürün aktif değilse satışta görünmez."
        }),
        ("URL Bilgileri", {
            'fields': ('slug',),
            'description': "Ürünün URL yapısını otomatik oluşturur. Değiştirmeye gerek yok.",
        }),
        ("Tarih Bilgileri", {
            'fields': ('createDate', 'updateDate'),
            'description': "Oluşturulma ve güncellenme tarihleri otomatik olarak işlenir.",
        }),
    )


@admin.register(Campaign)
class CampaignAdmin(admin.ModelAdmin):
    """
    Kampanyaları yönetin. Kampanyalar, belirli tarih aralıklarında geçerli olabilir,
    belirli ürünlere uygulanabilir.
    """
    list_display = ('name', 'start_date', 'end_date', 'is_active')
    list_filter = ('is_active',)
    search_fields = ('name', 'description')
    filter_horizontal = ('products',)
    fieldsets = (
        (None, {
            'fields': ('name', 'description', 'is_active'),
            'description': "Kampanyanın adını ve açıklamasını girin. Aktif olunca kampanya devreye girer."
        }),
        ("Zaman Aralığı", {
            'fields': ('start_date', 'end_date'),
            'description': "Kampanyanın geçerli olacağı tarih aralığını belirleyin."
        }),
        ("Ürünler", {
            'fields': ('products',),
            'description': "Bu kampanyanın geçerli olacağı ürünleri seçin. Boş bırakırsanız tüm ürünler için koşullara göre uygulanabilir."
        }),
    )


@admin.register(ConditionType)
class ConditionTypeAdmin(admin.ModelAdmin):
    """
    Koşul tiplerini yönetin. Örneğin 'MIN_CART_TOTAL', 'FIRST_PURCHASE' gibi.
    Bu koşullar kampanyaların ne zaman geçerli olacağını belirler.
    """
    list_display = ('code', 'name', 'description')
    search_fields = ('code', 'name')
    fieldsets = (
        (None, {
            'fields': ('code', 'name', 'description'),
            'description': "Yeni bir koşul tipi tanımlarken kodunun benzersiz olmasına dikkat edin. Örn: 'USER_SEGMENT', 'PRODUCT_PURCHASED'."
        }),
    )


@admin.register(ActionType)
class ActionTypeAdmin(admin.ModelAdmin):
    """
    Aksiyon tiplerini yönetin. Örneğin 'DISCOUNT_PERCENT', 'GIFT_PRODUCT'.
    Bu aksiyonlar koşullar sağlandığında ne yapacağınızı belirler.
    """
    list_display = ('code', 'name', 'description')
    search_fields = ('code', 'name')
    fieldsets = (
        (None, {
            'fields': ('code', 'name', 'description'),
            'description': "Aksiyon tiplerinin kodlarının da benzersiz olması gerekir. Örn: 'DISCOUNT_FIXED', 'ADD_BACKLINK'."
        }),
    )


class ConditionInline(admin.TabularInline):
    """
    Kampanya sayfasında Conditions (Koşullar) inline olarak gösterilebilir.
    Bu sayede kampanya oluştururken doğrudan koşullar ekleyebilirsiniz.
    """
    model = Condition
    extra = 1
    verbose_name = "Koşul"
    verbose_name_plural = "Koşullar"
    help_text = "Bu kampanyanın hangi koşullarda geçerli olacağını belirleyin."


class ActionInline(admin.TabularInline):
    """
    Kampanya sayfasında Actions (Aksiyonlar) inline olarak gösterilebilir.
    Bu sayede kampanya oluştururken doğrudan aksiyonlar ekleyebilirsiniz.
    """
    model = Action
    extra = 1
    verbose_name = "Aksiyon"
    verbose_name_plural = "Aksiyonlar"
    help_text = "Koşullar sağlandığında ne yapılacağını belirleyin. Örn: %10 indirim, hediye ürün."


# Kampanya alanını koşul ve aksiyon inlinelar ile birlikte sunmak için CampaignAdmin'i yeniden tanımlayabilirsiniz.
@admin.register(Campaign)
class CampaignAdmin(admin.ModelAdmin):
    list_display = ('name', 'start_date', 'end_date', 'is_active')
    list_filter = ('is_active',)
    search_fields = ('name', 'description')
    filter_horizontal = ('products',)
    inlines = [ConditionInline, ActionInline]
    fieldsets = (
        (None, {
            'fields': ('name', 'description', 'is_active'),
            'description': "Kampanyanın adını ve açıklamasını girin. Aktif olunca kampanya devreye girer."
        }),
        ("Zaman Aralığı", {
            'fields': ('start_date', 'end_date'),
            'description': "Kampanyanın geçerli olacağı tarih aralığını belirleyin."
        }),
        ("Ürünler", {
            'fields': ('products',),
            'description': "Bu kampanyanın geçerli olacağı ürünleri seçin. Boş bırakırsanız tüm ürünler için geçerli olabilir."
        }),
    )


@admin.register(Condition)
class ConditionAdmin(admin.ModelAdmin):
    """
    Koşulları ayrı ayrı yönetmek isterseniz bu sayfadan da yapabilirsiniz.
    Normalde Condition'ları Campaign üzerinden inline olarak düzenlemek daha pratiktir.
    """
    list_display = ('campaign', 'condition_type', 'user_segment', 'dealer_segment')
    search_fields = ('campaign__name', 'condition_type__name')
    list_filter = ('condition_type', 'user_segment', 'dealer_segment')
    fieldsets = (
        (None, {
            'fields': ('campaign', 'condition_type', 'user_segment', 'dealer_segment', 'params'),
            'description': "Koşulun bağlı olduğu kampanyayı, koşul tipini ve segmentleri belirleyin. params ile ek kriterler tanımlayın."
        }),
    )


@admin.register(Action)
class ActionAdmin(admin.ModelAdmin):
    """
    Aksiyonları ayrı ayrı yönetmek isterseniz bu sayfadan da yapabilirsiniz.
    Normalde Action'ları Campaign üzerinden inline olarak düzenlemek daha pratiktir.
    """
    list_display = ('campaign', 'action_type')
    search_fields = ('campaign__name', 'action_type__name')
    list_filter = ('action_type',)
    fieldsets = (
        (None, {
            'fields': ('campaign', 'action_type', 'params'),
            'description': "Aksiyonun bağlı olduğu kampanyayı, aksiyon tipini seçin. params alanıyla ayrıntılı ayar yapın."
        }),
    )
Açıklamalar
Her Admin sınıfında fieldsets kullanarak bölümler oluşturduk, bu sayede admin panelinde düzenli bir görünüm sağladık.
description parametresi ile her fieldset için açıklama ekleyerek yöneticilere rehberlik sağladık.
help_texts üzerinden ek formlarda kullanıcıya rehberlik eden kısa açıklamalar ekledik (örneğin CustomUserAdminForm içinde).
Inline admin sınıfları (ConditionInline, ActionInline) ile Campaign modelinde doğrudan koşul ve aksiyon ekleme/çıkarma imkanı sağladık.
Bu sayede admin paneline giren bir kullanıcı, modelleri daha kolay anlayacak ve hangi alanların hangi amaçla kullanıldığını öğrenebilecektir.





Şunu dedin:
@admin.register(Campaign)
class CampaignAdmin(admin.ModelAdmin):

neden iki kere yazdın unuttuğun başka admin.py kodu olabilir mi?
ChatGPT
Request for o1 pro mode
Düşünme sona erdi
Haklısınız, önceki örnekte Campaign modeli için iki kez @admin.register(Campaign) kullandım. Bu gereksiz tekrar, kodda kafa karışıklığına neden olabilir. Aslında ikinci tanımda ConditionInline ve ActionInline eklemesi yaparken ilk tanımı iptal edip sadece tek bir CampaignAdmin tanımı yapmak yeterli. Lütfen aşağıdaki güncellenmiş admin.py örneğini dikkate alın. Bu örnekte Campaign modeli için tek bir admin sınıfı bulunur ve inline tanımlar doğrudan bu sınıf içerisinde kullanılır.

Güncellenmiş admin.py Örneği
python
Kodu kopyala
from django.contrib import admin
from django import forms
from .models import (
    CustomUser,
    UserSegment,
    DealerSegment,
    Product,
    Campaign,
    ConditionType,
    ActionType,
    Condition,
    Action
)

class CustomUserAdminForm(forms.ModelForm):
    class Meta:
        model = CustomUser
        fields = '__all__'
        help_texts = {
            'isDealer': "Bu kullanıcı bir bayiyse işaretleyin. Bayilere özel kampanyalar ve ek iskontolar uygulanabilir.",
            'dealer_segment': "Bayiyi hangi bayi segmentine dahil etmek istediğinizi seçin. Segmentler, özel fiyatlandırma ve kampanyalar için kullanılır.",
        }

@admin.register(CustomUser)
class CustomUserAdmin(admin.ModelAdmin):
    form = CustomUserAdminForm
    list_display = ('username', 'email', 'isDealer', 'dealer_segment', 'is_staff', 'is_active')
    list_filter = ('isDealer', 'dealer_segment', 'is_staff', 'is_active')
    search_fields = ('username', 'email')
    fieldsets = (
        (None, {
            'fields': ('username', 'password'),
            'description': "Temel kullanıcı adı ve parola ayarları."
        }),
        ("Kişisel Bilgiler", {
            'fields': ('first_name', 'last_name', 'email'),
            'description': "Kullanıcının temel iletişim bilgilerini girin."
        }),
        ("Bayi Bilgileri", {
            'fields': ('isDealer', 'dealer_segment'),
            'description': "Eğer kullanıcı bir bayiyse işaretleyin ve uygun bayi segmentini seçin."
        }),
        ("İzinler ve Durum", {
            'fields': ('is_active', 'is_staff', 'is_superuser', 'groups', 'user_permissions'),
            'description': "Kullanıcının yetkilerini, gruplarını ve izinlerini belirleyin."
        }),
        ("Önemli Tarihler", {
            'fields': ('last_login', 'date_joined'),
        }),
    )


@admin.register(UserSegment)
class UserSegmentAdmin(admin.ModelAdmin):
    list_display = ('name', 'description')
    search_fields = ('name',)
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Bu segmenti kullanıcılar için etiketleyin. Örneğin 'Yeni Kullanıcı', 'Sadık Müşteri' vb."
        }),
    )


@admin.register(DealerSegment)
class DealerSegmentAdmin(admin.ModelAdmin):
    list_display = ('name', 'description')
    search_fields = ('name',)
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Bayi segment adını ve açıklamasını girin. Örneğin 'Gold Bayi' veya 'Alt Bayi'."
        }),
    )


@admin.register(Product)
class ProductAdmin(admin.ModelAdmin):
    list_display = ('name', 'price', 'serviceDuration', 'isActive', 'createDate', 'updateDate')
    list_filter = ('isActive',)
    search_fields = ('name', 'description')
    readonly_fields = ('slug', 'createDate', 'updateDate')
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Ürünün temel bilgilerini girin. İsim ve açıklama kullanıcıların göreceği bilgilerdir."
        }),
        ("Fiyat & Süre", {
            'fields': ('serviceDuration', 'price', 'isActive'),
            'description': "Hizmet süresi (ay) ve fiyat bilgilerini girin. Ürün aktif değilse satışta görünmez."
        }),
        ("URL Bilgileri", {
            'fields': ('slug',),
            'description': "Ürünün URL yapısını otomatik oluşturur. Değiştirmeye gerek yok.",
        }),
        ("Tarih Bilgileri", {
            'fields': ('createDate', 'updateDate'),
            'description': "Oluşturulma ve güncellenme tarihleri otomatik olarak işlenir.",
        }),
    )


class ConditionInline(admin.TabularInline):
    model = Condition
    extra = 1
    verbose_name = "Koşul"
    verbose_name_plural = "Koşullar"
    help_text = "Bu kampanyanın hangi koşullarda geçerli olacağını belirleyin. Örneğin belirli bir ürün alındığında veya belirli bir kullanıcı segmentine yönelik."


class ActionInline(admin.TabularInline):
    model = Action
    extra = 1
    verbose_name = "Aksiyon"
    verbose_name_plural = "Aksiyonlar"
    help_text = "Koşullar sağlandığında ne yapılacağını belirleyin. Örn: %10 indirim, hediye ürün."


@admin.register(Campaign)
class CampaignAdmin(admin.ModelAdmin):
    list_display = ('name', 'start_date', 'end_date', 'is_active')
    list_filter = ('is_active',)
    search_fields = ('name', 'description')
    filter_horizontal = ('products',)
    inlines = [ConditionInline, ActionInline]
    fieldsets = (
        (None, {
            'fields': ('name', 'description', 'is_active'),
            'description': "Kampanyanın adını ve açıklamasını girin. Aktif olunca kampanya devreye girer."
        }),
        ("Zaman Aralığı", {
            'fields': ('start_date', 'end_date'),
            'description': "Kampanyanın geçerli olacağı tarih aralığını belirleyin."
        }),
        ("Ürünler", {
            'fields': ('products',),
            'description': "Bu kampanyanın geçerli olacağı ürünleri seçin. Boş bırakırsanız tüm ürünler için geçerli olabilir."
        }),
    )


@admin.register(ConditionType)
class ConditionTypeAdmin(admin.ModelAdmin):
    list_display = ('code', 'name', 'description')
    search_fields = ('code', 'name')
    fieldsets = (
        (None, {
            'fields': ('code', 'name', 'description'),
            'description': "Yeni bir koşul tipi tanımlarken kodunun benzersiz olmasına dikkat edin. Örn: 'USER_SEGMENT', 'PRODUCT_PURCHASED'."
        }),
    )


@admin.register(ActionType)
class ActionTypeAdmin(admin.ModelAdmin):
    list_display = ('code', 'name', 'description')
    search_fields = ('code', 'name')
    fieldsets = (
        (None, {
            'fields': ('code', 'name', 'description'),
            'description': "Aksiyon tiplerinin kodlarının da benzersiz olması gerekir. Örn: 'DISCOUNT_FIXED', 'ADD_BACKLINK'."
        }),
    )


@admin.register(Condition)
class ConditionAdmin(admin.ModelAdmin):
    list_display = ('campaign', 'condition_type', 'user_segment', 'dealer_segment')
    search_fields = ('campaign__name', 'condition_type__name')
    list_filter = ('condition_type', 'user_segment', 'dealer_segment')
    fieldsets = (
        (None, {
            'fields': ('campaign', 'condition_type', 'user_segment', 'dealer_segment', 'params'),
            'description': "Koşulun bağlı olduğu kampanyayı, koşul tipini ve segmentleri belirleyin. params ile ek kriterler tanımlayın."
        }),
    )


@admin.register(Action)
class ActionAdmin(admin.ModelAdmin):
    list_display = ('campaign', 'action_type')
    search_fields = ('campaign__name', 'action_type__name')
    list_filter = ('action_type',)
    fieldsets = (
        (None, {
            'fields': ('campaign', 'action_type', 'params'),
            'description': "Aksiyonun bağlı olduğu kampanyayı, aksiyon tipini seçin. params alanıyla ayrıntılı ayar yapın."
        }),
    )
Özet: Bu güncellenmiş örnekte Campaign modeli için yalnızca bir kez @admin.register(Campaign) dekoratörü kullanılıyor. Inline modeller CampaignAdmin içerisine entegre edilerek, kampanya düzenleme sayfasında koşul ve aksiyonları ekleyip çıkarmak mümkün hale geliyor. Bu düzenleme ile tekrar eden CampaignAdmin tanımını ortadan kaldırdık.





Şunu dedin:
bu kodları eklediğim admin.py kodlarında çok fazla menü var yukarda verdiğin menülerin bir arada mümkünse ayrı bir bölümde durmasını istiyorum eğer birde bunları mümkünse kullnım hiyearşisine göre sıralarsan mükemel olur
ChatGPT
Request for o1 pro mode
Düşünme sona erdi
Aşağıdaki örnek, daha önce verdiğimiz admin yapılarını tek bir özel "Kampanya Yönetimi" başlığı altında toplayarak ve kullanım hiyerarşisine göre sıralayarak gösterir. Bu sayede admin panelinde çok fazla dağınık menü yerine, ilgili modelleri tek bir bölüm altında toplarız. Ayrıca hiyerarşi ile modelleri mantıksal bir sıraya koyabiliriz.

Önemli Not: Django varsayılan olarak modelleri kendi "app_label"ları altında gruplar. Burada aynı "app_label" altında olmayan modelleri bir araya getirmek veya sıralamak için bir kaç yöntem vardır:

Ayrı Bir App Açmak: Tüm bu modelleri tek bir uygulama (app) altına almak ve Meta app_label ayarlarını yapmak. Bu, projede yapısal değişiklik gerektirir.

Custom AdminSite ve get_app_list Override: Mevcut modelleri olduğu gibi kullanıp, özel bir AdminSite tanımlayarak get_app_list metodunu ezebilir, istediğimiz modelleri tek bir "sanal" uygulama altında toplayabilir, sıralamasını yapabiliriz.

Aşağıda 2. yöntemi kullanıyoruz. Bu yöntem mevcut kod yapısını bozmadan, sadece admin.py içinde özel bir admin site oluşturarak düzenleme yapmamızı sağlar.

Adımlar
Varsayılan admin.site yerine kendi AdminSite sınıfımızı oluşturuyoruz.
Tüm modelleri admin.register dekoratörü yerine my_admin_site.register ile kaydediyoruz.
get_app_list metodunu override ederek istediğimiz modelleri tek bir blok altında topluyor, hiyerarşik olarak sıralıyoruz.
Kod Örneği (admin.py)
python
Kodu kopyala
from django.contrib.admin import AdminSite
from django.contrib import admin
from .models import (
    CustomUser,
    UserSegment,
    DealerSegment,
    Product,
    Campaign,
    ConditionType,
    ActionType,
    Condition,
    Action
)
from .admin_original import (
    CustomUserAdmin,
    UserSegmentAdmin,
    DealerSegmentAdmin,
    ProductAdmin,
    CampaignAdmin,
    ConditionTypeAdmin,
    ActionTypeAdmin,
    ConditionAdmin,
    ActionAdmin
)
# Yukarıdaki admin_original dosyasında daha önce tanımladığınız admin sınıfları bulunuyor varsayalım.
# Eğer hepsi admin.py içinde ise, onları da bu dosyaya taşıyabilir veya aynı dosya içinde bırakabilirsiniz.
# Burada amaç kod fazlalığını önlemek ve sadece düzenleme mantığını göstermek.

class MyAdminSite(AdminSite):
    site_header = "Proje Yönetim Paneli"
    site_title = "Proje Admin"
    index_title = "Yönetim Ekranları"

    def get_app_list(self, request):
        # Orijinal app listesi
        app_list = super().get_app_list(request)

        # Kampanya ile ilgili modelleri tek bir grup altında toplamak istiyoruz.
        # Hangi modelleri gruplayacağız?
        campaign_models = {
            'Campaign', 'ConditionType', 'ActionType', 'Condition', 'Action', 'UserSegment', 'DealerSegment', 'Product'
        }

        # Bu grubu "Kampanya Yönetimi" adıyla tek bir sanal uygulama altında toplayacağız.
        campaign_app = {
            'app_label': 'camp_mgmt',
            'app_name': 'Kampanya Yönetimi',
            'name': 'Kampanya Yönetimi',
            'models': []
        }

        # Geri kalan modelleri orijinalinde tutacağız
        new_app_list = []

        # Orijinal app_list üzerinden geçerek campaign_models setinde olanları alıp campaign_app'e taşıyoruz
        for app in app_list:
            new_models = []
            for model in app['models']:
                if model['object_name'] in campaign_models:
                    campaign_app['models'].append(model)
                else:
                    new_models.append(model)
            if new_models:
                app['models'] = new_models
                new_app_list.append(app)

        # Şimdi campaign_app içerisindeki modelleri hiyerarşik sıraya koyuyoruz.
        # Örnek hiyerarşi:
        # 1. Campaign
        # 2. ConditionType
        # 3. ActionType
        # 4. Condition
        # 5. Action
        # 6. UserSegment
        # 7. DealerSegment
        # 8. Product
        hierarchy = ['Campaign', 'ConditionType', 'ActionType', 'Condition', 'Action', 'UserSegment', 'DealerSegment', 'Product']
        campaign_app['models'].sort(key=lambda m: hierarchy.index(m['object_name']) if m['object_name'] in hierarchy else 999)

        # campaign_app'i listenin başına ekliyoruz, böylece en üstte gözükür.
        new_app_list.insert(0, campaign_app)

        return new_app_list


# Kendi AdminSite örneğimizi oluşturalım
my_admin_site = MyAdminSite(name='myadmin')

# Şimdi tüm modellerimizi my_admin_site'ye register edelim:
my_admin_site.register(CustomUser, CustomUserAdmin)
my_admin_site.register(UserSegment, UserSegmentAdmin)
my_admin_site.register(DealerSegment, DealerSegmentAdmin)
my_admin_site.register(Product, ProductAdmin)
my_admin_site.register(Campaign, CampaignAdmin)
my_admin_site.register(ConditionType, ConditionTypeAdmin)
my_admin_site.register(ActionType, ActionTypeAdmin)
my_admin_site.register(Condition, ConditionAdmin)
my_admin_site.register(Action, ActionAdmin)

# Bu noktada urls.py içinde varsayılan admin.site yerine my_admin_site kullanmalısınız.
# Örneğin:
# from django.urls import path
# from .admin import my_admin_site
#
# urlpatterns = [
#     path('admin/', my_admin_site.urls),
# ]
Açıklamalar
MyAdminSite sınıfını yaratarak varsayılan admin.site yerine kendi admin sitemizi kullanıyoruz.
get_app_list metodunu override ederek modelleri dilediğimiz gibi gruplayıp sıralıyoruz.
campaign_models seti içinde belirlediğimiz modelleri "Kampanya Yönetimi" başlığı altında topluyor, diğer modelleri kendi gruplarında bırakıyoruz.
hierarchy listesiyle modelleri mantıksal bir sıraya sokuyoruz. Bu sayede admin paneline giren kullanıcı, kampanya ile ilgili modelleri bir arada ve anlamlı bir dizilimle görebilir.
Bu düzenleme ile artık admin panelinde çok sayıda menü yerine, "Kampanya Yönetimi" adı altında ilgili modelleri tek bir yerde görüp, geri kalan modelleri de kendi orijinal yerlerinde tutarak daha derli toplu bir arayüz elde edebilirsiniz.





Şunu dedin:
aşağıdaki kodları yukarda veridğin yapaıya göre düzenleyerek tam kodu ver

import os

from django import forms
from django.conf import settings
from django.contrib import admin
from django.contrib.admin.sites import AdminSite
from django.contrib.sites.models import Site
from django.urls import path
from django.utils.timezone import localtime

from .forms import CustomAdminAuthenticationForm
from .models import ExtendedSite
from .models import SiteUrun, WebServer, SqlServer, MailServer, DnsServer, \
    OperatingSystem, CustomSiteConfiguration, Blacklist, Menu, UserSite, CustomUser, UserSegment, \
    DealerSegment, Product, Campaign, ConditionType, ActionType, Condition, Action


class CustomAdminSite(AdminSite):
    login_form = CustomAdminAuthenticationForm


custom_admin_site = CustomAdminSite()

# Yönetim paneli URL'sini kullanacak şekilde güncelleyin


urlpatterns = [
    path('admin/', custom_admin_site.urls),
]

# Yönetim paneli başlıklarını settings.py'den alarak özelleştiriyoruz
admin.site.site_header = getattr(settings, 'ADMIN_SITE_HEADER', 'Django Yönetim Paneli')
admin.site.site_title = getattr(settings, 'ADMIN_SITE_TITLE', 'Django Yönetim Paneli')
admin.site.index_title = getattr(settings, 'ADMIN_INDEX_TITLE', 'Hoş Geldiniz!')


class CustomUserAdminForm(forms.ModelForm):
    class Meta:
        model = CustomUser
        fields = '__all__'
        help_texts = {
            'isDealer': "Bu kullanıcı bir bayiyse işaretleyin. Bayilere özel kampanyalar ve ek iskontolar uygulanabilir.",
            'dealer_segment': "Bayiyi hangi bayi segmentine dahil etmek istediğinizi seçin. Segmentler, özel fiyatlandırma ve kampanyalar için kullanılır.",
        }


@admin.register(CustomUser)
class CustomUserAdmin(admin.ModelAdmin):
    form = CustomUserAdminForm
    list_display = ('username', 'email', 'isDealer', 'dealer_segment', 'is_staff', 'is_active')
    list_filter = ('isDealer', 'dealer_segment', 'is_staff', 'is_active')
    search_fields = ('username', 'email')
    fieldsets = (
        (None, {
            'fields': ('username', 'password'),
            'description': "Temel kullanıcı adı ve parola ayarları."
        }),
        ("Kişisel Bilgiler", {
            'fields': ('first_name', 'last_name', 'email'),
            'description': "Kullanıcının temel iletişim bilgilerini girin."
        }),
        ("Bayi Bilgileri", {
            'fields': ('isDealer', 'dealer_segment'),
            'description': "Eğer kullanıcı bir bayiyse işaretleyin ve uygun bayi segmentini seçin."
        }),
        ("İzinler ve Durum", {
            'fields': ('is_active', 'is_staff', 'is_superuser', 'groups', 'user_permissions'),
            'description': "Kullanıcının yetkilerini, gruplarını ve izinlerini belirleyin."
        }),
        ("Önemli Tarihler", {
            'fields': ('last_login', 'date_joined'),
        }),
    )


@admin.register(UserSegment)
class UserSegmentAdmin(admin.ModelAdmin):
    list_display = ('name', 'description')
    search_fields = ('name',)
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Bu segmenti kullanıcılar için etiketleyin. Örneğin 'Yeni Kullanıcı', 'Sadık Müşteri' vb."
        }),
    )


@admin.register(DealerSegment)
class DealerSegmentAdmin(admin.ModelAdmin):
    list_display = ('name', 'description')
    search_fields = ('name',)
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Bayi segment adını ve açıklamasını girin. Örneğin 'Gold Bayi' veya 'Alt Bayi'."
        }),
    )


@admin.register(Product)
class ProductAdmin(admin.ModelAdmin):
    list_display = ('name', 'price', 'serviceDuration', 'isActive', 'createDate', 'updateDate')
    list_filter = ('isActive',)
    search_fields = ('name', 'description')
    readonly_fields = ('slug', 'createDate', 'updateDate')
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Ürünün temel bilgilerini girin. İsim ve açıklama kullanıcıların göreceği bilgilerdir."
        }),
        ("Fiyat & Süre", {
            'fields': ('serviceDuration', 'price', 'isActive'),
            'description': "Hizmet süresi (ay) ve fiyat bilgilerini girin. Ürün aktif değilse satışta görünmez."
        }),
        ("URL Bilgileri", {
            'fields': ('slug',),
            'description': "Ürünün URL yapısını otomatik oluşturur. Değiştirmeye gerek yok.",
        }),
        ("Tarih Bilgileri", {
            'fields': ('createDate', 'updateDate'),
            'description': "Oluşturulma ve güncellenme tarihleri otomatik olarak işlenir.",
        }),
    )


class ConditionInline(admin.TabularInline):
    model = Condition
    extra = 1
    verbose_name = "Koşul"
    verbose_name_plural = "Koşullar"
    help_text = "Bu kampanyanın hangi koşullarda geçerli olacağını belirleyin. Örneğin belirli bir ürün alındığında veya belirli bir kullanıcı segmentine yönelik."


class ActionInline(admin.TabularInline):
    model = Action
    extra = 1
    verbose_name = "Aksiyon"
    verbose_name_plural = "Aksiyonlar"
    help_text = "Koşullar sağlandığında ne yapılacağını belirleyin. Örn: %10 indirim, hediye ürün."


@admin.register(Campaign)
class CampaignAdmin(admin.ModelAdmin):
    list_display = ('name', 'start_date', 'end_date', 'is_active')
    list_filter = ('is_active',)
    search_fields = ('name', 'description')
    filter_horizontal = ('products',)
    inlines = [ConditionInline, ActionInline]
    fieldsets = (
        (None, {
            'fields': ('name', 'description', 'is_active'),
            'description': "Kampanyanın adını ve açıklamasını girin. Aktif olunca kampanya devreye girer."
        }),
        ("Zaman Aralığı", {
            'fields': ('start_date', 'end_date'),
            'description': "Kampanyanın geçerli olacağı tarih aralığını belirleyin."
        }),
        ("Ürünler", {
            'fields': ('products',),
            'description': "Bu kampanyanın geçerli olacağı ürünleri seçin. Boş bırakırsanız tüm ürünler için geçerli olabilir."
        }),
    )


@admin.register(ConditionType)
class ConditionTypeAdmin(admin.ModelAdmin):
    list_display = ('code', 'name', 'description')
    search_fields = ('code', 'name')
    fieldsets = (
        (None, {
            'fields': ('code', 'name', 'description'),
            'description': "Yeni bir koşul tipi tanımlarken kodunun benzersiz olmasına dikkat edin. Örn: 'USER_SEGMENT', 'PRODUCT_PURCHASED'."
        }),
    )


@admin.register(ActionType)
class ActionTypeAdmin(admin.ModelAdmin):
    list_display = ('code', 'name', 'description')
    search_fields = ('code', 'name')
    fieldsets = (
        (None, {
            'fields': ('code', 'name', 'description'),
            'description': "Aksiyon tiplerinin kodlarının da benzersiz olması gerekir. Örn: 'DISCOUNT_FIXED', 'ADD_BACKLINK'."
        }),
    )


@admin.register(Condition)
class ConditionAdmin(admin.ModelAdmin):
    list_display = ('campaign', 'condition_type', 'user_segment', 'dealer_segment')
    search_fields = ('campaign__name', 'condition_type__name')
    list_filter = ('condition_type', 'user_segment', 'dealer_segment')
    fieldsets = (
        (None, {
            'fields': ('campaign', 'condition_type', 'user_segment', 'dealer_segment', 'params'),
            'description': "Koşulun bağlı olduğu kampanyayı, koşul tipini ve segmentleri belirleyin. params ile ek kriterler tanımlayın."
        }),
    )


@admin.register(Action)
class ActionAdmin(admin.ModelAdmin):
    list_display = ('campaign', 'action_type')
    search_fields = ('campaign__name', 'action_type__name')
    list_filter = ('action_type',)
    fieldsets = (
        (None, {
            'fields': ('campaign', 'action_type', 'params'),
            'description': "Aksiyonun bağlı olduğu kampanyayı, aksiyon tipini seçin. params alanıyla ayrıntılı ayar yapın."
        }),
    )


class MenuAdminForm(forms.ModelForm):
    ROLE_CHOICES = [
        ("admin", "Admin"),
        ("manager", "Manager"),
        ("superuser", "Superuser"),
    ]

    roles = forms.MultipleChoiceField(
        choices=ROLE_CHOICES,
        widget=forms.CheckboxSelectMultiple,
        required=False,
        label="Roles"
    )

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        if isinstance(self.instance.roles, list):
            self.fields["roles"].initial = self.instance.roles

    def clean_roles(self):
        return self.cleaned_data.get("roles", [])

    class Meta:
        model = Menu
        fields = "__all__"


@admin.register(Menu)
class MenuAdmin(admin.ModelAdmin):
    form = MenuAdminForm
    list_display = (
        'title',
        'path',
        'icon',
        'caption',
        'parent',
        'product',
        'order',
        'is_superuser_only',
        'disabled',
        'external'
    )  # id list_display'den kaldırıldı
    search_fields = ('title', 'path', 'icon', 'caption')  # Arama alanları
    list_filter = ('parent', 'product', 'is_superuser_only', 'disabled', 'external')  # Filtreleme
    ordering = ('order',)  # Sıralama
    fieldsets = (
        (None, {
            'fields': (
                'title',
                'path',
                'icon',
                'caption',
                'parent',
                'product',
                'order'
            )
        }),
        ('Visibility & Access', {
            'fields': (
                'is_superuser_only',
                'roles',
                'disabled',
                'external'
            )
        }),
        ('Metadata', {
            'fields': ('info',)
        }),
    )


@admin.register(SiteUrun)
class SiteUrunAdmin(admin.ModelAdmin):
    list_display = ('site', 'urun_list', 'createdAt')
    search_fields = ('site__name', 'urun__name')
    list_filter = ('site',)
    filter_horizontal = ('urun',)

    def urun_list(self, obj):
        return ", ".join([urun.name for urun in obj.urun.all()])

    urun_list.short_description = "Ürünler"


def safe_remove(file_path):
    """
    Dosyayı güvenli bir şekilde siler. Dosya mevcut değilse hata vermez.
    """
    if os.path.exists(file_path):
        os.remove(file_path)
        print(f"Silindi: {file_path}")


class SiteAdminForm(forms.ModelForm):
    """
    Site admini için form.
    """
    is_active = forms.BooleanField(label="Aktif", required=False)
    is_our_site = forms.BooleanField(label="Bizim Sitemiz", required=False)
    is_default_site = forms.BooleanField(label="Varsayılan Site", required=False)
    show_popup_ad = forms.BooleanField(label="Pop-up Reklam Gösterimi", required=False)
    logo = forms.ImageField(label="Site Logosu", required=False)

    def clean_logo(self):
        """
        Admin panelinden 'logo' alanı temizlendiğinde fiziksel dosyayı da siler ve veritabanı kaydını temizler.
        """
        logo = self.cleaned_data.get("logo", None)

        # ExtendedSite ile bağlantılı olan logo alanını kontrol edin
        if self.instance.pk:
            extended_site = getattr(self.instance, "extended_site", None)
            if extended_site and not logo and extended_site.logo:
                # Logo temizlenmişse fiziksel dosyayı sil
                safe_remove(extended_site.logo.path)
                extended_site.logo = None  # Veritabanındaki logo alanını temizle
                extended_site.save()  # Değişiklikleri kaydet

        return logo

    class Meta:
        model = Site
        fields = "__all__"

    def clean_logo(self):
        """
        Admin panelinden 'logo' alanı temizlendiğinde fiziksel dosyayı da siler ve veritabanı kaydını temizler.
        """
        logo = self.cleaned_data.get("logo", None)

        # ExtendedSite ile bağlantılı olan logo alanını kontrol edin
        if self.instance.pk:
            extended_site = getattr(self.instance, "extended_site", None)
            if extended_site and not logo and extended_site.logo:
                # Logo temizlenmişse fiziksel dosyayı sil
                safe_remove(extended_site.logo.path)
                extended_site.logo = None  # Veritabanındaki logo alanını temizle
                extended_site.save()  # Değişiklikleri kaydet

        return logo

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        extended_site = getattr(self.instance, "extended_site", None)
        if extended_site:
            self.fields["is_active"].initial = extended_site.isActive
            self.fields["is_our_site"].initial = extended_site.isOurSite
            self.fields["is_default_site"].initial = extended_site.isDefault
            self.fields["show_popup_ad"].initial = extended_site.showPopupAd
            if extended_site.logo:
                self.fields["logo"].initial = extended_site.logo


class SiteAdmin(admin.ModelAdmin):
    """
    Site modeli için admin yapılandırması.
    """
    form = SiteAdminForm
    list_display = (
        "domain", "name", "is_active", "is_our_site", "is_default", "show_popup_ad",
        "formatted_created_at", "formatted_updated_at"  # Tarih alanları listede görünür
    )
    readonly_fields = ("formatted_created_at", "formatted_updated_at")  # Detay görünümünde yalnızca okunabilir alanlar
    search_fields = ("domain", "name")

    def is_active(self, obj):
        return getattr(obj.extended_site, "isActive", False)

    is_active.boolean = True
    is_active.short_description = "Aktif"

    def is_our_site(self, obj):
        return getattr(obj.extended_site, "isOurSite", False)

    is_our_site.boolean = True
    is_our_site.short_description = "Bizim Sitemiz"

    def is_default(self, obj):
        return getattr(obj.extended_site, "isDefault", False)

    is_default.boolean = True
    is_default.short_description = "Varsayılan Site"

    def show_popup_ad(self, obj):
        return getattr(obj.extended_site, "showPopupAd", False)

    show_popup_ad.boolean = True
    show_popup_ad.short_description = "Pop-up Reklam"

    def logo_display(self, obj):
        extended_site = obj.extended_site
        if extended_site and extended_site.logo:
            return f'<img src="{extended_site.logo.url}" style="width:48px; height:auto;" alt="Logo"/>'
        return "Logo Yok"

    logo_display.short_description = "Logo"
    logo_display.allow_tags = True

    def formatted_created_at(self, obj):
        """
        Oluşturulma tarihini okunabilir formatta döndürür.
        """
        extended_site = getattr(obj, "extended_site", None)
        if extended_site and extended_site.createdAt:
            return localtime(extended_site.createdAt).strftime('%d-%m-%Y %H:%M:%S')
        return "Bilinmiyor"

    formatted_created_at.short_description = "Oluşturulma Tarihi"

    def formatted_updated_at(self, obj):
        """
        Güncellenme tarihini okunabilir formatta döndürür.
        """
        extended_site = getattr(obj, "extended_site", None)
        if extended_site and extended_site.updatedAt:
            return localtime(extended_site.updatedAt).strftime('%d-%m-%Y %H:%M:%S')
        return "Bilinmiyor"

    formatted_updated_at.short_description = "Güncellenme Tarihi"

    def save_model(self, request, obj, form, change):
        """
        Site modeli kaydedildiğinde ExtendedSite modelini de günceller veya oluşturur.
        """
        super().save_model(request, obj, form, change)
        extended_site, _ = ExtendedSite.objects.get_or_create(site=obj)
        extended_site.isActive = form.cleaned_data.get("is_active", False)
        extended_site.isOurSite = form.cleaned_data.get("is_our_site", False)
        extended_site.isDefault = form.cleaned_data.get("is_default_site", False)
        extended_site.showPopupAd = form.cleaned_data.get("show_popup_ad", False)

        if "logo" in form.cleaned_data:
            if not form.cleaned_data["logo"]:
                if extended_site.logo:
                    safe_remove(extended_site.logo.path)
                extended_site.logo = None
            else:
                extended_site.logo = form.cleaned_data["logo"]

        extended_site.save()


# Site modelini yeni admin yapılandırmasıyla kaydetme
admin.site.unregister(Site)
admin.site.register(Site, SiteAdmin)


@admin.register(OperatingSystem)
class OperatingSystemAdmin(admin.ModelAdmin):
    list_display = ("name", "version", "createdAt", "updatedAt")
    search_fields = ("name", "version")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("name", "version")}),
        ("Açıklama", {"fields": ("description",)}),
        ("Tarih Bilgileri", {"fields": ("createdAt", "updatedAt")}),
    )


@admin.register(WebServer)
class WebServerAdmin(admin.ModelAdmin):
    list_display = (
        "domain",
        "isActive",
        "isDefault",
        "ns1",
        "ns2",
        "operatingSystem",
        "paymentType",
        "priceUsd",
        "createdAt",
        "updatedAt",
    )
    search_fields = ("domain", "ns1", "ns2")
    list_filter = ("paymentType", "operatingSystem")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("operatingSystem", "domain", "isActive", "isDefault", "ns1", "ns2")}),
        ("IP Adresleri", {"fields": ("ipAddress1", "ipAddress2", "ipAddress3", "ipAddress4", "ipAddress5")}),
        ("Kullanıcı Bilgileri", {"fields": ("username", "password")}),
        ("Ödeme ve Ücretlendirme", {"fields": ("paymentType", "priceUsd")}),
        ("Diğer Bilgiler", {"fields": ("description", "createdAt", "updatedAt")}),
    )


@admin.register(SqlServer)
class SqlServerAdmin(admin.ModelAdmin):
    list_display = (
        "domain",
        "isActive",
        "isDefault",
        "ns1",
        "ns2",
        "operatingSystem",
        "paymentType",
        "priceUsd",
        "createdAt",
        "updatedAt",
    )
    search_fields = ("domain", "ns1", "ns2")
    list_filter = ("paymentType", "operatingSystem")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("operatingSystem", "domain", "isActive", "isDefault", "ns1", "ns2")}),
        ("IP Adresleri", {"fields": ("ipAddress1", "ipAddress2", "ipAddress3", "ipAddress4", "ipAddress5")}),
        ("Kullanıcı Bilgileri", {"fields": ("username", "password")}),
        ("Ödeme ve Ücretlendirme", {"fields": ("paymentType", "priceUsd")}),
        ("Diğer Bilgiler", {"fields": ("description", "createdAt", "updatedAt")}),
    )


@admin.register(MailServer)
class MailServerAdmin(admin.ModelAdmin):
    list_display = (
        "domain",
        "isActive",
        "isDefault",
        "ns1",
        "ns2",
        "operatingSystem",
        "paymentType",
        "priceUsd",
        "createdAt",
        "updatedAt",
    )
    search_fields = ("domain", "ns1", "ns2")
    list_filter = ("paymentType", "operatingSystem")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("operatingSystem", "domain", "isActive", "isDefault", "ns1", "ns2")}),
        ("IP Adresleri", {"fields": ("ipAddress1", "ipAddress2", "ipAddress3", "ipAddress4", "ipAddress5")}),
        ("Kullanıcı Bilgileri", {"fields": ("username", "password")}),
        ("Ödeme ve Ücretlendirme", {"fields": ("paymentType", "priceUsd")}),
        ("Diğer Bilgiler", {"fields": ("description", "createdAt", "updatedAt")}),
    )


@admin.register(DnsServer)
class DnsServerAdmin(admin.ModelAdmin):
    list_display = (
        "domain",
        "isActive",
        "isDefault",
        "ns1",
        "ns2",
        "operatingSystem",
        "paymentType",
        "priceUsd",
        "createdAt",
        "updatedAt",
    )
    search_fields = ("domain", "ns1", "ns2")
    list_filter = ("paymentType", "operatingSystem")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("operatingSystem", "domain", "isActive", "isDefault", "ns1", "ns2")}),
        ("IP Adresleri", {"fields": ("ipAddress1", "ipAddress2", "ipAddress3", "ipAddress4", "ipAddress5")}),
        ("Kullanıcı Bilgileri", {"fields": ("username", "password")}),
        ("Ödeme ve Ücretlendirme", {"fields": ("paymentType", "priceUsd")}),
        ("Diğer Bilgiler", {"fields": ("description", "createdAt", "updatedAt")}),
    )


@admin.register(CustomSiteConfiguration)
class CustomSiteConfigurationAdmin(admin.ModelAdmin):
    list_display = ('site', 'webServer', 'sqlServer', 'mailServer', 'dnsServer', 'createdAt', 'updatedAt')
    list_filter = ('webServer', 'sqlServer', 'mailServer', 'dnsServer')
    search_fields = ('site__name', 'webServer__name', 'sqlServer__name', 'mailServer__name', 'dnsServer__name')
    ordering = ('-createdAt',)


@admin.register(Blacklist)
class BlacklistAdmin(admin.ModelAdmin):
    list_display = ('ip_address', 'reason', 'added_on', 'is_active')
    list_filter = ('is_active', 'added_on')
    search_fields = ('ip_address', 'reason')
    actions = ['activate_ips', 'deactivate_ips']

    def activate_ips(self, request, queryset):
        queryset.update(is_active=True)
        self.message_user(request, "Seçilen IP adresleri aktifleştirildi.")

    activate_ips.short_description = "Seçili IP'leri Aktifleştir"

    def deactivate_ips(self, request, queryset):
        queryset.update(is_active=False)
        self.message_user(request, "Seçilen IP adresleri pasifleştirildi.")

    deactivate_ips.short_description = "Seçili IP'leri Pasifleştir"


@admin.register(UserSite)
class UserSiteAdmin(admin.ModelAdmin):
    list_display = ("user", "site", "createdAt", "updatedAt")
    list_filter = ("site", "user")
    search_fields = ("user__username", "site__name")
    readonly_fields = ("createdAt", "updatedAt")
ChatGPT
Request for o1 pro mode
Düşünme sona erdi
Aşağıda, verdiğiniz kodlar, daha önce anlattığımız özel bir AdminSite ve get_app_list metodunu kullanarak kampanyalarla ilgili modelleri (Campaign, ConditionType, ActionType, Condition, Action, UserSegment, DealerSegment, Product) tek bir "Kampanya Yönetimi" başlığı altında toplayacak şekilde güncellenmiştir. Ayrıca kullanım hiyerarşisine göre sıralama da uygulanmıştır. Bu sayede admin panelinizde bu modeller ayrı bir bölümde derli toplu bir şekilde görüntülenecek, diğer modeller ise kendi gruplarında kalacaktır.

Önemli Noktalar:

Varsayılan admin.site yerine my_admin_site kullanıyoruz.
Tüm @admin.register(...) kullanımlarını my_admin_site.register(...) ile değiştiriyoruz.
get_app_list metodunu override ederek modelleri "Kampanya Yönetimi" başlığı altında topluyor ve sıraya koyuyoruz.
Diğer modeller (Menu, SiteUrun, WebServer, SqlServer, MailServer, DnsServer, OperatingSystem, CustomSiteConfiguration, Blacklist, UserSite, ExtendedSite, CustomUser vb.) ise kendi uygulama veya gruplarında kalacak, sadece kampanya ile ilgili olanlar ayrı "Kampanya Yönetimi" grubu altında olacak.
Bu işlem için kodunuzu iki dosyaya ayırmak faydalı olabilir:

admin_original.py: Burada admin class'larınızı tanımlayın (CustomUserAdmin, ProductAdmin, CampaignAdmin vb.).
admin.py: Burada özel AdminSite tanımınızı yapın, get_app_list metodunu override edin ve tüm modelleri my_admin_siteye kaydedin.
Aşağıda tek bir dosyada tam birleşik kod örneği verilmektedir. Eğer admin_original.py adlı bir dosyanız yoksa, tüm admin sınıflarını tek dosyada da tutabilirsiniz. Aşağıdaki örnekte tüm admin sınıfları tek dosyada verilmiştir.

admin.py (Tam Kod Örneği)
python
Kodu kopyala
import os

from django import forms
from django.conf import settings
from django.contrib import admin
from django.contrib.admin.sites import AdminSite
from django.contrib.sites.models import Site
from django.urls import path
from django.utils.timezone import localtime
from django.contrib.auth.models import Group

from .forms import CustomAdminAuthenticationForm
from .models import (
    ExtendedSite, SiteUrun, WebServer, SqlServer, MailServer, DnsServer,
    OperatingSystem, CustomSiteConfiguration, Blacklist, Menu, UserSite,
    CustomUser, UserSegment, DealerSegment, Product, Campaign, ConditionType,
    ActionType, Condition, Action
)


# Özel AdminSite oluşturma
class MyAdminSite(AdminSite):
    site_header = getattr(settings, 'ADMIN_SITE_HEADER', 'Django Yönetim Paneli')
    site_title = getattr(settings, 'ADMIN_SITE_TITLE', 'Django Yönetim Paneli')
    index_title = getattr(settings, 'ADMIN_INDEX_TITLE', 'Hoş Geldiniz!')
    login_form = CustomAdminAuthenticationForm

    def get_app_list(self, request):
        # Orijinal app listesi
        app_list = super().get_app_list(request)

        # Kampanya ile ilgili modelleri tek bir grup altında toplamak istiyoruz
        # Gruplanacak modeller:
        campaign_models = {
            'Campaign', 'ConditionType', 'ActionType', 'Condition', 'Action', 'UserSegment', 'DealerSegment', 'Product'
        }

        # Bu grubu "Kampanya Yönetimi" adıyla tek bir sanal uygulama altında toplayacağız
        campaign_app = {
            'app_label': 'camp_mgmt',
            'app_name': 'Kampanya Yönetimi',
            'name': 'Kampanya Yönetimi',
            'models': []
        }

        new_app_list = []

        # Orijinal app_list üzerinden geçip campaign_models setinde olanları campaign_app'e taşıyoruz
        for app in app_list:
            new_models = []
            for model in app['models']:
                if model['object_name'] in campaign_models:
                    campaign_app['models'].append(model)
                else:
                    new_models.append(model)
            if new_models:
                app['models'] = new_models
                new_app_list.append(app)

        # Kampanya modellerini hiyerarşik sıraya koyuyoruz:
        # Örnek hiyerarşi:
        # 1. Campaign
        # 2. ConditionType
        # 3. ActionType
        # 4. Condition
        # 5. Action
        # 6. UserSegment
        # 7. DealerSegment
        # 8. Product
        hierarchy = ['Campaign', 'ConditionType', 'ActionType', 'Condition', 'Action', 'UserSegment', 'DealerSegment', 'Product']

        campaign_app['models'].sort(key=lambda m: hierarchy.index(m['object_name']) if m['object_name'] in hierarchy else 999)

        # campaign_app'i listenin başına ekliyoruz, böylece en üstte gözükür.
        new_app_list.insert(0, campaign_app)

        return new_app_list


my_admin_site = MyAdminSite(name='myadmin')


# Yönetim paneli URL'sini kullanacak şekilde güncelleyin
urlpatterns = [
    path('admin/', my_admin_site.urls),
]


# ---- Admin Class Tanımları ----

class CustomUserAdminForm(forms.ModelForm):
    class Meta:
        model = CustomUser
        fields = '__all__'
        help_texts = {
            'isDealer': "Bu kullanıcı bir bayiyse işaretleyin. Bayilere özel kampanyalar ve ek iskontolar uygulanabilir.",
            'dealer_segment': "Bayiyi hangi bayi segmentine dahil etmek istediğinizi seçin. Segmentler, özel fiyatlandırma ve kampanyalar için kullanılır.",
        }


class CustomUserAdmin(admin.ModelAdmin):
    form = CustomUserAdminForm
    list_display = ('username', 'email', 'isDealer', 'dealer_segment', 'is_staff', 'is_active')
    list_filter = ('isDealer', 'dealer_segment', 'is_staff', 'is_active')
    search_fields = ('username', 'email')
    fieldsets = (
        (None, {
            'fields': ('username', 'password'),
            'description': "Temel kullanıcı adı ve parola ayarları."
        }),
        ("Kişisel Bilgiler", {
            'fields': ('first_name', 'last_name', 'email'),
            'description': "Kullanıcının temel iletişim bilgilerini girin."
        }),
        ("Bayi Bilgileri", {
            'fields': ('isDealer', 'dealer_segment'),
            'description': "Eğer kullanıcı bir bayiyse işaretleyin ve uygun bayi segmentini seçin."
        }),
        ("İzinler ve Durum", {
            'fields': ('is_active', 'is_staff', 'is_superuser', 'groups', 'user_permissions'),
            'description': "Kullanıcının yetkilerini, gruplarını ve izinlerini belirleyin."
        }),
        ("Önemli Tarihler", {
            'fields': ('last_login', 'date_joined'),
        }),
    )


class UserSegmentAdmin(admin.ModelAdmin):
    list_display = ('name', 'description')
    search_fields = ('name',)
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Bu segmenti kullanıcılar için etiketleyin. Örneğin 'Yeni Kullanıcı', 'Sadık Müşteri' vb."
        }),
    )


class DealerSegmentAdmin(admin.ModelAdmin):
    list_display = ('name', 'description')
    search_fields = ('name',)
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Bayi segment adını ve açıklamasını girin. Örneğin 'Gold Bayi' veya 'Alt Bayi'."
        }),
    )


class ProductAdmin(admin.ModelAdmin):
    list_display = ('name', 'price', 'serviceDuration', 'isActive', 'createDate', 'updateDate')
    list_filter = ('isActive',)
    search_fields = ('name', 'description')
    readonly_fields = ('slug', 'createDate', 'updateDate')
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Ürünün temel bilgilerini girin. İsim ve açıklama kullanıcıların göreceği bilgilerdir."
        }),
        ("Fiyat & Süre", {
            'fields': ('serviceDuration', 'price', 'isActive'),
            'description': "Hizmet süresi (ay) ve fiyat bilgilerini girin. Ürün aktif değilse satışta görünmez."
        }),
        ("URL Bilgileri", {
            'fields': ('slug',),
            'description': "Ürünün URL yapısını otomatik oluşturur. Değiştirmeye gerek yok.",
        }),
        ("Tarih Bilgileri", {
            'fields': ('createDate', 'updateDate'),
            'description': "Oluşturulma ve güncellenme tarihleri otomatik olarak işlenir.",
        }),
    )


class ConditionInline(admin.TabularInline):
    model = Condition
    extra = 1
    verbose_name = "Koşul"
    verbose_name_plural = "Koşullar"
    help_text = "Bu kampanyanın hangi koşullarda geçerli olacağını belirleyin. Örneğin belirli bir ürün alındığında veya belirli bir kullanıcı segmentine yönelik."


class ActionInline(admin.TabularInline):
    model = Action
    extra = 1
    verbose_name = "Aksiyon"
    verbose_name_plural = "Aksiyonlar"
    help_text = "Koşullar sağlandığında ne yapılacağını belirleyin. Örn: %10 indirim, hediye ürün."


class CampaignAdmin(admin.ModelAdmin):
    list_display = ('name', 'start_date', 'end_date', 'is_active')
    list_filter = ('is_active',)
    search_fields = ('name', 'description')
    filter_horizontal = ('products',)
    inlines = [ConditionInline, ActionInline]
    fieldsets = (
        (None, {
            'fields': ('name', 'description', 'is_active'),
            'description': "Kampanyanın adını ve açıklamasını girin. Aktif olunca kampanya devreye girer."
        }),
        ("Zaman Aralığı", {
            'fields': ('start_date', 'end_date'),
            'description': "Kampanyanın geçerli olacağı tarih aralığını belirleyin."
        }),
        ("Ürünler", {
            'fields': ('products',),
            'description': "Bu kampanyanın geçerli olacağı ürünleri seçin. Boş bırakırsanız tüm ürünler için geçerli olabilir."
        }),
    )


class ConditionTypeAdmin(admin.ModelAdmin):
    list_display = ('code', 'name', 'description')
    search_fields = ('code', 'name')
    fieldsets = (
        (None, {
            'fields': ('code', 'name', 'description'),
            'description': "Yeni bir koşul tipi tanımlarken kodunun benzersiz olmasına dikkat edin. Örn: 'USER_SEGMENT', 'PRODUCT_PURCHASED'."
        }),
    )


class ActionTypeAdmin(admin.ModelAdmin):
    list_display = ('code', 'name', 'description')
    search_fields = ('code', 'name')
    fieldsets = (
        (None, {
            'fields': ('code', 'name', 'description'),
            'description': "Aksiyon tiplerinin kodlarının da benzersiz olması gerekir. Örn: 'DISCOUNT_FIXED', 'ADD_BACKLINK'."
        }),
    )


class ConditionAdmin(admin.ModelAdmin):
    list_display = ('campaign', 'condition_type', 'user_segment', 'dealer_segment')
    search_fields = ('campaign__name', 'condition_type__name')
    list_filter = ('condition_type', 'user_segment', 'dealer_segment')
    fieldsets = (
        (None, {
            'fields': ('campaign', 'condition_type', 'user_segment', 'dealer_segment', 'params'),
            'description': "Koşulun bağlı olduğu kampanyayı, koşul tipini ve segmentleri belirleyin. params ile ek kriterler tanımlayın."
        }),
    )


class ActionAdmin(admin.ModelAdmin):
    list_display = ('campaign', 'action_type')
    search_fields = ('campaign__name', 'action_type__name')
    list_filter = ('action_type',)
    fieldsets = (
        (None, {
            'fields': ('campaign', 'action_type', 'params'),
            'description': "Aksiyonun bağlı olduğu kampanyayı, aksiyon tipini seçin. params alanıyla ayrıntılı ayar yapın."
        }),
    )


class MenuAdminForm(forms.ModelForm):
    ROLE_CHOICES = [
        ("admin", "Admin"),
        ("manager", "Manager"),
        ("superuser", "Superuser"),
    ]

    roles = forms.MultipleChoiceField(
        choices=ROLE_CHOICES,
        widget=forms.CheckboxSelectMultiple,
        required=False,
        label="Roles"
    )

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        if isinstance(self.instance.roles, list):
            self.fields["roles"].initial = self.instance.roles

    def clean_roles(self):
        return self.cleaned_data.get("roles", [])

    class Meta:
        model = Menu
        fields = "__all__"


class MenuAdmin(admin.ModelAdmin):
    form = MenuAdminForm
    list_display = (
        'title',
        'path',
        'icon',
        'caption',
        'parent',
        'product',
        'order',
        'is_superuser_only',
        'disabled',
        'external'
    )
    search_fields = ('title', 'path', 'icon', 'caption')
    list_filter = ('parent', 'product', 'is_superuser_only', 'disabled', 'external')
    ordering = ('order',)
    fieldsets = (
        (None, {
            'fields': (
                'title',
                'path',
                'icon',
                'caption',
                'parent',
                'product',
                'order'
            )
        }),
        ('Visibility & Access', {
            'fields': (
                'is_superuser_only',
                'roles',
                'disabled',
                'external'
            )
        }),
        ('Metadata', {
            'fields': ('info',)
        }),
    )


class SiteUrunAdmin(admin.ModelAdmin):
    list_display = ('site', 'urun_list', 'createdAt')
    search_fields = ('site__name', 'urun__name')
    list_filter = ('site',)
    filter_horizontal = ('urun',)

    def urun_list(self, obj):
        return ", ".join([urun.name for urun in obj.urun.all()])

    urun_list.short_description = "Ürünler"


def safe_remove(file_path):
    if os.path.exists(file_path):
        os.remove(file_path)
        print(f"Silindi: {file_path}")


class SiteAdminForm(forms.ModelForm):
    is_active = forms.BooleanField(label="Aktif", required=False)
    is_our_site = forms.BooleanField(label="Bizim Sitemiz", required=False)
    is_default_site = forms.BooleanField(label="Varsayılan Site", required=False)
    show_popup_ad = forms.BooleanField(label="Pop-up Reklam Gösterimi", required=False)
    logo = forms.ImageField(label="Site Logosu", required=False)

    class Meta:
        model = Site
        fields = "__all__"

    def clean_logo(self):
        logo = self.cleaned_data.get("logo", None)
        if self.instance.pk:
            extended_site = getattr(self.instance, "extended_site", None)
            if extended_site and not logo and extended_site.logo:
                safe_remove(extended_site.logo.path)
                extended_site.logo = None
                extended_site.save()
        return logo

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        extended_site = getattr(self.instance, "extended_site", None)
        if extended_site:
            self.fields["is_active"].initial = extended_site.isActive
            self.fields["is_our_site"].initial = extended_site.isOurSite
            self.fields["is_default_site"].initial = extended_site.isDefault
            self.fields["show_popup_ad"].initial = extended_site.showPopupAd
            if extended_site.logo:
                self.fields["logo"].initial = extended_site.logo


class SiteAdmin(admin.ModelAdmin):
    form = SiteAdminForm
    list_display = (
        "domain", "name", "is_active", "is_our_site", "is_default", "show_popup_ad",
        "formatted_created_at", "formatted_updated_at"
    )
    readonly_fields = ("formatted_created_at", "formatted_updated_at")
    search_fields = ("domain", "name")

    def is_active(self, obj):
        return getattr(obj.extended_site, "isActive", False)

    is_active.boolean = True
    is_active.short_description = "Aktif"

    def is_our_site(self, obj):
        return getattr(obj.extended_site, "isOurSite", False)

    is_our_site.boolean = True
    is_our_site.short_description = "Bizim Sitemiz"

    def is_default(self, obj):
        return getattr(obj.extended_site, "isDefault", False)

    is_default.boolean = True
    is_default.short_description = "Varsayılan Site"

    def show_popup_ad(self, obj):
        return getattr(obj.extended_site, "showPopupAd", False)

    show_popup_ad.boolean = True
    show_popup_ad.short_description = "Pop-up Reklam"

    def formatted_created_at(self, obj):
        extended_site = getattr(obj, "extended_site", None)
        if extended_site and extended_site.createdAt:
            return localtime(extended_site.createdAt).strftime('%d-%m-%Y %H:%M:%S')
        return "Bilinmiyor"

    formatted_created_at.short_description = "Oluşturulma Tarihi"

    def formatted_updated_at(self, obj):
        extended_site = getattr(obj, "extended_site", None)
        if extended_site and extended_site.updatedAt:
            return localtime(extended_site.updatedAt).strftime('%d-%m-%Y %H:%M:%S')
        return "Bilinmiyor"

    formatted_updated_at.short_description = "Güncellenme Tarihi"

    def save_model(self, request, obj, form, change):
        super().save_model(request, obj, form, change)
        extended_site, _ = ExtendedSite.objects.get_or_create(site=obj)
        extended_site.isActive = form.cleaned_data.get("is_active", False)
        extended_site.isOurSite = form.cleaned_data.get("is_our_site", False)
        extended_site.isDefault = form.cleaned_data.get("is_default_site", False)
        extended_site.showPopupAd = form.cleaned_data.get("show_popup_ad", False)

        if "logo" in form.cleaned_data:
            if not form.cleaned_data["logo"]:
                if extended_site.logo:
                    safe_remove(extended_site.logo.path)
                extended_site.logo = None
            else:
                extended_site.logo = form.cleaned_data["logo"]

        extended_site.save()


class OperatingSystemAdmin(admin.ModelAdmin):
    list_display = ("name", "version", "createdAt", "updatedAt")
    search_fields = ("name", "version")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("name", "version")}),
        ("Açıklama", {"fields": ("description",)}),
        ("Tarih Bilgileri", {"fields": ("createdAt", "updatedAt")}),
    )


class WebServerAdmin(admin.ModelAdmin):
    list_display = (
        "domain", "isActive", "isDefault", "ns1", "ns2", "operatingSystem", "paymentType", "priceUsd", "createdAt", "updatedAt",
    )
    search_fields = ("domain", "ns1", "ns2")
    list_filter = ("paymentType", "operatingSystem")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("operatingSystem", "domain", "isActive", "isDefault", "ns1", "ns2")}),
        ("IP Adresleri", {"fields": ("ipAddress1", "ipAddress2", "ipAddress3", "ipAddress4", "ipAddress5")}),
        ("Kullanıcı Bilgileri", {"fields": ("username", "password")}),
        ("Ödeme ve Ücretlendirme", {"fields": ("paymentType", "priceUsd")}),
        ("Diğer Bilgiler", {"fields": ("description", "createdAt", "updatedAt")}),
    )


class SqlServerAdmin(WebServerAdmin):
    pass


class MailServerAdmin(WebServerAdmin):
    pass


class DnsServerAdmin(WebServerAdmin):
    pass


class CustomSiteConfigurationAdmin(admin.ModelAdmin):
    list_display = ('site', 'webServer', 'sqlServer', 'mailServer', 'dnsServer', 'createdAt', 'updatedAt')
    list_filter = ('webServer', 'sqlServer', 'mailServer', 'dnsServer')
    search_fields = ('site__name', 'webServer__domain', 'sqlServer__domain', 'mailServer__domain', 'dnsServer__domain')
    ordering = ('-createdAt',)


class BlacklistAdmin(admin.ModelAdmin):
    list_display = ('ip_address', 'reason', 'added_on', 'is_active')
    list_filter = ('is_active', 'added_on')
    search_fields = ('ip_address', 'reason')
    actions = ['activate_ips', 'deactivate_ips']

    def activate_ips(self, request, queryset):
        queryset.update(is_active=True)
        self.message_user(request, "Seçilen IP adresleri aktifleştirildi.")

    activate_ips.short_description = "Seçili IP'leri Aktifleştir"

    def deactivate_ips(self, request, queryset):
        queryset.update(is_active=False)
        self.message_user(request, "Seçilen IP adresleri pasifleştirildi.")

    deactivate_ips.short_description = "Seçili IP'leri Pasifleştir"


class UserSiteAdmin(admin.ModelAdmin):
    list_display = ("user", "site", "createdAt", "updatedAt")
    list_filter = ("site", "user")
    search_fields = ("user__username", "site__name")
    readonly_fields = ("createdAt", "updatedAt")


# ---- Modelleri MyAdminSite'e Kaydediyoruz ----

my_admin_site.register(CustomUser, CustomUserAdmin)
my_admin_site.register(UserSegment, UserSegmentAdmin)
my_admin_site.register(DealerSegment, DealerSegmentAdmin)
my_admin_site.register(Product, ProductAdmin)
my_admin_site.register(Campaign, CampaignAdmin)
my_admin_site.register(ConditionType, ConditionTypeAdmin)
my_admin_site.register(ActionType, ActionTypeAdmin)
my_admin_site.register(Condition, ConditionAdmin)
my_admin_site.register(Action, ActionAdmin)

my_admin_site.register(Menu, MenuAdmin)
my_admin_site.register(SiteUrun, SiteUrunAdmin)
my_admin_site.register(Site, SiteAdmin)
my_admin_site.register(OperatingSystem, OperatingSystemAdmin)
my_admin_site.register(WebServer, WebServerAdmin)
my_admin_site.register(SqlServer, SqlServerAdmin)
my_admin_site.register(MailServer, MailServerAdmin)
my_admin_site.register(DnsServer, DnsServerAdmin)
my_admin_site.register(CustomSiteConfiguration, CustomSiteConfigurationAdmin)
my_admin_site.register(Blacklist, BlacklistAdmin)
my_admin_site.register(UserSite, UserSiteAdmin)

# Varsayılan admin.site kullanılmayacaksa gerek yok. 
# Eğer kullanacaksanız, admin.site.unregister(Group) gibi işlemleri yapabilirsiniz.
# Gerekirse:
try:
    admin.site.unregister(Group)
except admin.sites.NotRegistered:
    pass
Özet:
Yukarıdaki kodda:

MyAdminSite sınıfını kullanarak get_app_list metodunu override ettik.
Kampanya ile ilgili modelleri tek bir "Kampanya Yönetimi" başlığı altında topladık ve hierarşik olarak sıraladık.
Tüm modelleri my_admin_site üzerinden kaydettik.
Artık admin panelinde "Kampanya Yönetimi" adı altında ilgili modellerinizi tek bölümde, hiyerarşik sırayla görebilir, diğer modelleri ise kendi gruplarında yönetmeye devam edebilirsiniz.




Şunu dedin:
aşağıdaki kodlarla admin py üzerinde bu dosyadaki menüler gelmedi

import os

from django import forms
from django.conf import settings
from django.contrib import admin
from django.contrib.admin.sites import AdminSite
from django.contrib.auth.models import Group
from django.contrib.sites.models import Site
from django.urls import path
from django.utils.timezone import localtime

from .forms import CustomAdminAuthenticationForm
from .models import (
    ExtendedSite, SiteUrun, WebServer, SqlServer, MailServer, DnsServer,
    OperatingSystem, CustomSiteConfiguration, Blacklist, Menu, UserSite,
    CustomUser, UserSegment, DealerSegment, Product, Campaign, ConditionType,
    ActionType, Condition, Action
)


# Özel AdminSite oluşturma
class MyAdminSite(AdminSite):
    site_header = getattr(settings, 'ADMIN_SITE_HEADER', 'Django Yönetim Paneli')
    site_title = getattr(settings, 'ADMIN_SITE_TITLE', 'Django Yönetim Paneli')
    index_title = getattr(settings, 'ADMIN_INDEX_TITLE', 'Hoş Geldiniz!')
    login_form = CustomAdminAuthenticationForm

    def get_app_list(self, request):
        # Orijinal app listesi
        app_list = super().get_app_list(request)

        # Kampanya ile ilgili modelleri tek bir grup altında toplamak istiyoruz
        # Gruplanacak modeller:
        campaign_models = {
            'Campaign', 'ConditionType', 'ActionType', 'Condition', 'Action', 'UserSegment', 'DealerSegment', 'Product'
        }

        # Bu grubu "Kampanya Yönetimi" adıyla tek bir sanal uygulama altında toplayacağız
        campaign_app = {
            'app_label': 'camp_mgmt',
            'app_name': 'Kampanya Yönetimi',
            'name': 'Kampanya Yönetimi',
            'models': []
        }

        new_app_list = []

        # Orijinal app_list üzerinden geçip campaign_models setinde olanları campaign_app'e taşıyoruz
        for app in app_list:
            new_models = []
            for model in app['models']:
                if model['object_name'] in campaign_models:
                    campaign_app['models'].append(model)
                else:
                    new_models.append(model)
            if new_models:
                app['models'] = new_models
                new_app_list.append(app)

        # Kampanya modellerini hiyerarşik sıraya koyuyoruz:
        # Örnek hiyerarşi:
        # 1. Campaign
        # 2. ConditionType
        # 3. ActionType
        # 4. Condition
        # 5. Action
        # 6. UserSegment
        # 7. DealerSegment
        # 8. Product
        hierarchy = ['Campaign', 'ConditionType', 'ActionType', 'Condition', 'Action', 'UserSegment', 'DealerSegment',
                     'Product']

        campaign_app['models'].sort(
            key=lambda m: hierarchy.index(m['object_name']) if m['object_name'] in hierarchy else 999)

        # campaign_app'i listenin başına ekliyoruz, böylece en üstte gözükür.
        new_app_list.insert(0, campaign_app)

        return new_app_list


my_admin_site = MyAdminSite(name='myadmin')

# Yönetim paneli URL'sini kullanacak şekilde güncelleyin
urlpatterns = [
    path('admin/', my_admin_site.urls),
]


# ---- Admin Class Tanımları ----

class CustomUserAdminForm(forms.ModelForm):
    class Meta:
        model = CustomUser
        fields = '__all__'
        help_texts = {
            'isDealer': "Bu kullanıcı bir bayiyse işaretleyin. Bayilere özel kampanyalar ve ek iskontolar uygulanabilir.",
            'dealer_segment': "Bayiyi hangi bayi segmentine dahil etmek istediğinizi seçin. Segmentler, özel fiyatlandırma ve kampanyalar için kullanılır.",
        }


class CustomUserAdmin(admin.ModelAdmin):
    form = CustomUserAdminForm
    list_display = ('username', 'email', 'isDealer', 'dealer_segment', 'is_staff', 'is_active')
    list_filter = ('isDealer', 'dealer_segment', 'is_staff', 'is_active')
    search_fields = ('username', 'email')
    fieldsets = (
        (None, {
            'fields': ('username', 'password'),
            'description': "Temel kullanıcı adı ve parola ayarları."
        }),
        ("Kişisel Bilgiler", {
            'fields': ('first_name', 'last_name', 'email'),
            'description': "Kullanıcının temel iletişim bilgilerini girin."
        }),
        ("Bayi Bilgileri", {
            'fields': ('isDealer', 'dealer_segment'),
            'description': "Eğer kullanıcı bir bayiyse işaretleyin ve uygun bayi segmentini seçin."
        }),
        ("İzinler ve Durum", {
            'fields': ('is_active', 'is_staff', 'is_superuser', 'groups', 'user_permissions'),
            'description': "Kullanıcının yetkilerini, gruplarını ve izinlerini belirleyin."
        }),
        ("Önemli Tarihler", {
            'fields': ('last_login', 'date_joined'),
        }),
    )


class UserSegmentAdmin(admin.ModelAdmin):
    list_display = ('name', 'description')
    search_fields = ('name',)
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Bu segmenti kullanıcılar için etiketleyin. Örneğin 'Yeni Kullanıcı', 'Sadık Müşteri' vb."
        }),
    )


class DealerSegmentAdmin(admin.ModelAdmin):
    list_display = ('name', 'description')
    search_fields = ('name',)
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Bayi segment adını ve açıklamasını girin. Örneğin 'Gold Bayi' veya 'Alt Bayi'."
        }),
    )


class ProductAdmin(admin.ModelAdmin):
    list_display = ('name', 'price', 'serviceDuration', 'isActive', 'createDate', 'updateDate')
    list_filter = ('isActive',)
    search_fields = ('name', 'description')
    readonly_fields = ('slug', 'createDate', 'updateDate')
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Ürünün temel bilgilerini girin. İsim ve açıklama kullanıcıların göreceği bilgilerdir."
        }),
        ("Fiyat & Süre", {
            'fields': ('serviceDuration', 'price', 'isActive'),
            'description': "Hizmet süresi (ay) ve fiyat bilgilerini girin. Ürün aktif değilse satışta görünmez."
        }),
        ("URL Bilgileri", {
            'fields': ('slug',),
            'description': "Ürünün URL yapısını otomatik oluşturur. Değiştirmeye gerek yok.",
        }),
        ("Tarih Bilgileri", {
            'fields': ('createDate', 'updateDate'),
            'description': "Oluşturulma ve güncellenme tarihleri otomatik olarak işlenir.",
        }),
    )


class ConditionInline(admin.TabularInline):
    model = Condition
    extra = 1
    verbose_name = "Koşul"
    verbose_name_plural = "Koşullar"
    help_text = "Bu kampanyanın hangi koşullarda geçerli olacağını belirleyin. Örneğin belirli bir ürün alındığında veya belirli bir kullanıcı segmentine yönelik."


class ActionInline(admin.TabularInline):
    model = Action
    extra = 1
    verbose_name = "Aksiyon"
    verbose_name_plural = "Aksiyonlar"
    help_text = "Koşullar sağlandığında ne yapılacağını belirleyin. Örn: %10 indirim, hediye ürün."


class CampaignAdmin(admin.ModelAdmin):
    list_display = ('name', 'start_date', 'end_date', 'is_active')
    list_filter = ('is_active',)
    search_fields = ('name', 'description')
    filter_horizontal = ('products',)
    inlines = [ConditionInline, ActionInline]
    fieldsets = (
        (None, {
            'fields': ('name', 'description', 'is_active'),
            'description': "Kampanyanın adını ve açıklamasını girin. Aktif olunca kampanya devreye girer."
        }),
        ("Zaman Aralığı", {
            'fields': ('start_date', 'end_date'),
            'description': "Kampanyanın geçerli olacağı tarih aralığını belirleyin."
        }),
        ("Ürünler", {
            'fields': ('products',),
            'description': "Bu kampanyanın geçerli olacağı ürünleri seçin. Boş bırakırsanız tüm ürünler için geçerli olabilir."
        }),
    )


class ConditionTypeAdmin(admin.ModelAdmin):
    list_display = ('code', 'name', 'description')
    search_fields = ('code', 'name')
    fieldsets = (
        (None, {
            'fields': ('code', 'name', 'description'),
            'description': "Yeni bir koşul tipi tanımlarken kodunun benzersiz olmasına dikkat edin. Örn: 'USER_SEGMENT', 'PRODUCT_PURCHASED'."
        }),
    )


class ActionTypeAdmin(admin.ModelAdmin):
    list_display = ('code', 'name', 'description')
    search_fields = ('code', 'name')
    fieldsets = (
        (None, {
            'fields': ('code', 'name', 'description'),
            'description': "Aksiyon tiplerinin kodlarının da benzersiz olması gerekir. Örn: 'DISCOUNT_FIXED', 'ADD_BACKLINK'."
        }),
    )


class ConditionAdmin(admin.ModelAdmin):
    list_display = ('campaign', 'condition_type', 'user_segment', 'dealer_segment')
    search_fields = ('campaign__name', 'condition_type__name')
    list_filter = ('condition_type', 'user_segment', 'dealer_segment')
    fieldsets = (
        (None, {
            'fields': ('campaign', 'condition_type', 'user_segment', 'dealer_segment', 'params'),
            'description': "Koşulun bağlı olduğu kampanyayı, koşul tipini ve segmentleri belirleyin. params ile ek kriterler tanımlayın."
        }),
    )


class ActionAdmin(admin.ModelAdmin):
    list_display = ('campaign', 'action_type')
    search_fields = ('campaign__name', 'action_type__name')
    list_filter = ('action_type',)
    fieldsets = (
        (None, {
            'fields': ('campaign', 'action_type', 'params'),
            'description': "Aksiyonun bağlı olduğu kampanyayı, aksiyon tipini seçin. params alanıyla ayrıntılı ayar yapın."
        }),
    )


class MenuAdminForm(forms.ModelForm):
    ROLE_CHOICES = [
        ("admin", "Admin"),
        ("manager", "Manager"),
        ("superuser", "Superuser"),
    ]

    roles = forms.MultipleChoiceField(
        choices=ROLE_CHOICES,
        widget=forms.CheckboxSelectMultiple,
        required=False,
        label="Roles"
    )

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        if isinstance(self.instance.roles, list):
            self.fields["roles"].initial = self.instance.roles

    def clean_roles(self):
        return self.cleaned_data.get("roles", [])

    class Meta:
        model = Menu
        fields = "__all__"


class MenuAdmin(admin.ModelAdmin):
    form = MenuAdminForm
    list_display = (
        'title',
        'path',
        'icon',
        'caption',
        'parent',
        'product',
        'order',
        'is_superuser_only',
        'disabled',
        'external'
    )
    search_fields = ('title', 'path', 'icon', 'caption')
    list_filter = ('parent', 'product', 'is_superuser_only', 'disabled', 'external')
    ordering = ('order',)
    fieldsets = (
        (None, {
            'fields': (
                'title',
                'path',
                'icon',
                'caption',
                'parent',
                'product',
                'order'
            )
        }),
        ('Visibility & Access', {
            'fields': (
                'is_superuser_only',
                'roles',
                'disabled',
                'external'
            )
        }),
        ('Metadata', {
            'fields': ('info',)
        }),
    )


class SiteUrunAdmin(admin.ModelAdmin):
    list_display = ('site', 'urun_list', 'createdAt')
    search_fields = ('site__name', 'urun__name')
    list_filter = ('site',)
    filter_horizontal = ('urun',)

    def urun_list(self, obj):
        return ", ".join([urun.name for urun in obj.urun.all()])

    urun_list.short_description = "Ürünler"


def safe_remove(file_path):
    if os.path.exists(file_path):
        os.remove(file_path)
        print(f"Silindi: {file_path}")


class SiteAdminForm(forms.ModelForm):
    is_active = forms.BooleanField(label="Aktif", required=False)
    is_our_site = forms.BooleanField(label="Bizim Sitemiz", required=False)
    is_default_site = forms.BooleanField(label="Varsayılan Site", required=False)
    show_popup_ad = forms.BooleanField(label="Pop-up Reklam Gösterimi", required=False)
    logo = forms.ImageField(label="Site Logosu", required=False)

    class Meta:
        model = Site
        fields = "__all__"

    def clean_logo(self):
        logo = self.cleaned_data.get("logo", None)
        if self.instance.pk:
            extended_site = getattr(self.instance, "extended_site", None)
            if extended_site and not logo and extended_site.logo:
                safe_remove(extended_site.logo.path)
                extended_site.logo = None
                extended_site.save()
        return logo

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        extended_site = getattr(self.instance, "extended_site", None)
        if extended_site:
            self.fields["is_active"].initial = extended_site.isActive
            self.fields["is_our_site"].initial = extended_site.isOurSite
            self.fields["is_default_site"].initial = extended_site.isDefault
            self.fields["show_popup_ad"].initial = extended_site.showPopupAd
            if extended_site.logo:
                self.fields["logo"].initial = extended_site.logo


class SiteAdmin(admin.ModelAdmin):
    form = SiteAdminForm
    list_display = (
        "domain", "name", "is_active", "is_our_site", "is_default", "show_popup_ad",
        "formatted_created_at", "formatted_updated_at"
    )
    readonly_fields = ("formatted_created_at", "formatted_updated_at")
    search_fields = ("domain", "name")

    def is_active(self, obj):
        return getattr(obj.extended_site, "isActive", False)

    is_active.boolean = True
    is_active.short_description = "Aktif"

    def is_our_site(self, obj):
        return getattr(obj.extended_site, "isOurSite", False)

    is_our_site.boolean = True
    is_our_site.short_description = "Bizim Sitemiz"

    def is_default(self, obj):
        return getattr(obj.extended_site, "isDefault", False)

    is_default.boolean = True
    is_default.short_description = "Varsayılan Site"

    def show_popup_ad(self, obj):
        return getattr(obj.extended_site, "showPopupAd", False)

    show_popup_ad.boolean = True
    show_popup_ad.short_description = "Pop-up Reklam"

    def formatted_created_at(self, obj):
        extended_site = getattr(obj, "extended_site", None)
        if extended_site and extended_site.createdAt:
            return localtime(extended_site.createdAt).strftime('%d-%m-%Y %H:%M:%S')
        return "Bilinmiyor"

    formatted_created_at.short_description = "Oluşturulma Tarihi"

    def formatted_updated_at(self, obj):
        extended_site = getattr(obj, "extended_site", None)
        if extended_site and extended_site.updatedAt:
            return localtime(extended_site.updatedAt).strftime('%d-%m-%Y %H:%M:%S')
        return "Bilinmiyor"

    formatted_updated_at.short_description = "Güncellenme Tarihi"

    def save_model(self, request, obj, form, change):
        super().save_model(request, obj, form, change)
        extended_site, _ = ExtendedSite.objects.get_or_create(site=obj)
        extended_site.isActive = form.cleaned_data.get("is_active", False)
        extended_site.isOurSite = form.cleaned_data.get("is_our_site", False)
        extended_site.isDefault = form.cleaned_data.get("is_default_site", False)
        extended_site.showPopupAd = form.cleaned_data.get("show_popup_ad", False)

        if "logo" in form.cleaned_data:
            if not form.cleaned_data["logo"]:
                if extended_site.logo:
                    safe_remove(extended_site.logo.path)
                extended_site.logo = None
            else:
                extended_site.logo = form.cleaned_data["logo"]

        extended_site.save()


class OperatingSystemAdmin(admin.ModelAdmin):
    list_display = ("name", "version", "createdAt", "updatedAt")
    search_fields = ("name", "version")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("name", "version")}),
        ("Açıklama", {"fields": ("description",)}),
        ("Tarih Bilgileri", {"fields": ("createdAt", "updatedAt")}),
    )


class CustomSiteConfigurationAdmin(admin.ModelAdmin):
    list_display = ('site', 'webServer', 'sqlServer', 'mailServer', 'dnsServer', 'createdAt', 'updatedAt')
    list_filter = ('webServer', 'sqlServer', 'mailServer', 'dnsServer')
    search_fields = ('site__name', 'webServer__domain', 'sqlServer__domain', 'mailServer__domain', 'dnsServer__domain')
    ordering = ('-createdAt',)


class BlacklistAdmin(admin.ModelAdmin):
    list_display = ('ip_address', 'reason', 'added_on', 'is_active')
    list_filter = ('is_active', 'added_on')
    search_fields = ('ip_address', 'reason')
    actions = ['activate_ips', 'deactivate_ips']

    def activate_ips(self, request, queryset):
        queryset.update(is_active=True)
        self.message_user(request, "Seçilen IP adresleri aktifleştirildi.")

    activate_ips.short_description = "Seçili IP'leri Aktifleştir"

    def deactivate_ips(self, request, queryset):
        queryset.update(is_active=False)
        self.message_user(request, "Seçilen IP adresleri pasifleştirildi.")

    deactivate_ips.short_description = "Seçili IP'leri Pasifleştir"


class UserSiteAdmin(admin.ModelAdmin):
    list_display = ("user", "site", "createdAt", "updatedAt")
    list_filter = ("site", "user")
    search_fields = ("user__username", "site__name")
    readonly_fields = ("createdAt", "updatedAt")


@admin.register(WebServer)
class WebServerAdmin(admin.ModelAdmin):
    list_display = (
        "domain",
        "isActive",
        "isDefault",
        "ns1",
        "ns2",
        "operatingSystem",
        "paymentType",
        "priceUsd",
        "createdAt",
        "updatedAt",
    )
    search_fields = ("domain", "ns1", "ns2")
    list_filter = ("paymentType", "operatingSystem")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("operatingSystem", "domain", "isActive", "isDefault", "ns1", "ns2")}),
        ("IP Adresleri", {"fields": ("ipAddress1", "ipAddress2", "ipAddress3", "ipAddress4", "ipAddress5")}),
        ("Kullanıcı Bilgileri", {"fields": ("username", "password")}),
        ("Ödeme ve Ücretlendirme", {"fields": ("paymentType", "priceUsd")}),
        ("Diğer Bilgiler", {"fields": ("description", "createdAt", "updatedAt")}),
    )


@admin.register(SqlServer)
class SqlServerAdmin(admin.ModelAdmin):
    list_display = (
        "domain",
        "isActive",
        "isDefault",
        "ns1",
        "ns2",
        "operatingSystem",
        "paymentType",
        "priceUsd",
        "createdAt",
        "updatedAt",
    )
    search_fields = ("domain", "ns1", "ns2")
    list_filter = ("paymentType", "operatingSystem")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("operatingSystem", "domain", "isActive", "isDefault", "ns1", "ns2")}),
        ("IP Adresleri", {"fields": ("ipAddress1", "ipAddress2", "ipAddress3", "ipAddress4", "ipAddress5")}),
        ("Kullanıcı Bilgileri", {"fields": ("username", "password")}),
        ("Ödeme ve Ücretlendirme", {"fields": ("paymentType", "priceUsd")}),
        ("Diğer Bilgiler", {"fields": ("description", "createdAt", "updatedAt")}),
    )


@admin.register(MailServer)
class MailServerAdmin(admin.ModelAdmin):
    list_display = (
        "domain",
        "isActive",
        "isDefault",
        "ns1",
        "ns2",
        "operatingSystem",
        "paymentType",
        "priceUsd",
        "createdAt",
        "updatedAt",
    )
    search_fields = ("domain", "ns1", "ns2")
    list_filter = ("paymentType", "operatingSystem")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("operatingSystem", "domain", "isActive", "isDefault", "ns1", "ns2")}),
        ("IP Adresleri", {"fields": ("ipAddress1", "ipAddress2", "ipAddress3", "ipAddress4", "ipAddress5")}),
        ("Kullanıcı Bilgileri", {"fields": ("username", "password")}),
        ("Ödeme ve Ücretlendirme", {"fields": ("paymentType", "priceUsd")}),
        ("Diğer Bilgiler", {"fields": ("description", "createdAt", "updatedAt")}),
    )


@admin.register(DnsServer)
class DnsServerAdmin(admin.ModelAdmin):
    list_display = (
        "domain",
        "isActive",
        "isDefault",
        "ns1",
        "ns2",
        "operatingSystem",
        "paymentType",
        "priceUsd",
        "createdAt",
        "updatedAt",
    )
    search_fields = ("domain", "ns1", "ns2")
    list_filter = ("paymentType", "operatingSystem")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("operatingSystem", "domain", "isActive", "isDefault", "ns1", "ns2")}),
        ("IP Adresleri", {"fields": ("ipAddress1", "ipAddress2", "ipAddress3", "ipAddress4", "ipAddress5")}),
        ("Kullanıcı Bilgileri", {"fields": ("username", "password")}),
        ("Ödeme ve Ücretlendirme", {"fields": ("paymentType", "priceUsd")}),
        ("Diğer Bilgiler", {"fields": ("description", "createdAt", "updatedAt")}),
    )


# ---- Modelleri MyAdminSite'e Kaydediyoruz ----

my_admin_site.register(CustomUser, CustomUserAdmin)
my_admin_site.register(UserSegment, UserSegmentAdmin)
my_admin_site.register(DealerSegment, DealerSegmentAdmin)
my_admin_site.register(Product, ProductAdmin)
my_admin_site.register(Campaign, CampaignAdmin)
my_admin_site.register(ConditionType, ConditionTypeAdmin)
my_admin_site.register(ActionType, ActionTypeAdmin)
my_admin_site.register(Condition, ConditionAdmin)
my_admin_site.register(Action, ActionAdmin)

my_admin_site.register(Menu, MenuAdmin)
my_admin_site.register(SiteUrun, SiteUrunAdmin)
my_admin_site.register(Site, SiteAdmin)
my_admin_site.register(OperatingSystem, OperatingSystemAdmin)
my_admin_site.register(WebServer, WebServerAdmin)
my_admin_site.register(SqlServer, SqlServerAdmin)
my_admin_site.register(MailServer, MailServerAdmin)
my_admin_site.register(DnsServer, DnsServerAdmin)
my_admin_site.register(CustomSiteConfiguration, CustomSiteConfigurationAdmin)
my_admin_site.register(Blacklist, BlacklistAdmin)
my_admin_site.register(UserSite, UserSiteAdmin)

# Varsayılan admin.site kullanılmayacaksa gerek yok.
# Eğer kullanacaksanız, admin.site.unregister(Group) gibi işlemleri yapabilirsiniz.
# Gerekirse:
# try:
#     admin.site.unregister(Group)
# except admin.sites.NotRegistered:
#     pass
ChatGPT
admin paneli düzenlemesi
Düşündüm için 4m 18s
Aşağıda paylaştığınız kodlarda my_admin_site kullanarak "Kampanya Yönetimi" başlığı altında bazı modelleri bir araya getirdik. Ancak, "Menu" gibi diğer modellerin görünmemesinin birkaç nedeni olabilir:

my_admin_site.urls Kullanımı:
Kodunuzda urlpatterns = [ path('admin/', my_admin_site.urls), ] şeklinde tanımlama yapıyorsunuz. Bu tanımlamanın projenizin ana urls.py dosyasında mevcut admin.site.urls yerine geçmesi gerekir. Eğer halen admin.site.urls kullanıyor ve siteye /admin/ ile giriyorsanız, varsayılan admin panelini görür ve my_admin_site üzerinden register edilmiş modelleri göremezsiniz.
Lütfen projenizin ana urls.py dosyasında:

python
Kodu kopyala
from django.urls import path
from .admin import my_admin_site

urlpatterns = [
    path('admin/', my_admin_site.urls),
]
şeklinde güncelleyin.

Menülerin "Kampanya Yönetimi" altında olmaması:
Kodda Menu modeli my_admin_sitee register edilmiş ancak campaign_models seti içerisine eklenmemiş. campaign_models seti sadece kampanyaya ait modelleri ("Campaign", "ConditionType", vb.) özel bir "Kampanya Yönetimi" grubunda toplar. Menu ise bu setin dışında kaldığı için kendi uygulaması altında görüntülenecektir. Eğer Menu modelini de "Kampanya Yönetimi" grubu altına almak istiyorsanız campaign_models setine "Menu" eklemelisiniz.

Örneğin:

python
Kodu kopyala
campaign_models = {
    'Campaign', 'ConditionType', 'ActionType', 'Condition', 'Action', 'UserSegment', 'DealerSegment', 'Product', 'Menu'
}
Ek olarak hierarchy listesine "Menu" ekleyerek sıralamayı da düzenleyebilirsiniz.
Örnek:

python
Kodu kopyala
hierarchy = ['Campaign', 'ConditionType', 'ActionType', 'Condition', 'Action', 'UserSegment', 'DealerSegment', 'Product', 'Menu']
Django Admin'e Giriş Yaptığınız Kullanıcı:
Kullandığınız kullanıcı yetkilerine göre bazı modeller admin panelinde görünmeyebilir. Kullanıcının ilgili model üzerinde görüntüleme yetkisi olduğundan emin olun.

Aşağıda güncellenmiş tam kod örneği verilmiştir. Bu örnekte:

Menu modelini de campaign_models setine ekledik, böylece "Kampanya Yönetimi" başlığı altına girecek.
hierarchy listesine de Menu eklendi, böylece menüleri istediğiniz yerde sıralayabilirsiniz.
Kodun sonunda my_admin_site.register(...) kullanmaya devam ediyoruz, yani tüm modeller my_admin_site üzerinde listelenecek.
Mutlaka projenizin ana urls.py dosyasında admin.site.urls yerine my_admin_site.urls kullandığınızdan emin olun.
Güncellenmiş Kod
python
Kodu kopyala
import os

from django import forms
from django.conf import settings
from django.contrib import admin
from django.contrib.admin.sites import AdminSite
from django.contrib.auth.models import Group
from django.contrib.sites.models import Site
from django.urls import path
from django.utils.timezone import localtime

from .forms import CustomAdminAuthenticationForm
from .models import (
    ExtendedSite, SiteUrun, WebServer, SqlServer, MailServer, DnsServer,
    OperatingSystem, CustomSiteConfiguration, Blacklist, Menu, UserSite,
    CustomUser, UserSegment, DealerSegment, Product, Campaign, ConditionType,
    ActionType, Condition, Action
)


# Özel AdminSite
class MyAdminSite(AdminSite):
    site_header = getattr(settings, 'ADMIN_SITE_HEADER', 'Django Yönetim Paneli')
    site_title = getattr(settings, 'ADMIN_SITE_TITLE', 'Django Yönetim Paneli')
    index_title = getattr(settings, 'ADMIN_INDEX_TITLE', 'Hoş Geldiniz!')
    login_form = CustomAdminAuthenticationForm

    def get_app_list(self, request):
        app_list = super().get_app_list(request)

        # Kampanya ile ilgili modeller + Menu de ekliyoruz
        campaign_models = {
            'Campaign', 'ConditionType', 'ActionType', 'Condition', 'Action', 'UserSegment', 'DealerSegment', 'Product', 'Menu'
        }

        campaign_app = {
            'app_label': 'camp_mgmt',
            'app_name': 'Kampanya Yönetimi',
            'name': 'Kampanya Yönetimi',
            'models': []
        }

        new_app_list = []

        for app in app_list:
            new_models = []
            for model in app['models']:
                if model['object_name'] in campaign_models:
                    campaign_app['models'].append(model)
                else:
                    new_models.append(model)
            if new_models:
                app['models'] = new_models
                new_app_list.append(app)

        # Hiyerarşik sıra: Menu'yu da sona ekliyoruz
        hierarchy = ['Campaign', 'ConditionType', 'ActionType', 'Condition', 'Action', 'UserSegment', 'DealerSegment', 'Product', 'Menu']

        campaign_app['models'].sort(
            key=lambda m: hierarchy.index(m['object_name']) if m['object_name'] in hierarchy else 999)

        new_app_list.insert(0, campaign_app)
        return new_app_list


my_admin_site = MyAdminSite(name='myadmin')

urlpatterns = [
    path('admin/', my_admin_site.urls),
]


class CustomUserAdminForm(forms.ModelForm):
    class Meta:
        model = CustomUser
        fields = '__all__'
        help_texts = {
            'isDealer': "Bu kullanıcı bir bayiyse işaretleyin. Bayilere özel kampanyalar ve ek iskontolar uygulanabilir.",
            'dealer_segment': "Bayiyi hangi bayi segmentine dahil etmek istediğinizi seçin.",
        }


class CustomUserAdmin(admin.ModelAdmin):
    form = CustomUserAdminForm
    list_display = ('username', 'email', 'isDealer', 'dealer_segment', 'is_staff', 'is_active')
    list_filter = ('isDealer', 'dealer_segment', 'is_staff', 'is_active')
    search_fields = ('username', 'email')
    fieldsets = (
        (None, {
            'fields': ('username', 'password'),
            'description': "Temel kullanıcı adı ve parola ayarları."
        }),
        ("Kişisel Bilgiler", {
            'fields': ('first_name', 'last_name', 'email'),
            'description': "Kullanıcının temel iletişim bilgilerini girin."
        }),
        ("Bayi Bilgileri", {
            'fields': ('isDealer', 'dealer_segment'),
            'description': "Eğer kullanıcı bir bayiyse işaretleyin ve uygun bayi segmentini seçin."
        }),
        ("İzinler ve Durum", {
            'fields': ('is_active', 'is_staff', 'is_superuser', 'groups', 'user_permissions'),
            'description': "Kullanıcının yetkilerini, gruplarını ve izinlerini belirleyin."
        }),
        ("Önemli Tarihler", {
            'fields': ('last_login', 'date_joined'),
        }),
    )


class UserSegmentAdmin(admin.ModelAdmin):
    list_display = ('name', 'description')
    search_fields = ('name',)
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Bu segmenti kullanıcılar için etiketleyin. Örn: 'Yeni Kullanıcı', 'Sadık Müşteri'."
        }),
    )


class DealerSegmentAdmin(admin.ModelAdmin):
    list_display = ('name', 'description')
    search_fields = ('name',)
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Bayi segment adını girin. Örn: 'Gold Bayi'."
        }),
    )


class ProductAdmin(admin.ModelAdmin):
    list_display = ('name', 'price', 'serviceDuration', 'isActive', 'createDate', 'updateDate')
    list_filter = ('isActive',)
    search_fields = ('name', 'description')
    readonly_fields = ('slug', 'createDate', 'updateDate')
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Ürünün temel bilgilerini girin."
        }),
        ("Fiyat & Süre", {
            'fields': ('serviceDuration', 'price', 'isActive'),
            'description': "Hizmet süresi (ay) ve fiyat bilgilerini girin."
        }),
        ("URL Bilgileri", {
            'fields': ('slug',),
            'description': "URL otomatik oluşturulur."
        }),
        ("Tarih Bilgileri", {
            'fields': ('createDate', 'updateDate'),
            'description': "Tarih bilgileri otomatik."
        }),
    )


class ConditionInline(admin.TabularInline):
    model = Condition
    extra = 1
    verbose_name = "Koşul"
    verbose_name_plural = "Koşullar"


class ActionInline(admin.TabularInline):
    model = Action
    extra = 1
    verbose_name = "Aksiyon"
    verbose_name_plural = "Aksiyonlar"


class CampaignAdmin(admin.ModelAdmin):
    list_display = ('name', 'start_date', 'end_date', 'is_active')
    list_filter = ('is_active',)
    search_fields = ('name', 'description')
    filter_horizontal = ('products',)
    inlines = [ConditionInline, ActionInline]
    fieldsets = (
        (None, {
            'fields': ('name', 'description', 'is_active'),
            'description': "Kampanyanın adını ve açıklamasını girin."
        }),
        ("Zaman Aralığı", {
            'fields': ('start_date', 'end_date'),
            'description': "Kampanyanın geçerli olacağı tarih aralığı."
        }),
        ("Ürünler", {
            'fields': ('products',),
            'description': "Kampanyanın geçerli olacağı ürünler."
        }),
    )


class ConditionTypeAdmin(admin.ModelAdmin):
    list_display = ('code', 'name', 'description')
    search_fields = ('code', 'name')


class ActionTypeAdmin(admin.ModelAdmin):
    list_display = ('code', 'name', 'description')
    search_fields = ('code', 'name')


class ConditionAdmin(admin.ModelAdmin):
    list_display = ('campaign', 'condition_type', 'user_segment', 'dealer_segment')
    search_fields = ('campaign__name', 'condition_type__name')
    list_filter = ('condition_type', 'user_segment', 'dealer_segment')


class ActionAdmin(admin.ModelAdmin):
    list_display = ('campaign', 'action_type')
    search_fields = ('campaign__name', 'action_type__name')
    list_filter = ('action_type',)


class MenuAdminForm(forms.ModelForm):
    ROLE_CHOICES = [
        ("admin", "Admin"),
        ("manager", "Manager"),
        ("superuser", "Superuser"),
    ]

    roles = forms.MultipleChoiceField(
        choices=ROLE_CHOICES,
        widget=forms.CheckboxSelectMultiple,
        required=False,
        label="Roles"
    )

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        if isinstance(self.instance.roles, list):
            self.fields["roles"].initial = self.instance.roles

    def clean_roles(self):
        return self.cleaned_data.get("roles", [])

    class Meta:
        model = Menu
        fields = "__all__"


class MenuAdmin(admin.ModelAdmin):
    form = MenuAdminForm
    list_display = (
        'title',
        'path',
        'icon',
        'caption',
        'parent',
        'product',
        'order',
        'is_superuser_only',
        'disabled',
        'external'
    )
    search_fields = ('title', 'path', 'icon', 'caption')
    list_filter = ('parent', 'product', 'is_superuser_only', 'disabled', 'external')
    ordering = ('order',)


class SiteUrunAdmin(admin.ModelAdmin):
    list_display = ('site', 'urun_list', 'createdAt')
    search_fields = ('site__name', 'urun__name')
    list_filter = ('site',)
    filter_horizontal = ('urun',)

    def urun_list(self, obj):
        return ", ".join([urun.name for urun in obj.urun.all()])
    urun_list.short_description = "Ürünler"


def safe_remove(file_path):
    if os.path.exists(file_path):
        os.remove(file_path)


class SiteAdminForm(forms.ModelForm):
    is_active = forms.BooleanField(label="Aktif", required=False)
    is_our_site = forms.BooleanField(label="Bizim Sitemiz", required=False)
    is_default_site = forms.BooleanField(label="Varsayılan Site", required=False)
    show_popup_ad = forms.BooleanField(label="Pop-up Reklam Gösterimi", required=False)
    logo = forms.ImageField(label="Site Logosu", required=False)

    class Meta:
        model = Site
        fields = "__all__"

    def clean_logo(self):
        logo = self.cleaned_data.get("logo", None)
        if self.instance.pk:
            extended_site = getattr(self.instance, "extended_site", None)
            if extended_site and not logo and extended_site.logo:
                safe_remove(extended_site.logo.path)
                extended_site.logo = None
                extended_site.save()
        return logo

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        extended_site = getattr(self.instance, "extended_site", None)
        if extended_site:
            self.fields["is_active"].initial = extended_site.isActive
            self.fields["is_our_site"].initial = extended_site.isOurSite
            self.fields["is_default_site"].initial = extended_site.isDefault
            self.fields["show_popup_ad"].initial = extended_site.showPopupAd
            if extended_site.logo:
                self.fields["logo"].initial = extended_site.logo


class SiteAdmin(admin.ModelAdmin):
    form = SiteAdminForm
    list_display = (
        "domain", "name", "is_active", "is_our_site", "is_default", "show_popup_ad",
        "formatted_created_at", "formatted_updated_at"
    )
    readonly_fields = ("formatted_created_at", "formatted_updated_at")
    search_fields = ("domain", "name")

    def is_active(self, obj):
        return getattr(obj.extended_site, "isActive", False)
    is_active.boolean = True

    def is_our_site(self, obj):
        return getattr(obj.extended_site, "isOurSite", False)
    is_our_site.boolean = True

    def is_default(self, obj):
        return getattr(obj.extended_site, "isDefault", False)
    is_default.boolean = True

    def show_popup_ad(self, obj):
        return getattr(obj.extended_site, "showPopupAd", False)
    show_popup_ad.boolean = True

    def formatted_created_at(self, obj):
        extended_site = getattr(obj, "extended_site", None)
        if extended_site and extended_site.createdAt:
            return localtime(extended_site.createdAt).strftime('%d-%m-%Y %H:%M:%S')
        return "Bilinmiyor"

    def formatted_updated_at(self, obj):
        extended_site = getattr(obj, "extended_site", None)
        if extended_site and extended_site.updatedAt:
            return localtime(extended_site.updatedAt).strftime('%d-%m-%Y %H:%M:%S')
        return "Bilinmiyor"


class OperatingSystemAdmin(admin.ModelAdmin):
    list_display = ("name", "version", "createdAt", "updatedAt")
    search_fields = ("name", "version")
    readonly_fields = ("createdAt", "updatedAt")


class CustomSiteConfigurationAdmin(admin.ModelAdmin):
    list_display = ('site', 'webServer', 'sqlServer', 'mailServer', 'dnsServer', 'createdAt', 'updatedAt')
    list_filter = ('webServer', 'sqlServer', 'mailServer', 'dnsServer')
    search_fields = ('site__name', 'webServer__domain', 'sqlServer__domain', 'mailServer__domain', 'dnsServer__domain')
    ordering = ('-createdAt',)


class BlacklistAdmin(admin.ModelAdmin):
    list_display = ('ip_address', 'reason', 'added_on', 'is_active')
    list_filter = ('is_active', 'added_on')
    search_fields = ('ip_address', 'reason')
    actions = ['activate_ips', 'deactivate_ips']

    def activate_ips(self, request, queryset):
        queryset.update(is_active=True)
        self.message_user(request, "Seçilen IP adresleri aktifleştirildi.")
    activate_ips.short_description = "Seçili IP'leri Aktifleştir"

    def deactivate_ips(self, request, queryset):
        queryset.update(is_active=False)
        self.message_user(request, "Seçilen IP adresleri pasifleştirildi.")
    deactivate_ips.short_description = "Seçili IP'leri Pasifleştir"


class UserSiteAdmin(admin.ModelAdmin):
    list_display = ("user", "site", "createdAt", "updatedAt")
    list_filter = ("site", "user")
    search_fields = ("user__username", "site__name")
    readonly_fields = ("createdAt", "updatedAt")


# Modelleri my_admin_site'e kaydediyoruz
my_admin_site.register(CustomUser, CustomUserAdmin)
my_admin_site.register(UserSegment, UserSegmentAdmin)
my_admin_site.register(DealerSegment, DealerSegmentAdmin)
my_admin_site.register(Product, ProductAdmin)
my_admin_site.register(Campaign, CampaignAdmin)
my_admin_site.register(ConditionType, ConditionTypeAdmin)
my_admin_site.register(ActionType, ActionTypeAdmin)
my_admin_site.register(Condition, ConditionAdmin)
my_admin_site.register(Action, ActionAdmin)
my_admin_site.register(Menu, MenuAdmin)
my_admin_site.register(SiteUrun, SiteUrunAdmin)
my_admin_site.register(Site, SiteAdmin)
my_admin_site.register(OperatingSystem, OperatingSystemAdmin)
my_admin_site.register(WebServer, WebServerAdmin)
my_admin_site.register(SqlServer, SqlServerAdmin)
my_admin_site.register(MailServer, MailServerAdmin)
my_admin_site.register(DnsServer, DnsServerAdmin)
my_admin_site.register(CustomSiteConfiguration, CustomSiteConfigurationAdmin)
my_admin_site.register(Blacklist, BlacklistAdmin)
my_admin_site.register(UserSite, UserSiteAdmin)

try:
    admin.site.unregister(Group)
except admin.sites.NotRegistered:
    pass
Özet:

Ana urls.py dosyanızda my_admin_site.urls kullanın.
Menu modelini campaign_models setine ekleyerek "Kampanya Yönetimi" altına aldık.
Bu sayede Menu modeli de ilgili gruplama içerisinde görünecektir.




Şunu dedin:
Ana urls.py dosyanızda my_admin_site.urls kullanın.

demişsin eğer bunu yaparsam diğer app lere ait admin py dosyaları kaybolmaz mı?
ChatGPT
o1-pro’ya gönderilen talep
Düşündüm için 52 saniye
Evet, varsayılan admin.site.urls yerine my_admin_site.urls kullanırsanız, varsayılan admin.site'a kayıtlı olan modeller gözükmez. Bunun nedeni, Django admin yapısında her AdminSite örneğinin kendi kayıt defterinin olmasıdır. Siz my_admin_site isimli yeni bir admin örneği oluşturup, modelleri ona kaydettiğinizde, varsayılan admin.site örneği ile bağlantılı olanlar görünmez.

Bu durumun çözümleri şunlar olabilir:

Tüm Modelleri my_admin_site Üzerine Taşımak:
Tüm uygulamalardaki modelleri (diğer app'ler de dahil) my_admin_site.register(Model, ModelAdmin) şeklinde my_admin_site'ye kaydederseniz, my_admin_site.urls altından giriş yaptığınızda tüm modelleri yine görürsünüz. Bu durumda artık admin.site kullanılmadığı için admin.site.urls gereksiz hale gelir.

Çoklu AdminSite Kullanımı:

Eğer bazı uygulamalara ait modelleri farklı bir admin paneli altında göstermek istiyorsanız, her birini farklı AdminSite nesnelerine kayıt edebilirsiniz. Örneğin my_admin_site sadece kampanya yönetimine ait modelleri barındırırken, varsayılan admin.site'ı farklı bir URL altına koyup diğer app'lerin modellerini orada tutabilirsiniz. Bu durumda ana urls.py içinde farklı URL pattern'ler kullanmanız gerekir. Örneğin:
python
Kodu kopyala
from django.urls import path
from .admin import my_admin_site
from django.contrib import admin

urlpatterns = [
    path('admin/', my_admin_site.urls),
    path('main-admin/', admin.site.urls),
]
Böylece /admin/ adresinde özelleştirilmiş admini, /main-admin/ adresinde varsayılan admini görebilirsiniz. Ama bu yaklaşım iki farklı admin paneli demektir.

Yalnızca Bir AdminSite Kullanmak:
Eğer tek bir admin paneli altında tüm app'leri göstermek istiyorsanız, my_admin_site'yi varsayılan yönetim paneliniz haline getirip diğer app'lerdeki modelleri de ona register etmelisiniz. Böylece admin.site.urls yerine my_admin_site.urls kullanırken de tüm modelleri aynı panelde görürsünüz.

Sonuç:
Eğer my_admin_site'yi ana urls.py'da kullanıp diğer admin dosyalarını kaybetmek istemiyorsanız, ya tüm modelleri my_admin_site'ye kaydetmeniz ya da birden fazla AdminSite yöneterek onları farklı URL'lere ayırmanız gerekir. Tek bir admin paneli kullanmak istiyorsanız, tüm kayıtları my_admin_site üzerinde toplayarak admin.site'a ihtiyaç bırakmamış olursunuz.





Şunu dedin:
aşağıdaki ki yapıyı kullanacağım özelleştirilmişmenüden vaz geçtim daha sonra app i ayırabilirim, şimdi bana aşağıdaki kampanya yönetimini nasıl kullanacağım örneklerle açıkla burayı drf ve next.js ile ön yüzde satılan ürünlerde ürünün kanpaya  ya nasıl girdiği anlaşılıp fiyatlama yapılarak sepete eklenecek bu konuyu anlatan bir döküman ver


import os

from django import forms
from django.conf import settings
from django.contrib import admin
from django.contrib.admin.sites import AdminSite
from django.contrib.sites.models import Site
from django.urls import path
from django.utils.timezone import localtime

from .forms import CustomAdminAuthenticationForm
from .models import ExtendedSite
from .models import SiteUrun, WebServer, SqlServer, MailServer, DnsServer, \
    OperatingSystem, CustomSiteConfiguration, Blacklist, Menu, UserSite, CustomUser, UserSegment, \
    DealerSegment, Product, Campaign, ConditionType, ActionType, Condition, Action


class CustomAdminSite(AdminSite):
    login_form = CustomAdminAuthenticationForm


custom_admin_site = CustomAdminSite()

# Yönetim paneli URL'sini kullanacak şekilde güncelleyin


urlpatterns = [
    path('admin/', custom_admin_site.urls),
]

# Yönetim paneli başlıklarını settings.py'den alarak özelleştiriyoruz
admin.site.site_header = getattr(settings, 'ADMIN_SITE_HEADER', 'Django Yönetim Paneli')
admin.site.site_title = getattr(settings, 'ADMIN_SITE_TITLE', 'Django Yönetim Paneli')
admin.site.index_title = getattr(settings, 'ADMIN_INDEX_TITLE', 'Hoş Geldiniz!')


class CustomUserAdminForm(forms.ModelForm):
    class Meta:
        model = CustomUser
        fields = '__all__'
        help_texts = {
            'isDealer': "Bu kullanıcı bir bayiyse işaretleyin. Bayilere özel kampanyalar ve ek iskontolar uygulanabilir.",
            'dealer_segment': "Bayiyi hangi bayi segmentine dahil etmek istediğinizi seçin. Segmentler, özel fiyatlandırma ve kampanyalar için kullanılır.",
        }


@admin.register(CustomUser)
class CustomUserAdmin(admin.ModelAdmin):
    form = CustomUserAdminForm
    list_display = ('username', 'email', 'isDealer', 'dealer_segment', 'is_staff', 'is_active')
    list_filter = ('isDealer', 'dealer_segment', 'is_staff', 'is_active')
    search_fields = ('username', 'email')
    fieldsets = (
        (None, {
            'fields': ('username', 'password'),
            'description': "Temel kullanıcı adı ve parola ayarları."
        }),
        ("Kişisel Bilgiler", {
            'fields': ('first_name', 'last_name', 'email'),
            'description': "Kullanıcının temel iletişim bilgilerini girin."
        }),
        ("Bayi Bilgileri", {
            'fields': ('isDealer', 'dealer_segment'),
            'description': "Eğer kullanıcı bir bayiyse işaretleyin ve uygun bayi segmentini seçin."
        }),
        ("İzinler ve Durum", {
            'fields': ('is_active', 'is_staff', 'is_superuser', 'groups', 'user_permissions'),
            'description': "Kullanıcının yetkilerini, gruplarını ve izinlerini belirleyin."
        }),
        ("Önemli Tarihler", {
            'fields': ('last_login', 'date_joined'),
        }),
    )


@admin.register(UserSegment)
class UserSegmentAdmin(admin.ModelAdmin):
    list_display = ('name', 'description')
    search_fields = ('name',)
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Bu segmenti kullanıcılar için etiketleyin. Örneğin 'Yeni Kullanıcı', 'Sadık Müşteri' vb."
        }),
    )


@admin.register(DealerSegment)
class DealerSegmentAdmin(admin.ModelAdmin):
    list_display = ('name', 'description')
    search_fields = ('name',)
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Bayi segment adını ve açıklamasını girin. Örneğin 'Gold Bayi' veya 'Alt Bayi'."
        }),
    )


@admin.register(Product)
class ProductAdmin(admin.ModelAdmin):
    list_display = ('name', 'price', 'serviceDuration', 'isActive', 'createDate', 'updateDate')
    list_filter = ('isActive',)
    search_fields = ('name', 'description')
    readonly_fields = ('slug', 'createDate', 'updateDate')
    fieldsets = (
        (None, {
            'fields': ('name', 'description'),
            'description': "Ürünün temel bilgilerini girin. İsim ve açıklama kullanıcıların göreceği bilgilerdir."
        }),
        ("Fiyat & Süre", {
            'fields': ('serviceDuration', 'price', 'isActive'),
            'description': "Hizmet süresi (ay) ve fiyat bilgilerini girin. Ürün aktif değilse satışta görünmez."
        }),
        ("URL Bilgileri", {
            'fields': ('slug',),
            'description': "Ürünün URL yapısını otomatik oluşturur. Değiştirmeye gerek yok.",
        }),
        ("Tarih Bilgileri", {
            'fields': ('createDate', 'updateDate'),
            'description': "Oluşturulma ve güncellenme tarihleri otomatik olarak işlenir.",
        }),
    )


class ConditionInline(admin.TabularInline):
    model = Condition
    extra = 1
    verbose_name = "Koşul"
    verbose_name_plural = "Koşullar"
    help_text = "Bu kampanyanın hangi koşullarda geçerli olacağını belirleyin. Örneğin belirli bir ürün alındığında veya belirli bir kullanıcı segmentine yönelik."


class ActionInline(admin.TabularInline):
    model = Action
    extra = 1
    verbose_name = "Aksiyon"
    verbose_name_plural = "Aksiyonlar"
    help_text = "Koşullar sağlandığında ne yapılacağını belirleyin. Örn: %10 indirim, hediye ürün."


@admin.register(Campaign)
class CampaignAdmin(admin.ModelAdmin):
    list_display = ('name', 'start_date', 'end_date', 'is_active')
    list_filter = ('is_active',)
    search_fields = ('name', 'description')
    filter_horizontal = ('products',)
    inlines = [ConditionInline, ActionInline]
    fieldsets = (
        (None, {
            'fields': ('name', 'description', 'is_active'),
            'description': "Kampanyanın adını ve açıklamasını girin. Aktif olunca kampanya devreye girer."
        }),
        ("Zaman Aralığı", {
            'fields': ('start_date', 'end_date'),
            'description': "Kampanyanın geçerli olacağı tarih aralığını belirleyin."
        }),
        ("Ürünler", {
            'fields': ('products',),
            'description': "Bu kampanyanın geçerli olacağı ürünleri seçin. Boş bırakırsanız tüm ürünler için geçerli olabilir."
        }),
    )


@admin.register(ConditionType)
class ConditionTypeAdmin(admin.ModelAdmin):
    list_display = ('code', 'name', 'description')
    search_fields = ('code', 'name')
    fieldsets = (
        (None, {
            'fields': ('code', 'name', 'description'),
            'description': "Yeni bir koşul tipi tanımlarken kodunun benzersiz olmasına dikkat edin. Örn: 'USER_SEGMENT', 'PRODUCT_PURCHASED'."
        }),
    )


@admin.register(ActionType)
class ActionTypeAdmin(admin.ModelAdmin):
    list_display = ('code', 'name', 'description')
    search_fields = ('code', 'name')
    fieldsets = (
        (None, {
            'fields': ('code', 'name', 'description'),
            'description': "Aksiyon tiplerinin kodlarının da benzersiz olması gerekir. Örn: 'DISCOUNT_FIXED', 'ADD_BACKLINK'."
        }),
    )


@admin.register(Condition)
class ConditionAdmin(admin.ModelAdmin):
    list_display = ('campaign', 'condition_type', 'user_segment', 'dealer_segment')
    search_fields = ('campaign__name', 'condition_type__name')
    list_filter = ('condition_type', 'user_segment', 'dealer_segment')
    fieldsets = (
        (None, {
            'fields': ('campaign', 'condition_type', 'user_segment', 'dealer_segment', 'params'),
            'description': "Koşulun bağlı olduğu kampanyayı, koşul tipini ve segmentleri belirleyin. params ile ek kriterler tanımlayın."
        }),
    )


@admin.register(Action)
class ActionAdmin(admin.ModelAdmin):
    list_display = ('campaign', 'action_type')
    search_fields = ('campaign__name', 'action_type__name')
    list_filter = ('action_type',)
    fieldsets = (
        (None, {
            'fields': ('campaign', 'action_type', 'params'),
            'description': "Aksiyonun bağlı olduğu kampanyayı, aksiyon tipini seçin. params alanıyla ayrıntılı ayar yapın."
        }),
    )


class MenuAdminForm(forms.ModelForm):
    ROLE_CHOICES = [
        ("admin", "Admin"),
        ("manager", "Manager"),
        ("superuser", "Superuser"),
    ]

    roles = forms.MultipleChoiceField(
        choices=ROLE_CHOICES,
        widget=forms.CheckboxSelectMultiple,
        required=False,
        label="Roles"
    )

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        if isinstance(self.instance.roles, list):
            self.fields["roles"].initial = self.instance.roles

    def clean_roles(self):
        return self.cleaned_data.get("roles", [])

    class Meta:
        model = Menu
        fields = "__all__"


@admin.register(Menu)
class MenuAdmin(admin.ModelAdmin):
    form = MenuAdminForm
    list_display = (
        'title',
        'path',
        'icon',
        'caption',
        'parent',
        'product',
        'order',
        'is_superuser_only',
        'disabled',
        'external'
    )  # id list_display'den kaldırıldı
    search_fields = ('title', 'path', 'icon', 'caption')  # Arama alanları
    list_filter = ('parent', 'product', 'is_superuser_only', 'disabled', 'external')  # Filtreleme
    ordering = ('order',)  # Sıralama
    fieldsets = (
        (None, {
            'fields': (
                'title',
                'path',
                'icon',
                'caption',
                'parent',
                'product',
                'order'
            )
        }),
        ('Visibility & Access', {
            'fields': (
                'is_superuser_only',
                'roles',
                'disabled',
                'external'
            )
        }),
        ('Metadata', {
            'fields': ('info',)
        }),
    )


@admin.register(SiteUrun)
class SiteUrunAdmin(admin.ModelAdmin):
    list_display = ('site', 'urun_list', 'createdAt')
    search_fields = ('site__name', 'urun__name')
    list_filter = ('site',)
    filter_horizontal = ('urun',)

    def urun_list(self, obj):
        return ", ".join([urun.name for urun in obj.urun.all()])

    urun_list.short_description = "Ürünler"


def safe_remove(file_path):
    """
    Dosyayı güvenli bir şekilde siler. Dosya mevcut değilse hata vermez.
    """
    if os.path.exists(file_path):
        os.remove(file_path)
        print(f"Silindi: {file_path}")


class SiteAdminForm(forms.ModelForm):
    """
    Site admini için form.
    """
    is_active = forms.BooleanField(label="Aktif", required=False)
    is_our_site = forms.BooleanField(label="Bizim Sitemiz", required=False)
    is_default_site = forms.BooleanField(label="Varsayılan Site", required=False)
    show_popup_ad = forms.BooleanField(label="Pop-up Reklam Gösterimi", required=False)
    logo = forms.ImageField(label="Site Logosu", required=False)

    def clean_logo(self):
        """
        Admin panelinden 'logo' alanı temizlendiğinde fiziksel dosyayı da siler ve veritabanı kaydını temizler.
        """
        logo = self.cleaned_data.get("logo", None)

        # ExtendedSite ile bağlantılı olan logo alanını kontrol edin
        if self.instance.pk:
            extended_site = getattr(self.instance, "extended_site", None)
            if extended_site and not logo and extended_site.logo:
                # Logo temizlenmişse fiziksel dosyayı sil
                safe_remove(extended_site.logo.path)
                extended_site.logo = None  # Veritabanındaki logo alanını temizle
                extended_site.save()  # Değişiklikleri kaydet

        return logo

    class Meta:
        model = Site
        fields = "__all__"

    def clean_logo(self):
        """
        Admin panelinden 'logo' alanı temizlendiğinde fiziksel dosyayı da siler ve veritabanı kaydını temizler.
        """
        logo = self.cleaned_data.get("logo", None)

        # ExtendedSite ile bağlantılı olan logo alanını kontrol edin
        if self.instance.pk:
            extended_site = getattr(self.instance, "extended_site", None)
            if extended_site and not logo and extended_site.logo:
                # Logo temizlenmişse fiziksel dosyayı sil
                safe_remove(extended_site.logo.path)
                extended_site.logo = None  # Veritabanındaki logo alanını temizle
                extended_site.save()  # Değişiklikleri kaydet

        return logo

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        extended_site = getattr(self.instance, "extended_site", None)
        if extended_site:
            self.fields["is_active"].initial = extended_site.isActive
            self.fields["is_our_site"].initial = extended_site.isOurSite
            self.fields["is_default_site"].initial = extended_site.isDefault
            self.fields["show_popup_ad"].initial = extended_site.showPopupAd
            if extended_site.logo:
                self.fields["logo"].initial = extended_site.logo


class SiteAdmin(admin.ModelAdmin):
    """
    Site modeli için admin yapılandırması.
    """
    form = SiteAdminForm
    list_display = (
        "domain", "name", "is_active", "is_our_site", "is_default", "show_popup_ad",
        "formatted_created_at", "formatted_updated_at"  # Tarih alanları listede görünür
    )
    readonly_fields = ("formatted_created_at", "formatted_updated_at")  # Detay görünümünde yalnızca okunabilir alanlar
    search_fields = ("domain", "name")

    def is_active(self, obj):
        return getattr(obj.extended_site, "isActive", False)

    is_active.boolean = True
    is_active.short_description = "Aktif"

    def is_our_site(self, obj):
        return getattr(obj.extended_site, "isOurSite", False)

    is_our_site.boolean = True
    is_our_site.short_description = "Bizim Sitemiz"

    def is_default(self, obj):
        return getattr(obj.extended_site, "isDefault", False)

    is_default.boolean = True
    is_default.short_description = "Varsayılan Site"

    def show_popup_ad(self, obj):
        return getattr(obj.extended_site, "showPopupAd", False)

    show_popup_ad.boolean = True
    show_popup_ad.short_description = "Pop-up Reklam"

    def logo_display(self, obj):
        extended_site = obj.extended_site
        if extended_site and extended_site.logo:
            return f'<img src="{extended_site.logo.url}" style="width:48px; height:auto;" alt="Logo"/>'
        return "Logo Yok"

    logo_display.short_description = "Logo"
    logo_display.allow_tags = True

    def formatted_created_at(self, obj):
        """
        Oluşturulma tarihini okunabilir formatta döndürür.
        """
        extended_site = getattr(obj, "extended_site", None)
        if extended_site and extended_site.createdAt:
            return localtime(extended_site.createdAt).strftime('%d-%m-%Y %H:%M:%S')
        return "Bilinmiyor"

    formatted_created_at.short_description = "Oluşturulma Tarihi"

    def formatted_updated_at(self, obj):
        """
        Güncellenme tarihini okunabilir formatta döndürür.
        """
        extended_site = getattr(obj, "extended_site", None)
        if extended_site and extended_site.updatedAt:
            return localtime(extended_site.updatedAt).strftime('%d-%m-%Y %H:%M:%S')
        return "Bilinmiyor"

    formatted_updated_at.short_description = "Güncellenme Tarihi"

    def save_model(self, request, obj, form, change):
        """
        Site modeli kaydedildiğinde ExtendedSite modelini de günceller veya oluşturur.
        """
        super().save_model(request, obj, form, change)
        extended_site, _ = ExtendedSite.objects.get_or_create(site=obj)
        extended_site.isActive = form.cleaned_data.get("is_active", False)
        extended_site.isOurSite = form.cleaned_data.get("is_our_site", False)
        extended_site.isDefault = form.cleaned_data.get("is_default_site", False)
        extended_site.showPopupAd = form.cleaned_data.get("show_popup_ad", False)

        if "logo" in form.cleaned_data:
            if not form.cleaned_data["logo"]:
                if extended_site.logo:
                    safe_remove(extended_site.logo.path)
                extended_site.logo = None
            else:
                extended_site.logo = form.cleaned_data["logo"]

        extended_site.save()


# Site modelini yeni admin yapılandırmasıyla kaydetme
admin.site.unregister(Site)
admin.site.register(Site, SiteAdmin)


@admin.register(OperatingSystem)
class OperatingSystemAdmin(admin.ModelAdmin):
    list_display = ("name", "version", "createdAt", "updatedAt")
    search_fields = ("name", "version")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("name", "version")}),
        ("Açıklama", {"fields": ("description",)}),
        ("Tarih Bilgileri", {"fields": ("createdAt", "updatedAt")}),
    )


@admin.register(WebServer)
class WebServerAdmin(admin.ModelAdmin):
    list_display = (
        "domain",
        "isActive",
        "isDefault",
        "ns1",
        "ns2",
        "operatingSystem",
        "paymentType",
        "priceUsd",
        "createdAt",
        "updatedAt",
    )
    search_fields = ("domain", "ns1", "ns2")
    list_filter = ("paymentType", "operatingSystem")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("operatingSystem", "domain", "isActive", "isDefault", "ns1", "ns2")}),
        ("IP Adresleri", {"fields": ("ipAddress1", "ipAddress2", "ipAddress3", "ipAddress4", "ipAddress5")}),
        ("Kullanıcı Bilgileri", {"fields": ("username", "password")}),
        ("Ödeme ve Ücretlendirme", {"fields": ("paymentType", "priceUsd")}),
        ("Diğer Bilgiler", {"fields": ("description", "createdAt", "updatedAt")}),
    )


@admin.register(SqlServer)
class SqlServerAdmin(admin.ModelAdmin):
    list_display = (
        "domain",
        "isActive",
        "isDefault",
        "ns1",
        "ns2",
        "operatingSystem",
        "paymentType",
        "priceUsd",
        "createdAt",
        "updatedAt",
    )
    search_fields = ("domain", "ns1", "ns2")
    list_filter = ("paymentType", "operatingSystem")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("operatingSystem", "domain", "isActive", "isDefault", "ns1", "ns2")}),
        ("IP Adresleri", {"fields": ("ipAddress1", "ipAddress2", "ipAddress3", "ipAddress4", "ipAddress5")}),
        ("Kullanıcı Bilgileri", {"fields": ("username", "password")}),
        ("Ödeme ve Ücretlendirme", {"fields": ("paymentType", "priceUsd")}),
        ("Diğer Bilgiler", {"fields": ("description", "createdAt", "updatedAt")}),
    )


@admin.register(MailServer)
class MailServerAdmin(admin.ModelAdmin):
    list_display = (
        "domain",
        "isActive",
        "isDefault",
        "ns1",
        "ns2",
        "operatingSystem",
        "paymentType",
        "priceUsd",
        "createdAt",
        "updatedAt",
    )
    search_fields = ("domain", "ns1", "ns2")
    list_filter = ("paymentType", "operatingSystem")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("operatingSystem", "domain", "isActive", "isDefault", "ns1", "ns2")}),
        ("IP Adresleri", {"fields": ("ipAddress1", "ipAddress2", "ipAddress3", "ipAddress4", "ipAddress5")}),
        ("Kullanıcı Bilgileri", {"fields": ("username", "password")}),
        ("Ödeme ve Ücretlendirme", {"fields": ("paymentType", "priceUsd")}),
        ("Diğer Bilgiler", {"fields": ("description", "createdAt", "updatedAt")}),
    )


@admin.register(DnsServer)
class DnsServerAdmin(admin.ModelAdmin):
    list_display = (
        "domain",
        "isActive",
        "isDefault",
        "ns1",
        "ns2",
        "operatingSystem",
        "paymentType",
        "priceUsd",
        "createdAt",
        "updatedAt",
    )
    search_fields = ("domain", "ns1", "ns2")
    list_filter = ("paymentType", "operatingSystem")
    readonly_fields = ("createdAt", "updatedAt")
    fieldsets = (
        (None, {"fields": ("operatingSystem", "domain", "isActive", "isDefault", "ns1", "ns2")}),
        ("IP Adresleri", {"fields": ("ipAddress1", "ipAddress2", "ipAddress3", "ipAddress4", "ipAddress5")}),
        ("Kullanıcı Bilgileri", {"fields": ("username", "password")}),
        ("Ödeme ve Ücretlendirme", {"fields": ("paymentType", "priceUsd")}),
        ("Diğer Bilgiler", {"fields": ("description", "createdAt", "updatedAt")}),
    )
ChatGPT
Request for o1 pro mode
Düşünme sona erdi
Aşağıda, verdiğiniz kampanya yönetimi yapısının Django (DRF) ve Next.js tabanlı bir ön yüz ile entegrasyonuna dair kapsamlı bir dokümantasyon örneği bulacaksınız. Bu dokümantasyon, geliştiricilere kampanya modellerini nasıl kullanacaklarını, koşulların ve aksiyonların nasıl değerlendirileceğini ve sonunda sepete ürün ekleme aşamasında fiyatlandırmanın kampanyalara göre nasıl ayarlanacağını açıklar.

Amaç
Back-end tarafında (Django + DRF), kampanyaları, koşulları (conditions) ve aksiyonları (actions) yöneten bir yapıya sahibiz.
Bu yapıyı kullanarak Next.js (veya herhangi bir frontend) üzerinde ürünleri listeleyecek, kullanıcı bir ürün sepete eklerken geçerli kampanyaları kontrol edecek ve indirimli fiyatı yansıtacağız.
Kullanıcı segmentine, bayi segmentine veya belirli ürünlere yönelik kampanyalar sunulabiliyor.
Temel Yapı
Modeller
Product: Satılan her bir ürünün modeli. price alanı ürünün temel fiyatını barındırır.
Campaign: Kampanyaları tanımlar. Bir kampanya, belirli tarihler arasında geçerli olabilir, belirli ürünlere uygulanabilir ya da tüm ürünlere uygulanabilir.
ConditionType & Condition:
ConditionType kampanya koşullarının tiplerini tanımlar (örneğin MIN_CART_TOTAL, PRODUCT_PURCHASED, USER_SEGMENT, DEALER_SEGMENT, FIRST_PURCHASE).
Condition ise belirli bir kampanya için hangi koşulların geçerli olduğunu saklar. Örneğin Condition.condition_type = USER_SEGMENT ve user_segment = "Yeni Kullanıcı".
ActionType & Action:
ActionType aksiyon tiplerini tanımlar (örn. DISCOUNT_PERCENT, DISCOUNT_FIXED, GIFT_PRODUCT).
Action ise kampanya koşulları sağlandığında yapılacak işlemi tanımlar (örn. %10 indirim ya da Hediye ürün ekle).
Bu yapı, kampanyaların esnek bir şekilde yönetilmesini sağlar.

DRF ile API Geliştirme
Serializer’lar ve Endpoint’ler
Product API Endpoint’i:
Kullanıcı ürün sayfasını ziyaret ettiğinde ürünün temel fiyatını ve diğer bilgilerini görecek.
Örneğin /api/products/ veya /api/products/<product_id>/ endpoint’leri aracılığıyla ürün bilgisini alabilirsiniz.

Örnek ProductSerializer:

python
Kodu kopyala
from rest_framework import serializers
from .models import Product

class ProductSerializer(serializers.ModelSerializer):
    class Meta:
        model = Product
        fields = ['id', 'name', 'description', 'price', 'serviceDuration', 'isActive']
DRF ViewSet:

python
Kodu kopyala
from rest_framework.viewsets import ReadOnlyModelViewSet
from .models import Product
from .serializers import ProductSerializer

class ProductViewSet(ReadOnlyModelViewSet):
    queryset = Product.objects.filter(isActive=True)
    serializer_class = ProductSerializer
Kampanya Kontrolü için Bir API (Sepete Eklerken):
Kullanıcı Next.js ön yüzünde bir ürünü sepete eklemek istediğinde, kampanyaları kontrol etmek için özel bir endpoint oluşturabiliriz. Bu endpoint, ürün ID, kullanıcı bilgileri (giriş yapmışsa user_id), sepet durumu (diğer ürünler vs.) gibi parametreler alır ve geçerli kampanyaları değerlendirir.

Örneğin /api/campaigns/apply/ adlı bir endpoint olsun. Bu endpoint’e şunları gönderirsiniz:

product_id: Eklenen ürünün ID’si.
user_id: Müşteri (veya bayi) kimliği (anonim kullanıcı ise gönderilmez).
cart_total: Mevcut sepet toplamı (başka ürünler varsa).
Gerekirse user_segment, dealer_segment bilgileri arka tarafta user_id’den çıkarılabilir.
Bu endpoint, kampanyaları kontrol eder ve discounted_price gibi bir alan döndürür.

Serializer örneği:

python
Kodu kopyala
class ApplyCampaignSerializer(serializers.Serializer):
    product_id = serializers.IntegerField()
    user_id = serializers.IntegerField(required=False)
    cart_total = serializers.DecimalField(max_digits=10, decimal_places=2, required=False)
View örneği (basit mantıkla):

python
Kodu kopyala
from rest_framework.views import APIView
from rest_framework.response import Response
from rest_framework import status
from .models import Product, Campaign, Condition, Action
from .serializers import ApplyCampaignSerializer
from decimal import Decimal
from django.utils import timezone

class ApplyCampaignView(APIView):
    def post(self, request, *args, **kwargs):
        serializer = ApplyCampaignSerializer(data=request.data)
        serializer.is_valid(raise_exception=True)
        product_id = serializer.validated_data['product_id']
        user_id = serializer.validated_data.get('user_id', None)
        cart_total = serializer.validated_data.get('cart_total', Decimal('0.00'))

        # Ürünü al
        try:
            product = Product.objects.get(id=product_id, isActive=True)
        except Product.DoesNotExist:
            return Response({'error': 'Ürün bulunamadı'}, status=status.HTTP_404_NOT_FOUND)

        # Kullanıcı bilgisi ve segmentini al (eğer user_id varsa)
        user = None
        user_segment = None
        dealer_segment = None
        is_dealer = False
        if user_id:
            user = CustomUser.objects.get(id=user_id)
            user_segment = user.usersegment_set.first()  # Örnek olarak ilk segment
            dealer_segment = user.dealer_segment
            is_dealer = user.isDealer

        # Şimdi geçerli kampanyaları bul
        now = timezone.now()
        applicable_campaigns = Campaign.objects.filter(
            is_active=True
        ).filter(
            # Başlangıç ve bitiş tarihine göre filtre
            start_date__lte=now,
        ).filter(
            models.Q(end_date__isnull=True) | models.Q(end_date__gte=now)
        )

        # Ürüne özgü kampanyalar veya tüm ürünlere geçerli kampanyalar
        applicable_campaigns = applicable_campaigns.filter(
            models.Q(products__isnull=True) | models.Q(products=product)
        ).distinct()

        # Kampanyaların koşullarını değerlendir
        # Her kampanya için Condition'ları kontrol et
        eligible_campaigns = []
        for camp in applicable_campaigns:
            conditions = camp.conditions.all()
            if all(self.check_condition(cond, product, user, user_segment, dealer_segment, cart_total) for cond in conditions):
                eligible_campaigns.append(camp)

        # Eğer birden fazla kampanya uygunsa, öncelik belirlemek veya tüm aksiyonları uygulamak gerekebilir.
        # Burada örnek olarak tüm uygun kampanyaların aksiyonlarını uyguluyoruz.
        final_price = product.price
        for camp in eligible_campaigns:
            actions = camp.actions.all()
            for action in actions:
                final_price = self.apply_action(action, final_price, product)

        return Response({
            'product_id': product_id,
            'original_price': str(product.price),
            'discounted_price': str(final_price),
            'campaigns_applied': [c.name for c in eligible_campaigns]
        }, status=200)

    def check_condition(self, condition, product, user, user_segment, dealer_segment, cart_total):
        # Burada condition_type'a göre koşulları kontrol edebilirsiniz.
        ctype = condition.condition_type.code
        params = condition.params

        if ctype == 'USER_SEGMENT':
            # Kullanıcının segmenti condition.user_segment ile eşleşmeli
            if condition.user_segment and user_segment:
                return condition.user_segment == user_segment
            return False

        if ctype == 'DEALER_SEGMENT':
            if condition.dealer_segment and dealer_segment:
                return condition.dealer_segment == dealer_segment
            return False

        if ctype == 'PRODUCT_PURCHASED':
            # Örneğin params={'product_id': X} gibi bir kontrol yapabilirsiniz
            required_pid = params.get('product_id', None)
            # Bu örnekte, koşul "Sepete eklenen ürün bu mu?" olabilir:
            return required_pid == product.id

        if ctype == 'MIN_CART_TOTAL':
            required_amount = Decimal(params.get('amount', '0.00'))
            return cart_total >= required_amount

        # Diğer koşulları da benzer şekilde ekleyin.
        return True

    def apply_action(self, action, current_price, product):
        # Aksiyon tipine göre fiyatı güncelle
        atype = action.action_type.code
        params = action.params

        if atype == 'DISCOUNT_PERCENT':
            percentage = Decimal(params.get('percentage', '0'))
            discount_amount = current_price * (percentage / Decimal('100'))
            return current_price - discount_amount

        if atype == 'DISCOUNT_FIXED':
            discount_value = Decimal(params.get('value', '0.00'))
            return max(current_price - discount_value, Decimal('0.00'))

        # GIFT_PRODUCT ya da ADD_CONTENT gibi aksiyonlar sepete ek nesne eklemek için kullanılabilir.
        # Fiyata direkt etkisi yoksa current_price geri döndürün.
        return current_price
Next.js Tarafında Kullanım
Ürün Sayfası:
Next.js ile bir ürün sayfasında ürünün temel fiyatını /api/products/<id>/ endpoint’inden alabilirsiniz.
Örneğin:

javascript
Kodu kopyala
// pages/product/[id].js
import { useState, useEffect } from 'react'

function ProductPage({ productId }) {
  const [product, setProduct] = useState(null);

  useEffect(() => {
    fetch(`/api/products/${productId}/`)
      .then(res => res.json())
      .then(data => setProduct(data));
  }, [productId]);

  if (!product) return <div>Yükleniyor...</div>;

  return (
    <div>
      <h1>{product.name}</h1>
      <p>Fiyat: {product.price} TL</p>
      <button>Add to Cart</button>
    </div>
  );
}

export async function getServerSideProps(context) {
  const { id } = context.params;
  return { props: { productId: id } }
}

export default ProductPage;
Sepete Ekleme Aşaması:
Sepete ekle butonuna basıldığında, kullanıcının login durumuna göre user_id ve sepetin mevcut toplamı (cart_total) backend’e gönderilir. Backend’den dönen discounted_price değeri ile bu ürünü sepete eklersiniz.

javascript
Kodu kopyala
// Sepete ekleme örneği
async function addToCart(productId, userId, cartTotal) {
  const res = await fetch('/api/campaigns/apply/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      product_id: productId,
      user_id: userId, // opsiyonel
      cart_total: cartTotal // halihazırdaki sepet tutarı
    })
  });

  const data = await res.json();

  // data.discounted_price ile ürünü sepete ekleyebilirsiniz.
  // Frontend state yönetimi (Redux veya Context) ile sepetinizi güncelleyin.
}
Sepet Görüntüleme:
Sepet sayfasında kullanıcıya discounted_price üzerinden ürünleri gösterirsiniz.
Eğer kullanıcı sepeti güncellediğinde veya başka ürünler eklediğinde, tekrar /api/campaigns/apply/ endpoint’ine başvurarak en güncel fiyatı alabilirsiniz.

Kampanyaların Yönetimi
Django admin panelinde Campaign, Condition, Action modellerini yöneterek yeni kampanyalar oluşturabilir, koşul ve aksiyonlarını ayarlayabilirsiniz.
Örneğin, ConditionType olarak USER_SEGMENT eklediyseniz, bir kampanya koşulu oluştururken user_segment alanını seçerek sadece "Yeni Kullanıcı" segmentine özel bir indirim verebilirsiniz.
ActionType olarak DISCOUNT_PERCENT seçip params alanına {"percentage": 10} yazdığınızda %10 indirim uygular.
Örnek Senaryo
Senaryo: Yeni Kullanıcılara İlk Ürün Alımında %10 İndirim

Admin panelinde ConditionType tablosunda USER_SEGMENT ve FIRST_PURCHASE gibi tipleriniz var.
ActionType tablosunda DISCOUNT_PERCENT mevcut.
Yeni bir kampanya oluşturun:
name: "Yeni Kullanıcı İndirimi"
is_active: True
start_date: bugünden itibaren
end_date: boş (süresiz)
Koşul ekleyin:
condition_type: USER_SEGMENT
user_segment: "Yeni Kullanıcı"
Aksiyon ekleyin:
action_type: DISCOUNT_PERCENT
params: {"percentage": 10}
Şimdi yeni kullanıcı segmentindeki bir kullanıcı ürün sepete eklediğinde /api/campaigns/apply/ endpoint’i %10 indirimli fiyat dönecektir.

Performans ve Genişletme
Çok sayıda kampanya varsa, koşul kontrolü uzun sürebilir. Bu durumda önbellekleme veya kampanya önceden işleme stratejileri geliştirebilirsiniz.
Aksiyonlar sadece fiyata değil, hediye ürün ekleme gibi işlemlere de olanak verir. Bu durumda endpoint’in cevabı ek ürün bilgisi içerebilir.
İleri aşamada kupon kodu mantığı veya bayi segmentine farklı barem hedefleri gibi fonksiyonları da benzer şekilde entegre edebilirsiniz.
Sonuç
Bu doküman, DRF ve Next.js’i kullanarak kampanya yönetimi model yapısını nasıl kullanacağınızı, ürün sepete eklenirken kampanyaların nasıl uygulanacağını ve fiyatların nasıl güncelleneceğini açıklamaktadır. Temel mantık:

Ürün bilgisini alın (DRF üzerinden).
Ürünü sepete eklemeden önce kampanya endpoint’ine başvurun.
Kampanyaların koşulları ve aksiyonları uygulanarak indirimli fiyat elde edin.
Next.js tarafında bu indirimli fiyatla ürünü sepete ekleyin ve kullanıcıya gösterin.
Böylece hem esnek bir kampanya yönetimi oluşturabilir hem de front-end tarafında dinamik fiyatlandırma sağlayabilirsiniz.





Şunu dedin:
kupon kodu mantığı veya bayi segmentine farklı barem hedefleri gibi fonksiyonları da anlat ve örnekle
ChatGPT
kupon kodu ve bayi segmenti fonksiyonları
Düşündüm için 1m 55s
Aşağıda, önceki dokümantasyona ek olarak kupon kodu mantığını ve bayi segmentine farklı barem hedefleri (hedef kampanyaları) gibi gelişmiş fonksiyonları nasıl entegre edebileceğinize dair detaylı bir açıklama ve örnekler yer almaktadır.

Gelişmiş Fonksiyonlar
1. Kupon Kodu Mantığı
Kupon kodları, sepette veya ürün alımında ek indirim ya da avantaj sağlamanın yaygın bir yöntemidir. Kullanıcı sepete bir ürün eklerken veya ödeme aşamasında bir kupon kodu girebilir. Bu kod, belli koşullarla (tarih, kullanım hakkı, belirli ürün veya segment) sınırlandırılabilir.

Model Yapısı (Örnek)
Coupon modeli:
code: Kupon kodu (örnek: "WELCOME50")
discount_type: percent veya fixed indirim tipi
discount_value: İndirim oranı veya sabit indirim değeri
start_date, end_date: Kuponun geçerli olduğu tarih aralığı
usage_limit: Kupon maksimum kaç kere kullanılabilir?
used_count: Kaç kere kullanılmış
user_segment / dealer_segment: Kuponun sadece belirli segmentteki kullanıcılar için geçerli olması
products: Kuponun yalnızca belirli ürünlerde geçerli olması (opsiyonel)
Bu sayede kuponun hangi şartlarda geçerli olacağını veri tabanından kontrol edebilirsiniz.

DRF Üzerinde Kupon Uygulama
Sepete ürün eklerken veya ödeme aşamasında /api/campaigns/apply/ endpoint’ine ek olarak coupon_code de gönderebilirsiniz. Backend şu mantığı uygular:

coupon_code varsa Coupon tablosundan kuponu bulur.
Kuponun geçerli olup olmadığını kontrol eder:
Tarih aralığında mı?
Kullanım limiti aşılmış mı?
Kullanıcının segmenti veya bayi segmenti uygun mu?
Ürün/ürünler bu kupon için geçerli mi?
Eğer kupon geçerliyse, aksiyon olarak kuponu da bir tür Action gibi ele alabilirsiniz:
discount_type='percent' ise ürün fiyatından belirtilen yüzde kadar indirim yapın.
discount_type='fixed' ise ürün fiyatından sabit miktar düşürün.
Örnek olarak apply_action fonksiyonunu kupona göre genişletin:

python
Kodu kopyala
if coupon_code:
    coupon = Coupon.objects.filter(code=coupon_code, is_active=True).first()
    if coupon and coupon.is_valid(user=user):
        # is_valid metodu kupon tarihini, limitini, segmentleri kontrol eder
        final_price = apply_coupon(coupon, final_price, product)
apply_coupon fonksiyonu:

python
Kodu kopyala
def apply_coupon(coupon, current_price, product):
    # Ürünün kupon için geçerli olup olmadığını kontrol edin
    if coupon.products.exists() and product not in coupon.products.all():
        return current_price  # Kupon bu ürün için geçerli değil

    if coupon.discount_type == 'percent':
        discount_amount = current_price * (coupon.discount_value / Decimal('100'))
        return current_price - discount_amount
    elif coupon.discount_type == 'fixed':
        return max(current_price - coupon.discount_value, Decimal('0.00'))
    return current_price
Bu sayede kullanıcı kupon kodu girip sepete ekleme yaptığında ek indirim elde eder.

2. Bayi Segmentine Farklı Barem Hedefleri
Bayi hedef kampanyaları, bayilerin belirli bir süre içinde (örneğin 1 ay, 6 ay, 1 yıl) belirli satış hedeflerini tutturmaları karşılığında puan (kredi) veya ek avantajlar elde etmelerini sağlar. Bu sistem, gerçek zamanlı koşul-aksiyon mantığından biraz farklıdır, çünkü genellikle dönem sonunda değerlendirilir.

Örnek Model Yapısı
DealerTargetCampaign:

name: "2024 İlk Yarı Bayi Satış Hedefi"
start_date, end_date: Hedefin geçerli olduğu süre
is_active: Hedef kampanyası aktif mi?
DealerTargetThreshold (Barem):

target_campaign: Hangi bayi hedef kampanyasına ait?
min_sales_amount: Bu bareme ulaşmak için gereken minimum satış tutarı
credit_reward: Bu barem sağlanınca verilecek kredi miktarı
DealerTargetAssignment (Opsiyonel):

Belirli bir bayiye özel hedef baremleri veya parametreleri tanımlamak için kullanılabilir. Eğer tüm bayiler aynı baremleri paylaşıyorsa gerek yok.
Bayi Hedefleri Nasıl Uygulanır?
Bayilerin yaptığı satışları (siparişleri) takip edersiniz. Her sipariş bayinin user_id ya da isDealer bilgisi ile ilişkilendirilir.
Hedef süresi sonunda (örneğin, 6 ayın sonunda) bir cron job veya Celery task çalıştırırsınız.
Her bayi için ilgili dönem içindeki toplam satış tutarını hesaplarsınız.
Bu tutara göre DealerTargetCampaign içindeki DealerTargetThreshold kayıtlarını kontrol edersiniz.
Örneğin: Eğer bayi 100.000 TL satış yapmışsa ve barem: 50.000 TL için 100 kredi, 100.000 TL için 250 kredi ise, bayiye 250 kredi eklersiniz.
Kazanılan kredileri bayi hesabında bir alanda (örneğin user.credits) saklayabilir veya ayrı bir tabloya kaydedebilirsiniz.
Bu süreçte DRF veya Next.js ile entegrasyon şu şekilde olabilir:

Next.js tarafında bayi kullanıcılar bir "Performans" sayfasına girer. Bu sayfada /api/dealer/targets/ gibi bir endpoint’ten bayiye özel hedef kampanyalarını ve mevcut durumunu (şu anki satış tutarı, ulaştığı barem) görebilir.

Bu endpoint DRF üzerinden bayiye veya yöneticilere rapor verir. Örneğin:

python
Kodu kopyala
# DRF endpoint: /api/dealer/targets/
# Dönem sonunda veya istenilen anda bayinin hedefine ne kadar yaklaştığını döndürebilir.
from rest_framework.views import APIView
from rest_framework.response import Response
from .models import DealerTargetCampaign, DealerSegment
from decimal import Decimal

class DealerTargetStatusView(APIView):
    def get(self, request):
        user = request.user
        if not user.isDealer:
            return Response({'error': 'Bayi değil'}, status=403)
        
        # Örnek: Tüm aktif hedef kampanyalarına bak
        campaigns = DealerTargetCampaign.objects.filter(is_active=True)
        result = []
        for camp in campaigns:
            # Bayinin bu kampanya süresince toplam satışını hesaplayın (örnek)
            total_sales = self.calculate_dealer_sales(user, camp)
            thresholds = camp.thresholds.all().order_by('min_sales_amount')
            achieved_reward = 0
            for th in thresholds:
                if total_sales >= th.min_sales_amount:
                    achieved_reward = th.credit_reward
                else:
                    break
            result.append({
                'campaign': camp.name,
                'start_date': camp.start_date,
                'end_date': camp.end_date,
                'total_sales': str(total_sales),
                'reward_achieved': achieved_reward
            })
        
        return Response(result)

    def calculate_dealer_sales(self, user, camp):
        # Burada user's order tablolarından camp dönemine denk gelen siparişlerin toplamını hesaplayın.
        # Bu kısım projeye göre değişir. Örneğin:
        # Order.objects.filter(dealer=user, created_at__range=(camp.start_date, camp.end_date)).aggregate(Sum('total'))
        # Varsayılan örnek:
        return Decimal('100000.00')
Next.js, bu endpoint’i çağırarak bayiye anlık olarak "Şu ana kadar 100.000 TL satış yaptınız, hedef 50.000 TL idi, 250 kredi kazandınız." benzeri bir ekran gösterebilir.

Kredi veya Ödüllerin Kullanımı
Elde edilen krediler bayi tarafından indirimli alışveriş, ek hizmet satın alma veya başka kampanyalarda kullanılması için bir "ödül" olarak değerlendirilebilir. Bu mantık, kupon veya aksiyon sistemine benzer şekilde, bir ödeme aşamasında bayinin kazandığı kredileri kullanarak ek indirim uygulayabilir.

Örneğin, ödeme aşamasında /api/campaigns/apply/ çağrısı yaparken use_dealer_credits=true parametresi gönderebilir ve backend bayinin elindeki kredileri fiyatı düşürmek için kullanabilir.

Özet:
Kupon Kodları: Kampanyalara benzer şekilde ek bir indirim katmanı sağlar. Ön yüzde kullanıcı bir kupon kodu girer, backend kuponun geçerliliğini kontrol edip ek indirim uygular.
Bayi Segmentine Farklı Barem Hedefleri: Bayilerin uzun vadeli performans hedeflerini kontrol eder. Genellikle dönem sonunda değerlendirilir. Bayi belirli bir satış baremine ulaştığında kredi veya ödül alır. Bu ödüller daha sonra ek indirimlerde veya ürün satın alımında kullanılabilir.
Akış Örneği (Tümü Bir Arada):
Bayi segmentinde olan bir kullanıcı, yılın ilk yarısında 100.000 TL satış yaparsa hedef kampanyasından 250 kredi kazansın.
Kullanıcı segmenti "Yeni Kullanıcı" ise ilk alışverişte %10 indirimli fiyat uygula (koşul-aksiyon).
Kullanıcı bir kupon kodu ("WELCOME50") girerse ek %5 indirim uygula.
Ödeme aşamasında /api/campaigns/apply/ endpoint’ini çağırırsınız:

Arka plan:
Koşul-aksiyon sistemini çalıştırır (yeni kullanıcı indirimi, bayi indirimi vs.)
Kupon kodu varsa kuponu da uygular.
Bayi kredisi varsa kullanıcı kullanmayı seçtiyse (veya otomatik) krediyi kullanıp fiyatı düşürür.
Sonuç olarak front-end:

Next.js, backend’den gelen discounted_priceı alır ve kullanıcıya final fiyatı gösterir.
Eğer bayi segmentinden dolayı ekstra indirim veya kredi kullanımı varsa bunlar da fiyata yansır.
Kullanıcı ödemeyi yapar, sipariş oluşturulur.
Eğer bu sipariş bayi hedef dönemine dahilse bayinin satış tutarı artar, dönem sonunda hesaplama yapılarak kredileri güncellenir.
Bu şekilde hem kısa vadeli kampanyalar (koşul-aksiyon, kuponlar) hem de uzun vadeli bayi hedefleri bir arada çalışarak karmaşık bir teşvik mekanizması oluşturabilirsiniz.





Şunu dedin:
koşullar ve aksiyonlardaki parametrelere örnekler ver
ChatGPT
koşullar ve aksiyon parametreleri örnekleri
Düşündüm için 1m 15s
Aşağıda koşullar (Conditions) ve aksiyonlar (Actions) için params alanına verilebilecek örnek parametre formatları yer almaktadır. Bu parametreler, JSONField kullanılarak esnek bir şekilde saklanabilir. Her koşul ve aksiyon tipi, kendi tipine uygun parametreleri içerir.

Koşullar (Conditions) İçin Parametre Örnekleri
Belirli Ürün Alımı (PRODUCT_PURCHASED)
Amaç: Müşteri sepete eklediği ürünler arasında belirli bir ürün varsa koşul geçerli olsun.

json
Kodu kopyala
{
  "product_id": 123
}
Bu örnekte product_id=123 olan ürün sepete eklendiğinde koşul sağlanır.

Minimum Sepet Tutarı (MIN_CART_TOTAL)
Amaç: Sepet tutarı en az belirli bir miktarın üzerinde olursa koşul geçerli olsun.

json
Kodu kopyala
{
  "amount": 100.00
}
Sepet toplamı 100 TL veya üstündeyse koşul sağlanır.

İlk Alışveriş (FIRST_PURCHASE)
Amaç: Kullanıcının ilk alışverişinde koşul geçerli olsun.
Bu koşul genellikle parametre gerektirmez, ancak esnek olmak için bir flag saklanabilir:

json
Kodu kopyala
{
  "first_time_only": true
}
Eğer kullanıcı bu siteden daha önce hiç alışveriş yapmadıysa koşul sağlanır.

Ürün Adedine Göre Koşul (BULK_QUANTITY)
Amaç: Sepette belirli bir ürünün en az X adet olması durumunda koşul geçerli olsun.

json
Kodu kopyala
{
  "product_id": 456,
  "min_quantity": 5
}
Ürün ID=456 olan üründen sepette en az 5 adet varsa koşul sağlanır.

Belirli Kullanıcı Segmenti (USER_SEGMENT)
Amaç: Müşteri belirli bir segmentteyse koşul geçerli olsun. Parametreye genelde ihtiyaç duyulmaz, çünkü segment condition tablosunda ayrı alan olarak saklanır. Ancak ek parametreler de verilebilir.

json
Kodu kopyala
{
  "note": "Sadece 'Yeni Kullanıcı' segmentine uygulanır"
}
Burada note sadece bilgilendirme amaçlı. Asıl kontrol user_segment alanından yapılır.

Belirli Zaman Aralığı (TIME_RANGE)
Amaç: Koşulun sadece belirli saatler veya tarihler arasında geçerli olması.

json
Kodu kopyala
{
  "start_time": "2024-12-01T00:00:00Z",
  "end_time": "2024-12-31T23:59:59Z"
}
Koşul sadece Aralık ayında geçerli olur.

Aksiyonlar (Actions) İçin Parametre Örnekleri
Yüzdesel İndirim (DISCOUNT_PERCENT)
Amaç: Ürünün veya sepetin toplam tutarı üzerinden belirtilen yüzde kadar indirim uygula.

json
Kodu kopyala
{
  "percentage": 10
}
%10 indirim uygulanır.

Sabit İndirim (DISCOUNT_FIXED)
Amaç: Toplam fiyattan sabit bir tutar düş.

json
Kodu kopyala
{
  "value": 20.00
}
20 TL sabit indirim uygulanır.

Hediye Ürün Ekle (GIFT_PRODUCT)
Amaç: Koşullar sağlanınca sepete ekstra bir ürün hediye ekle.

json
Kodu kopyala
{
  "product_id": 789,
  "quantity": 1
}
Ürün ID=789 olan üründen 1 adet sepete ücretsiz eklenir.

Backlink veya İçerik Ekle (ADD_CONTENT / ADD_BACKLINK)
Amaç: Koşul sağlanınca müşteriye ek hizmet veya içerik sağlamak. Örneğin, 100 makale veya 1 milyon backlink.

json
Kodu kopyala
{
  "content_type": "article",
  "quantity": 100
}
Bu durumda müşteriye 100 makale içeren bir paket sağlanabilir.

Backlink örneğinde:

json
Kodu kopyala
{
  "backlinks": 1000000
}
Müşteriye 1 milyon backlink hakkı tanımlanır.

Kupon Kodu Oluşturma (CREATE_COUPON) - Opsiyonel bir aksiyon tipi
Amaç: Koşullar sağlandığında kullanıcının hesabına bir kupon kodu tanımlamak.

json
Kodu kopyala
{
  "coupon_code": "WELCOME50",
  "discount_type": "fixed",
  "discount_value": 50.00
}
Bu durumda kullanıcı bir sonraki alışverişinde kullanabileceği 50 TL indirim kuponu kazanır.

Abonelik Süresi Uzatma (EXTEND_SUBSCRIPTION)
Amaç: Koşul sağlandığında müşterinin abonelik süresini uzatmak.

json
Kodu kopyala
{
  "additional_months": 3
}
Müşterinin abonelik süresi 3 ay uzatılır.

Özet
Koşullar ve aksiyonlar için params alanında JSON formatında esnek veriler tutabilirsiniz. Bu parametreler:

Koşullarda, kampanyanın hangi şartlarda geçerli olduğunu tanımlar (belirli ürün, minimum sepet tutarı, tarih aralığı, kullanıcı segmenti vb.).
Aksiyonlarda, koşullar sağlandığında hangi işlemlerin yapılacağını belirtir (yüzdesel indirim, hediye ürün, kupon kodu tanımlama, abonelik uzatma vb.).
Bu örnek parametreler, sisteminizi ihtiyaçlarınıza göre kolayca genişletebilmenize olanak tanır.





Şunu dedin:
koşulları toplu olarak ver küçük bir açıklama ile 
ChatGPT
Request for o1 pro mode
Düşünme sona erdi
Aşağıda koşullara dair toplu bir liste ve her bir koşulun kısa açıklaması yer almaktadır. Bu koşullar, kampanyanın geçerli olup olmayacağını belirlerken kullanılabilir.

USER_SEGMENT (Kullanıcı Segmenti):
Belirli bir kullanıcı segmentine (ör. "Yeni Kullanıcı", "Sadık Müşteri") ait olan kullanıcılar için koşulu sağlar.

DEALER_SEGMENT (Bayi Segmenti):
Belirli bir bayi segmentine ait kullanıcılar (ör. "Gold Bayi") için geçerli koşuldur.

PRODUCT_PURCHASED (Belirli Ürün Alımı):
Sepette veya satın alınan ürünler arasında belirli bir ürünün bulunması durumunda koşul sağlanır.

MIN_CART_TOTAL (Minimum Sepet Tutarı):
Sepet tutarının belirli bir miktarın üzerinde olması durumunda koşul geçerli olur.

FIRST_PURCHASE (İlk Alışveriş):
Kullanıcının sitedeki ilk alışverişinde koşul sağlanır, örneğin "Hoşgeldin Kampanyası" için kullanılır.

BULK_QUANTITY (Toplu Alım Miktarı):
Sepette belirli bir üründen minimum bir adede ulaşılması (örneğin 5 adet aynı ürün) koşulu geçerli kılar.

TIME_RANGE (Zaman Aralığı):
Kampanyanın belirli bir tarih veya saat aralığında geçerli olmasını sağlar. Örneğin, "Hafta sonu kampanyası" veya "Bayram indirimi" gibi.

Bu koşullar bir veya birden fazlası aynı anda uygulanarak, kampanyanın hangi durumlarda tetikleneceği esnek bir şekilde belirlenebilir.

?
